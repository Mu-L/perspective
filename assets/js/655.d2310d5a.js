(self.webpackChunk_finos_perspective_docs=self.webpackChunk_finos_perspective_docs||[]).push([[655],{7655:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Z,init_client:()=>K,init_server:()=>J,websocket:()=>X,worker:()=>Y});var r=Object.defineProperty,_={};((e,t)=>{for(var n in t)r(e,n,{get:t[n],enumerable:!0})})(_,{Client:()=>P,Table:()=>I,View:()=>M,default:()=>H,init:()=>k,initSync:()=>F});var i,o=class extends Error{};function s(e){return null==e}var a=null;var c=null;function u(){return(null===c||0===c.byteLength)&&(c=new Int32Array(i.memory.buffer)),c}var f=0,b=null;function l(){return(null===b||0===b.byteLength)&&(b=new Uint8Array(i.memory.buffer)),b}var w=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},g=function(e,t){return w.encodeInto(e,t)};function p(e,t,n){if(void 0===n){let n=w.encode(e),r=t(n.length,1)>>>0;return l().subarray(r,r+n.length).set(n),f=n.length,r}let r=e.length,_=t(r,1)>>>0,i=l(),o=0;for(;o<r;o++){let t=e.charCodeAt(o);if(t>127)break;i[_+o]=t}if(o!==r){0!==o&&(e=e.slice(o)),_=n(_,r,r=o+3*e.length,1)>>>0;let t=l().subarray(_+o,_+r);o+=g(e,t).written,_=n(_,r,o,1)>>>0}return f=o,_}var d=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};function m(e,t){return e>>>=0,d.decode(l().subarray(e,e+t))}typeof TextDecoder<"u"&&d.decode();var y=null;function h(e){let t=typeof e;if("number"==t||"boolean"==t||null==e)return`${e}`;if("string"==t)return`"${e}"`;if("symbol"==t){let t=e.description;return null==t?"Symbol":`Symbol(${t})`}if("function"==t){let t=e.name;return"string"==typeof t&&t.length>0?`Function(${t})`:"Function"}if(Array.isArray(e)){let t=e.length,n="[";t>0&&(n+=h(e[0]));for(let r=1;r<t;r++)n+=", "+h(e[r]);return n+="]",n}let n,r=/\[object ([^\]]+)\]/.exec(toString.call(e));if(!(r.length>1))return toString.call(e);if(n=r[1],"Object"==n)try{return"Object("+JSON.stringify(e)+")"}catch{return"Object"}return e instanceof Error?`${e.name}: ${e.message}\n${e.stack}`:n}var v=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>{i.__wbindgen_export_3.get(e.dtor)(e.a,e.b)}));function A(e,t,n){i.closure358_externref_shim(e,t,n)}function x(e){let t=i.__wbindgen_export_5();return i.__wbindgen_export_2.set(t,e),t}function E(e){let t=i.__wbindgen_export_2.get(e);return i.__wbindgen_export_6(e),t}function k(){i.init()}function W(e,t){try{return e.apply(this,t)}catch(n){let e=x(n);i.__wbindgen_export_8(e)}}function U(e){return()=>{throw new Error(`${e} is not defined`)}}var O=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>i.__wbg_client_free(e>>>0))),P=class{static __wrap(e){e>>>=0;let t=Object.create(P.prototype);return t.__wbg_ptr=e,O.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){let e=this.__wbg_ptr;return this.__wbg_ptr=0,O.unregister(this),e}free(){let e=this.__destroy_into_raw();i.__wbg_client_free(e)}constructor(e,t){let n=i.client_new(e,s(t)?0:x(t));return this.__wbg_ptr=n>>>0,this}init(){return i.client_init(this.__wbg_ptr)}handle_response(e){return i.client_handle_response(this.__wbg_ptr,e)}table(e,t){return i.client_table(this.__wbg_ptr,e,s(t)?0:x(t))}terminate(){try{let n=i.__wbindgen_add_to_stack_pointer(-16);i.client_terminate(n,this.__wbg_ptr);var e=u()[n/4+0],t=u()[n/4+1];if(u()[n/4+2])throw E(t);return E(e)}finally{i.__wbindgen_add_to_stack_pointer(16)}}open_table(e){let t=p(e,i.__wbindgen_export_0,i.__wbindgen_export_1),n=f;return i.client_open_table(this.__wbg_ptr,t,n)}get_hosted_table_names(){return i.client_get_hosted_table_names(this.__wbg_ptr)}system_info(){return i.client_system_info(this.__wbg_ptr)}},j=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>i.__wbg_table_free(e>>>0))),I=class{static __wrap(e){e>>>=0;let t=Object.create(I.prototype);return t.__wbg_ptr=e,j.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){let e=this.__wbg_ptr;return this.__wbg_ptr=0,j.unregister(this),e}free(){let e=this.__destroy_into_raw();i.__wbg_table_free(e)}get_index(){return i.table_get_index(this.__wbg_ptr)}get_client(){return i.table_get_client(this.__wbg_ptr)}get_limit(){return i.table_get_limit(this.__wbg_ptr)}clear(){return i.table_clear(this.__wbg_ptr)}delete(){return i.table_delete(this.__wbg_ptr)}size(){return i.table_size(this.__wbg_ptr)}schema(){return i.table_schema(this.__wbg_ptr)}columns(){return i.table_columns(this.__wbg_ptr)}make_port(){return i.table_make_port(this.__wbg_ptr)}on_delete(e){return i.table_on_delete(this.__wbg_ptr,e)}remove_delete(e){return i.table_remove_delete(this.__wbg_ptr,e)}remove(e,t){return i.table_remove(this.__wbg_ptr,e,s(t)?0:x(t))}replace(e,t){return i.table_replace(this.__wbg_ptr,e,s(t)?0:x(t))}update(e,t){return i.table_update(this.__wbg_ptr,e,s(t)?0:x(t))}view(e){return i.table_view(this.__wbg_ptr,s(e)?0:x(e))}validate_expressions(e){return i.table_validate_expressions(this.__wbg_ptr,e)}unsafe_get_model(){return i.table_unsafe_get_model(this.__wbg_ptr)>>>0}},S=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>i.__wbg_view_free(e>>>0))),M=class{static __wrap(e){e>>>=0;let t=Object.create(M.prototype);return t.__wbg_ptr=e,S.register(t,t.__wbg_ptr,t),t}static __unwrap(e){return e instanceof M?e.__destroy_into_raw():0}__destroy_into_raw(){let e=this.__wbg_ptr;return this.__wbg_ptr=0,S.unregister(this),e}free(){let e=this.__destroy_into_raw();i.__wbg_view_free(e)}__get_model(){let e=i.view___get_model(this.__wbg_ptr);return M.__wrap(e)}column_paths(){return i.view_column_paths(this.__wbg_ptr)}delete(){return i.view_delete(this.__wbg_ptr)}dimensions(){return i.view_dimensions(this.__wbg_ptr)}expression_schema(){return i.view_expression_schema(this.__wbg_ptr)}get_config(){return i.view_get_config(this.__wbg_ptr)}get_min_max(e){let t=p(e,i.__wbindgen_export_0,i.__wbindgen_export_1),n=f;return i.view_get_min_max(this.__wbg_ptr,t,n)}num_rows(){return i.view_num_rows(this.__wbg_ptr)}schema(){return i.view_schema(this.__wbg_ptr)}to_arrow(e){return i.view_to_arrow(this.__wbg_ptr,s(e)?0:x(e))}to_columns_string(e){return i.view_to_columns_string(this.__wbg_ptr,s(e)?0:x(e))}to_columns(e){return i.view_to_columns(this.__wbg_ptr,s(e)?0:x(e))}to_json_string(e){return i.view_to_json_string(this.__wbg_ptr,s(e)?0:x(e))}to_json(e){return i.view_to_json(this.__wbg_ptr,s(e)?0:x(e))}to_ndjson(e){return i.view_to_ndjson(this.__wbg_ptr,s(e)?0:x(e))}to_csv(e){return i.view_to_csv(this.__wbg_ptr,s(e)?0:x(e))}on_update(e,t){return i.view_on_update(this.__wbg_ptr,e,s(t)?0:x(t))}remove_update(e){return i.view_remove_update(this.__wbg_ptr,e)}on_delete(e){return i.view_on_delete(this.__wbg_ptr,e)}num_columns(){return i.view_num_columns(this.__wbg_ptr)}remove_delete(e){return i.view_remove_delete(this.__wbg_ptr,e)}collapse(e){return i.view_collapse(this.__wbg_ptr,e)}expand(e){return i.view_expand(this.__wbg_ptr,e)}set_depth(e){return i.view_set_depth(this.__wbg_ptr,e)}};function R(){let e={wbg:{}};return e.wbg.__wbindgen_is_undefined=function(e){return void 0===e},e.wbg.__wbindgen_in=function(e,t){return e in t},e.wbg.__wbindgen_number_get=function(e,t){let n="number"==typeof t?t:void 0;((null===a||0===a.byteLength)&&(a=new Float64Array(i.memory.buffer)),a)[e/8+1]=s(n)?0:n,u()[e/4+0]=!s(n)},e.wbg.__wbindgen_boolean_get=function(e){return"boolean"==typeof e?e?1:0:2},e.wbg.__wbindgen_string_get=function(e,t){let n="string"==typeof t?t:void 0;var r=s(n)?0:p(n,i.__wbindgen_export_0,i.__wbindgen_export_1),_=f;u()[e/4+1]=_,u()[e/4+0]=r},e.wbg.__wbindgen_is_object=function(e){return"object"==typeof e&&null!==e},e.wbg.__wbindgen_is_string=function(e){return"string"==typeof e},e.wbg.__wbindgen_error_new=function(e,t){return new Error(m(e,t))},e.wbg.__wbindgen_jsval_eq=function(e,t){return e===t},e.wbg.__wbindgen_number_new=function(e){return e},e.wbg.__wbindgen_is_bigint=function(e){return"bigint"==typeof e},e.wbg.__wbindgen_bigint_from_i64=function(e){return e},e.wbg.__wbindgen_bigint_from_u64=function(e){return BigInt.asUintN(64,e)},e.wbg.__wbindgen_as_number=function(e){return+e},e.wbg.__wbindgen_string_new=function(e,t){return m(e,t)},e.wbg.__wbg_new_d36fc02796551959=function(){return new o},e.wbg.__wbg_client_new=function(e){return P.__wrap(e)},e.wbg.__wbg_table_new=function(e){return I.__wrap(e)},e.wbg.__wbg_instanceof_PerspectiveViewNotFoundError_fd59451544782d44=function(e){let t;try{t=e instanceof o}catch{t=!1}return t},e.wbg.__wbg_view_new=function(e){return M.__wrap(e)},e.wbg.__wbg_view_unwrap=function(e){return M.__unwrap(e)},e.wbg.__wbg_new_abda76e883ba8a5f=function(){return new Error},e.wbg.__wbg_stack_658279fe44541cf6=function(e,t){let n=p(t.stack,i.__wbindgen_export_0,i.__wbindgen_export_1),r=f;u()[e/4+1]=r,u()[e/4+0]=n},e.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let n,r;try{n=e,r=t,console.error(m(e,t))}finally{i.__wbindgen_export_7(n,r,1)}},e.wbg.__wbindgen_jsval_loose_eq=function(e,t){return e==t},e.wbg.__wbg_String_b9412f8799faab3e=function(e,t){let n=p(String(t),i.__wbindgen_export_0,i.__wbindgen_export_1),r=f;u()[e/4+1]=r,u()[e/4+0]=n},e.wbg.__wbg_getwithrefkey_edc2c8960f0f1191=function(e,t){return e[t]},e.wbg.__wbg_set_f975102236d3c502=function(e,t,n){e[t]=n},e.wbg.__wbg_getEntriesByName_4c1e740dd4ca4c04=function(e,t,n,r,_){return e.getEntriesByName(m(t,n),m(r,_))},e.wbg.__wbg_mark_c41e729617d1fc82=function(){return W((function(e,t,n){e.mark(m(t,n))}),arguments)},e.wbg.__wbg_measure_229577a1511d1574=function(){return W((function(e,t,n,r,_){e.measure(m(t,n),m(r,_))}),arguments)},e.wbg.__wbg_now_4e659b3d15f470d9=function(e){return e.now()},e.wbg.__wbg_startTime_ed8f03c7b801464c=function(e){return e.startTime},e.wbg.__wbg_instanceof_Window_f401953a2cf86220=function(e){let t;try{t=e instanceof Window}catch{t=!1}return t},e.wbg.__wbg_performance_3298a9628a5c8aa4=function(e){let t=e.performance;return s(t)?0:x(t)},e.wbg.__wbg_get_d36d61640bbf4503=function(e,t,n){let r=e[m(t,n)];return s(r)?0:x(r)},e.wbg.__wbg_debug_5fb96680aecf5dc8="function"==typeof console.debug?console.debug:U("console.debug"),e.wbg.__wbg_debug_7d879afce6cf56cb="function"==typeof console.debug?console.debug:U("console.debug"),e.wbg.__wbg_error_8e3928cfb8a43e2b="function"==typeof console.error?console.error:U("console.error"),e.wbg.__wbg_error_6e987ee48d9fdf45="function"==typeof console.error?console.error:U("console.error"),e.wbg.__wbg_error_696630710900ec44="function"==typeof console.error?console.error:U("console.error"),e.wbg.__wbg_info_530a29cb2e4e3304="function"==typeof console.info?console.info:U("console.info"),e.wbg.__wbg_info_80803d9a3f0aad16="function"==typeof console.info?console.info:U("console.info"),e.wbg.__wbg_trace_ecf8be024774a5e1="function"==typeof console.trace?console.trace:U("console.trace"),e.wbg.__wbg_trace_a3be6210345f4cd3="function"==typeof console.trace?console.trace:U("console.trace"),e.wbg.__wbg_warn_63bbae1730aead09="function"==typeof console.warn?console.warn:U("console.warn"),e.wbg.__wbg_warn_5d3f783b0bae8943="function"==typeof console.warn?console.warn:U("console.warn"),e.wbg.__wbg_queueMicrotask_3cbae2ec6b6cd3d6=function(e){return e.queueMicrotask},e.wbg.__wbindgen_is_function=function(e){return"function"==typeof e},e.wbg.__wbindgen_cb_drop=function(e){let t=e.original;return 1==t.cnt--&&(t.a=0,!0)},e.wbg.__wbg_queueMicrotask_481971b0d87f3dd4="function"==typeof queueMicrotask?queueMicrotask:U("queueMicrotask"),e.wbg.__wbg_crypto_1d1f22824a6a080c=function(e){return e.crypto},e.wbg.__wbg_process_4a72847cc503995b=function(e){return e.process},e.wbg.__wbg_versions_f686565e586dd935=function(e){return e.versions},e.wbg.__wbg_node_104a2ff8d6ea03a2=function(e){return e.node},e.wbg.__wbg_require_cca90b1a94a0255b=function(){return W((function(){return module.require}),arguments)},e.wbg.__wbg_msCrypto_eb05e62b530a1508=function(e){return e.msCrypto},e.wbg.__wbg_randomFillSync_5c9c955aa56b6049=function(){return W((function(e,t){e.randomFillSync(t)}),arguments)},e.wbg.__wbg_getRandomValues_3aa56aa6edec874c=function(){return W((function(e,t){e.getRandomValues(t)}),arguments)},e.wbg.__wbg_self_ce0dbfc45cf2f5be=function(){return W((function(){return self.self}),arguments)},e.wbg.__wbg_window_c6fb939a7f436783=function(){return W((function(){return window.window}),arguments)},e.wbg.__wbg_globalThis_d1e6af4856ba331b=function(){return W((function(){return globalThis.globalThis}),arguments)},e.wbg.__wbg_global_207b558942527489=function(){return W((function(){return global.global}),arguments)},e.wbg.__wbg_newnoargs_e258087cd0daa0ea=function(e,t){return new Function(m(e,t))},e.wbg.__wbg_length_cd7af8117672b8b8=function(e){return e.length},e.wbg.__wbg_new_16b304a2cfa7ff4a=function(){return new Array},e.wbg.__wbg_new_d9bc3a0147634640=function(){return new Map},e.wbg.__wbg_next_40fc327bfc8770e6=function(e){return e.next},e.wbg.__wbg_value_d93c65011f51a456=function(e){return e.value},e.wbg.__wbg_iterator_2cee6dadfd956dfa=function(){return Symbol.iterator},e.wbg.__wbg_new_72fb9a18b5ae2624=function(){return new Object},e.wbg.__wbg_instanceof_Array_731699c9372cb461=function(e){let t;try{t=e instanceof Array}catch{t=!1}return t},e.wbg.__wbg_at_c729a14f9fc27c62=function(e,t){return e.at(t)},e.wbg.__wbg_get_bd8e338fbd5f5cc8=function(e,t){return e[t>>>0]},e.wbg.__wbg_set_d4638f722068f043=function(e,t,n){e[t>>>0]=n},e.wbg.__wbg_from_89e3fc3ba5e6fb48=function(e){return Array.from(e)},e.wbg.__wbg_isArray_2ab64d95e09ea0ae=function(e){return Array.isArray(e)},e.wbg.__wbg_push_a5b05aedc7234f9f=function(e,t){return e.push(t)},e.wbg.__wbg_instanceof_ArrayBuffer_836825be07d4c9d2=function(e){let t;try{t=e instanceof ArrayBuffer}catch{t=!1}return t},e.wbg.__wbg_call_27c0f87801dedf93=function(){return W((function(e,t){return e.call(t)}),arguments)},e.wbg.__wbg_call_b3ca7c6051f9bec1=function(){return W((function(e,t,n){return e.call(t,n)}),arguments)},e.wbg.__wbg_instanceof_Map_87917e0a7aaf4012=function(e){let t;try{t=e instanceof Map}catch{t=!1}return t},e.wbg.__wbg_set_8417257aaedc936b=function(e,t,n){return e.set(t,n)},e.wbg.__wbg_next_196c84450b364254=function(){return W((function(e){return e.next()}),arguments)},e.wbg.__wbg_done_298b57d23c0fc80c=function(e){return e.done},e.wbg.__wbg_isSafeInteger_f7b04ef02296c4d2=function(e){return Number.isSafeInteger(e)},e.wbg.__wbg_instanceof_Object_71ca3c0a59266746=function(e){let t;try{t=e instanceof Object}catch{t=!1}return t},e.wbg.__wbg_entries_95cc2c823b285a09=function(e){return Object.entries(e)},e.wbg.__wbg_keys_91e412b4b222659f=function(e){return Object.keys(e)},e.wbg.__wbg_values_9c75e6e2bfbdb70d=function(e){return Object.values(e)},e.wbg.__wbg_get_e3c254076557e348=function(){return W((function(e,t){return Reflect.get(e,t)}),arguments)},e.wbg.__wbg_has_0af94d20077affa2=function(){return W((function(e,t){return Reflect.has(e,t)}),arguments)},e.wbg.__wbg_buffer_12d079cc21e14bdb=function(e){return e.buffer},e.wbg.__wbg_parse_66d1801634e099ac=function(){return W((function(e,t){return JSON.parse(m(e,t))}),arguments)},e.wbg.__wbg_stringify_8887fe74e1c50d81=function(){return W((function(e){return JSON.stringify(e)}),arguments)},e.wbg.__wbg_new_81740750da40724f=function(e,t){try{var n={a:e,b:t};return new Promise(((e,t)=>{let r=n.a;n.a=0;try{return function(e,t,n,r){i.closure534_externref_shim(e,t,n,r)}(r,n.b,e,t)}finally{n.a=r}}))}finally{n.a=n.b=0}},e.wbg.__wbg_resolve_b0083a7967828ec8=function(e){return Promise.resolve(e)},e.wbg.__wbg_then_0c86a60e8fcfe9f6=function(e,t){return e.then(t)},e.wbg.__wbg_newwithbyteoffsetandlength_aa4a17c33a06e5cb=function(e,t,n){return new Uint8Array(e,t>>>0,n>>>0)},e.wbg.__wbg_new_63b92bc8671ed464=function(e){return new Uint8Array(e)},e.wbg.__wbg_instanceof_Uint8Array_2b3bbecd033d19f6=function(e){let t;try{t=e instanceof Uint8Array}catch{t=!1}return t},e.wbg.__wbg_newwithlength_e9b4878cebadb3d3=function(e){return new Uint8Array(e>>>0)},e.wbg.__wbg_buffer_dd7f74bc60f1faab=function(e){return e.buffer},e.wbg.__wbg_subarray_a1f73cd4b5b42fe1=function(e,t,n){return e.subarray(t>>>0,n>>>0)},e.wbg.__wbg_length_c20a40f15020d68a=function(e){return e.length},e.wbg.__wbg_set_a47bac70306a19a7=function(e,t,n){e.set(t,n>>>0)},e.wbg.__wbindgen_bigint_get_as_i64=function(e,t){let n="bigint"==typeof t?t:void 0;((null===y||0===y.byteLength)&&(y=new BigInt64Array(i.memory.buffer)),y)[e/8+1]=s(n)?BigInt(0):n,u()[e/4+0]=!s(n)},e.wbg.__wbindgen_debug_string=function(e,t){let n=p(h(t),i.__wbindgen_export_0,i.__wbindgen_export_1),r=f;u()[e/4+1]=r,u()[e/4+0]=n},e.wbg.__wbindgen_throw=function(e,t){throw new Error(m(e,t))},e.wbg.__wbindgen_memory=function(){return i.memory},e.wbg.__wbindgen_closure_wrapper2684=function(e,t,n){return function(e,t,n,r){let _={a:e,b:t,cnt:1,dtor:n},o=function(){_.cnt++;let e=_.a;_.a=0;try{for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return r(e,_.b,...n)}finally{0==--_.cnt?(i.__wbindgen_export_3.get(_.dtor)(e,_.b),v.unregister(_)):_.a=e}};return o.original=_,v.register(o,_,_),o}(e,t,359,A)},e.wbg.__wbindgen_init_externref_table=function(){let e=i.__wbindgen_export_2,t=e.grow(4);e.set(0,void 0),e.set(t+0,void 0),e.set(t+1,null),e.set(t+2,!0),e.set(t+3,!1)},e}function B(e,t){return i=e.exports,L.__wbindgen_wasm_module=t,y=null,a=null,c=null,b=null,i.__wbindgen_start(),i}function F(e){if(void 0!==i)return i;let t=R();return e instanceof WebAssembly.Module||(e=new WebAssembly.Module(e)),B(new WebAssembly.Instance(e,t),e)}async function L(e){if(void 0!==i)return i;let t=R();("string"==typeof e||"function"==typeof Request&&e instanceof Request||"function"==typeof URL&&e instanceof URL)&&(e=fetch(e));let{instance:n,module:r}=await async function(e,t){if("function"==typeof Response&&e instanceof Response){if("function"==typeof WebAssembly.instantiateStreaming)try{return await WebAssembly.instantiateStreaming(e,t)}catch(r){if("application/wasm"==e.headers.get("Content-Type"))throw r;console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r)}let n=await e.arrayBuffer();return await WebAssembly.instantiate(n,t)}{let n=await WebAssembly.instantiate(e,t);return n instanceof WebAssembly.Instance?{instance:n,module:e}:n}}(await e,t);return B(n,r)}var H=L,N='"use strict";(()=>{var Se=Object.defineProperty;var Oe=(a,s,o)=>s in a?Se(a,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[s]=o;var x=(a,s,o)=>(Oe(a,typeof s!="symbol"?s+"":s,o),o);var B=class{constructor(s){x(this,"clients");x(this,"id_gen");x(this,"server");x(this,"module");this.clients=new Map,this.id_gen=0,this.module=s,this.server=s._psp_new_server()}make_session(s){let o=this.module._psp_new_session(this.server);return this.clients.set(o,s),new T(this.module,this.server,o,this.clients)}delete(){this.module._psp_delete_server(this.server)}},T=class{constructor(s,o,t,l){this.mod=s;this.server=o;this.client_id=t;this.client_map=l}async handle_request(s){let o=await Be(this.mod,s,async t=>this.mod._psp_handle_request(this.server,this.client_id,t,this.mod._psp_is_memory64()?BigInt(s.byteLength):s.byteLength));await me(this.mod,o,async t=>{await this.client_map.get(t.client_id)(t.data)})}poll(){let s=this.mod._psp_poll(this.server);me(this.mod,s,async o=>{await this.client_map.get(o.client_id)(o.data)})}close(){this.mod._psp_close_session(this.server,this.client_id)}};async function Be(a,s,o){let t=a._psp_alloc(a._psp_is_memory64()?BigInt(s.byteLength):s.byteLength);a.HEAPU8.set(s,Number(t));let l=await o(t);return a._psp_free(t),l}async function me(a,s,o){let t=a._psp_is_memory64(),l=new DataView(a.HEAPU8.buffer,Number(s),t?12:8),m=l.getUint32(0,!0),M=t?l.getBigInt64(4,!0):l.getUint32(4,!0),c=new DataView(a.HEAPU8.buffer,Number(M),m*(t?16:12));try{for(let p=0;p<m;p++){let[g,v,H]=t?[c.getBigInt64(p*16,!0),c.getInt32(p*16+8,!0),c.getInt32(p*16+12,!0)]:[c.getInt32(p*12,!0),c.getInt32(p*12+4,!0),c.getInt32(p*12+8,!0)],b=new Uint8Array(a.HEAPU8.buffer,Number(g),v);await o({client_id:H,data:b})}}finally{for(let p=0;p<m;p++){let g=t?c.getBigInt64(p*16,!0):c.getInt32(p*12,!0);a._psp_free(g)}a._psp_free(t?BigInt(c.byteOffset):c.byteOffset),a._psp_free(t?BigInt(l.byteOffset):l.byteOffset)}}var de={},Ne=(()=>{var a=de.url;return function(s={}){var o,t=Object.assign({},s),l,m,M=new Promise((e,r)=>{l=e,m=r});globalThis.window={};var c=Object.assign({},t),p="";typeof document<"u"&&document.currentScript&&(p=document.currentScript.src),a&&(p=a),p.startsWith("blob:")?p="":p=p.substr(0,p.replace(/[?#].*/,"").lastIndexOf("/")+1);var g=console.log.bind(console),v=console.error.bind(console);Object.assign(t,c),c=null;var H,b=!1,k,A,I,d,C,D;function G(){var e=H.buffer;t.HEAP8=k=new Int8Array(e),t.HEAP16=new Int16Array(e),t.HEAPU8=A=new Uint8Array(e),t.HEAPU16=new Uint16Array(e),t.HEAP32=I=new Int32Array(e),t.HEAPU32=d=new Uint32Array(e),t.HEAPF32=new Float32Array(e),t.HEAPF64=D=new Float64Array(e),t.HEAP64=C=new BigInt64Array(e),t.HEAPU64=new BigUint64Array(e)}var we=[],ge=[],be=[],Ae=[],V=!1,P=0,N=null,E=null;function q(e){throw e="Aborted("+e+")",v(e),b=!0,e+=". Build with -sASSERTIONS for more info.",V&&oe(),e=new WebAssembly.RuntimeError(e),m(e),e}var J=e=>e.startsWith("data:application/octet-stream;base64,"),h;if(t.locateFile){if(h="perspective-server.wasm",!J(h)){var K=h;h=t.locateFile?t.locateFile(K,p):p+K}}else h=new URL("perspective-server.wasm",de.url).href;function Q(){throw"both async and sync fetching of the wasm failed"}function Pe(e){return typeof fetch=="function"?fetch(e,{credentials:"same-origin"}).then(r=>{if(!r.ok)throw`failed to load wasm binary file at \'${e}\'`;return r.arrayBuffer()}).catch(()=>Q()):Promise.resolve().then(()=>Q())}function X(e,r,n){return Pe(e).then(i=>WebAssembly.instantiate(i,r)).then(n,i=>{v(`failed to asynchronously prepare wasm: ${i}`),q(i)})}function Ee(e,r){var n=h;return typeof WebAssembly.instantiateStreaming!="function"||J(n)||typeof fetch!="function"?X(n,e,r):fetch(n,{credentials:"same-origin"}).then(i=>WebAssembly.instantiateStreaming(i,e).then(r,function(u){return v(`wasm streaming compile failed: ${u}`),v("falling back to ArrayBuffer instantiation"),X(n,e,r)}))}var Ue={971088:()=>typeof wasmOffsetConverter<"u"};function Y(e){this.name="ExitStatus",this.message=`Program terminated with exit(${e})`,this.status=e}var S=e=>{for(;0<e.length;)e.shift()(t)},Z=new TextDecoder("utf8"),ee=e=>{if(e>>>=0,!e)return"";for(var r=e+NaN,n=e;!(n>=r)&&A[n>>>0];)++n;return Z.decode(A.subarray(e>>>0,n>>>0))},te=e=>{e=e.getArg(_.__cpp_exception,0);var r=ce(e);e=_e();var n=F(4),i=F(4);if(le(r,n,i),r=d[n>>>2>>>0],i=d[i>>>2>>>0],n=ee(r),R(r),i){var u=ee(i);R(i)}return pe(e),[n,u]};t.getExceptionMessage=te;var re;re=()=>performance.now();var W=[],j={},ne=()=>{if(!L){var e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:"./this.program"},r;for(r in j)j[r]===void 0?delete e[r]:e[r]=j[r];var n=[];for(r in e)n.push(`${r}=${e[r]}`);L=n}return L},L,xe=[null,[],[]],se=e=>{throw b=!0,new Y(e)},ie={HaveOffsetConverter:function(){return typeof wasmOffsetConverter<"u"},__syscall_ftruncate64:function(){},__syscall_getdents64:function(){},__throw_exception_with_stack_trace:e=>{throw e=new WebAssembly.Exception(_.__cpp_exception,[e],{traceStack:!0}),e.message=te(e),e},clock_time_get:function(e,r,n){if(n>>>=0,e!=0&&e!=1&&e!=2&&e!=3)return 28;var i;return e===0?i=Date.now():i=re(),e=Math.round(1e6*i),I[n>>>2>>>0]=e>>>0,I[n+4>>>2>>>0]=e/Math.pow(2,32)>>>0,0},emscripten_asm_const_int:function(e,r,n){e>>>=0,r>>>=0,n>>>=0,W.length=0;for(var i;i=A[r++>>>0];){var u=i!=105;u&=i!=112,n+=u&&n%8?4:0,W.push(i==112?d[n>>>2>>>0]:i==106?C[n>>>3]:i==105?I[n>>>2>>>0]:D[n>>>3>>>0]),n+=u?8:4}return Ue[e](...W)},emscripten_notify_memory_growth:function(){G()},environ_get:function(e,r){e>>>=0,r>>>=0;var n=0;return ne().forEach((i,u)=>{var y=r+n;for(u=d[e+4*u>>>2>>>0]=y,y=0;y<i.length;++y)k[u++>>>0]=i.charCodeAt(y);k[u>>>0]=0,n+=i.length+1}),0},environ_sizes_get:function(e,r){e>>>=0,r>>>=0;var n=ne();d[e>>>2>>>0]=n.length;var i=0;return n.forEach(u=>i+=u.length+1),d[r>>>2>>>0]=i,0},fd_close:()=>52,fd_read:function(){return 52},fd_seek:function(){return 70},fd_write:function(e,r,n,i){r>>>=0,n>>>=0,i>>>=0;for(var u=0,y=0;y<n;y++){var ke=d[r>>>2>>>0],fe=d[r+4>>>2>>>0];r+=8;for(var z=0;z<fe;z++){var f=A[ke+z>>>0],w=xe[e];if(f===0||f===10){f=0,f>>>=0;for(var Ie=f+NaN,U=f;w[U]&&!(U>=Ie);)++U;f=Z.decode(w.buffer?w.subarray(f,U):new Uint8Array(w.slice(f,U))),(e===1?g:v)(f),w.length=0}else w.push(f)}u+=fe}return d[i>>>2>>>0]=u,0},proc_exit:se,psp_heap_size:function(){q("missing function: psp_heap_size")}},_=function(){function e(n){return _=n.exports,_=Me(),H=_.memory,G(),P--,P==0&&(N!==null&&(clearInterval(N),N=null),E&&(n=E,E=null,n())),_}var r={env:ie,wasi_snapshot_preview1:ie};if(P++,t.instantiateWasm)try{return t.instantiateWasm(r,e)}catch(n){v(`Module.instantiateWasm callback failed with error: ${n}`),m(n)}return Ee(r,function(n){e(n.instance)}).catch(m),{}}();t._psp_new_server=()=>(t._psp_new_server=_.psp_new_server)(),t._psp_handle_request=(e,r,n,i)=>(t._psp_handle_request=_.psp_handle_request)(e,r,n,i),t._psp_poll=e=>(t._psp_poll=_.psp_poll)(e),t._psp_new_session=e=>(t._psp_new_session=_.psp_new_session)(e),t._psp_close_session=(e,r)=>(t._psp_close_session=_.psp_close_session)(e,r),t._psp_alloc=e=>(t._psp_alloc=_.psp_alloc)(e),t._psp_free=e=>(t._psp_free=_.psp_free)(e);var R=e=>(R=_.free)(e);t._psp_delete_server=e=>(t._psp_delete_server=_.psp_delete_server)(e),t._psp_is_memory64=()=>(t._psp_is_memory64=_.psp_is_memory64)();var ae=t.__initialize=()=>(ae=t.__initialize=_._initialize)(),oe=()=>(oe=_.__trap)(),pe=e=>(pe=_._emscripten_stack_restore)(e),F=e=>(F=_._emscripten_stack_alloc)(e),_e=()=>(_e=_.emscripten_stack_get_current)(),ce=e=>(ce=_.__thrown_object_from_unwind_exception)(e),le=(e,r,n)=>(le=_.__get_exception_message)(e,r,n);t.___start_em_js=971145,t.___stop_em_js=971206;function Me(){var e=_;return e=Object.assign({},e),e._emscripten_stack_alloc=(r=>n=>r(n)>>>0)(e._emscripten_stack_alloc),e.emscripten_stack_get_current=(r=>()=>r()>>>0)(e.emscripten_stack_get_current),e}var O;E=function e(){O||ue(),O||(E=e)};function ue(){if(!(0<P||(S(we),0<P||O||(O=!0,t.calledRun=!0,b)))){if(V=!0,S(ge),S(be),l(t),He){var e=ae;try{e(),se(0)}catch(r){if(!(r instanceof Y||r=="unwind"))throw r}}S(Ae)}}var He=!0;return ue(),o=M,o}})(),ve=Ne;async function ye(a){let s=await ve({locateFile(o){return o},instantiateWasm:async(o,t)=>{o.env={...o.env,psp_stack_trace(){let m=Error().stack||"",c=new TextEncoder().encode(m),p=s._psp_alloc(s._psp_is_memory64()?BigInt(c.byteLength+1):c.byteLength+1);return s.HEAPU8.set(c,Number(p)),s.HEAPU8[Number(p)+c.byteLength]=0,p},psp_heap_size(){return s.HEAP8.buffer.byteLength}};let l=await WebAssembly.instantiate(a,o);return t(l.instance),l.instance.exports}});return s}var he,$;self.addEventListener("message",async a=>{if(a.data.cmd==="init"){let s=a.data.id,o=await ye(a.data.args[0]);he=new B(o),$=he.make_session(async t=>{let l=t.slice().buffer;self.postMessage(l,{transfer:[l]})}),self.postMessage({id:s})}else $.handle_request(new Uint8Array(a.data)),setTimeout(()=>$.poll())});})();\n';function T(e,t){return{addEventListener:function(t,n){e.push(n)},removeEventListener:function(t){let n=e.indexOf(t);n>-1&&e.splice(n,1)},postMessage:function(e){for(let n of t)n({data:e})},location:{href:""}}}var z,q,C=async function(){try{if(window.location.protocol.startsWith("file"))return console.warn("file:// protocol does not support Web Workers"),function(e){console.error("Running perspective in single-threaded mode");let t=[],n=[];return Function("const self = arguments[0];"+e)(T(t,n)),T(n,t)}(N);{let e=new Blob([N],{type:"application/javascript"}),t=URL.createObjectURL(e);return new Worker(t,{type:"module"})}}catch(e){console.error("Error instantiating engine",e)}};function $(){let e,t=new Promise((t=>{e=t}));return[e,t]}async function D(e,t){let[n,r]=await Promise.all([t,C()]),{Client:_}=await e,i=new _((e=>{let t=e.slice().buffer;r.postMessage(t,{transfer:[t]})}),(()=>{console.debug("Closing WebWorker"),r.terminate()}));return await async function(e,t){let[n,r]=$();e.addEventListener("message",(function t(r){e.removeEventListener("message",t),n(null)})),e.postMessage({cmd:"init",args:[t]},{transfer:t instanceof WebAssembly.Module?[]:[t]}),await r}(r,n),r.addEventListener("message",(e=>{i.handle_response(e.data)})),await i.init(),i}if(typeof WebAssembly>"u")throw new Error("WebAssembly not supported.");async function V(e){e instanceof Function&&(e=await e());let t=await async function(e){return e instanceof Response?(await WebAssembly.instantiateStreaming(e)).instance.exports:e instanceof WebAssembly.Module?(await WebAssembly.instantiate(e)).exports:e instanceof WebAssembly.Instance?e.exports:e instanceof ArrayBuffer?(await WebAssembly.instantiate(e)).instance.exports:e}(e);try{let e=t.size(),n=t.offset();return new Uint8Array(t.memory.buffer).slice(n,n+e)}catch{return console.warn("Stage 0 wasm loading failed, skipping"),new Uint8Array(e)}}function J(e,t){void 0===t&&(t=!1),z=e instanceof Uint8Array?Promise.resolve(e.buffer):e instanceof Response?e.arrayBuffer():e instanceof Promise?e.then((e=>e instanceof Response?e.arrayBuffer():e)):Promise.resolve(e),t||(z=z.then((e=>V(e).then((e=>e.buffer)))))}async function G(e,t){void 0===t&&(t=!1);let n=t?e:await V(e);return await H(n),await k(),_}function K(e,t){void 0===t&&(t=!1),e instanceof Uint8Array?q=G(e.buffer,t):e instanceof ArrayBuffer?q=G(e,t):e instanceof Response?q=e.arrayBuffer().then((e=>G(e,t))):e instanceof Promise?q=e.then((e=>e instanceof ArrayBuffer?G(e,t):e instanceof Response?e.arrayBuffer().then((e=>G(e,t))):e)):e instanceof Object&&(q=Promise.resolve(e))}function Q(){let e=customElements.get("perspective-viewer");if(e)q=Promise.resolve(e.__wasm_module__);else if(void 0===q)throw new Error("Missing perspective-client.wasm");return q}async function X(e){return await async function(e,t){let n=new WebSocket(t),[r,_]=$();n.onopen=r,n.binaryType="arraybuffer",await _;let{Client:i}=await e,o=new i((e=>{let t=e.slice().buffer;n.send(t)}),(()=>{console.debug("Closing WebSocket"),n.close()}));return n.onmessage=e=>{o.handle_response(e.data)},await o.init(),o}(Q(),e)}async function Y(){return await D(Q(),function(){if(void 0===z)throw new Error("Missing perspective-server.wasm");return z.then((e=>e instanceof WebAssembly.Module?e:e.slice(0)))}())}var Z={websocket:X,worker:Y,init_client:K,init_server:J}}}]);