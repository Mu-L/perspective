import"https://cdn.jsdelivr.net/npm/@finos/perspective-viewer@3.2.1/dist/cdn/perspective-viewer.js";import"https://cdn.jsdelivr.net/npm/@finos/perspective-viewer-datagrid@3.2.1/dist/cdn/perspective-viewer-datagrid.js";import"https://cdn.jsdelivr.net/npm/@finos/perspective-viewer-d3fc@3.2.1/dist/cdn/perspective-viewer-d3fc.js";import e from"https://cdn.jsdelivr.net/npm/@finos/perspective@3.2.1/dist/cdn/perspective.js";const t=document.getElementById("canvas"),i=t.getContext("2d",{willReadFrequently:!0}),n=document.getElementById("video"),a=t.width,r=t.height,o=await e.worker();async function s(e,t){i.drawImage(n,0,0,a,r);const o=i.getImageData(0,0,a,r);for(let i=0;i<o.data.byteLength/4;i++){const e=255-(.21*o.data[4*i]+.72*o.data[4*i+1]+.07*o.data[4*i+2]);t.color[i]=e}await e.update(t),setTimeout((()=>s(e,t)),50)}const c=[async function(){if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){const e=await navigator.mediaDevices.getUserMedia({video:!0});n.srcObject=e,n.play()}const e={index:[],color:[]};for(let i=0;i<a*r;i++)e.index[i]=i,e.color[i]=0;const t=await o.table(e,{index:"index"});return s(t,e),t}(),async function(){const e=await fetch("layouts.json");return await e.json()}()],[d,l]=await Promise.all(c),p=!/(iPad|iPhone|iPod)/g.test(navigator.userAgent),v=document.querySelector("select"),g=document.querySelector("perspective-viewer");g.load(d),await g.restore({settings:p,...l[0]});const m=document.querySelector("perspective-viewer-datagrid").shadowRoot.querySelector("regular-table");m.scrollTop=m.scrollHeight/2-m.clientHeight/2,m.scrollLeft=m.scrollWidth/2-m.clientWidth/2;for(const u of l){const e=document.createElement("option");e.value=u.title,e.textContent=u.title,v.appendChild(e)}v.addEventListener("change",(async e=>{const t=l.find((t=>t.title===e.target.value));await g.restore(t)}));