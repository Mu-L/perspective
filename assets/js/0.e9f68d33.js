(self.webpackChunk_finos_perspective_docs=self.webpackChunk_finos_perspective_docs||[]).push([[0],{6e3:(e,t,n)=>{n.r(t);var a=n(6635),l=n(797),r=n(7680),i=n(9662),o=n(4469),s=n(5301),c=Object.defineProperty,u=(e,t)=>{for(var n in t)c(e,n,{get:t[n],enumerable:!0})};Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=function(e){var t=this;do{if(t.matches(e))return t;t=t.parentElement||t.parentNode}while(null!==t&&1===t.nodeType);return null});var h="none",d="ordinal",g="time",p="linear",m=e=>{let t="crossValues",n=null,a=null,l=()=>{let l=a=>{let l=n?e[t].filter((e=>n==e.name)):e[t];return!("crossValues"==t&&l.length>1)&&l.some((e=>a.includes(e.type)))};return 0===e[t].length?h:a!=g&&l(["datetime","date"])?g:a!=p&&l(["integer","float"])||a==d?p:d};return l.settingName=function(){return arguments.length?(t=arguments.length<=0?void 0:arguments[0],l):t},l.settingValue=function(){return arguments.length?(n=arguments.length<=0?void 0:arguments[0],l):n},l.excludeType=function(){return arguments.length?(a=arguments.length<=0?void 0:arguments[0],l):a},l},f={};u(f,{domain:()=>b,labelFunction:()=>w,scale:()=>x});var y=e=>Array.isArray(e)?e.flat(1/0):[e],v=e=>{let t=t=>e(t);return(0,a.qz)(t,e),t.bandwidth=function(){return arguments.length?(e.bandwidth(...arguments),t):Math.max(e.bandwidth(),1)},t},x=()=>(e=>{let t=t=>e(t);return(0,a.qz)(t,e),t.ticks=function(){return[]},t})(v(l.WH())),b=()=>{let e=["crossValue"],t="horizontal",n=t=>{let n=y(t);return a([...new Set(n.map((t=>t[e[0]])))])},a=e=>"vertical"==t?e.reverse():e;return n.valueName=function(){return arguments.length?(e=[arguments.length<=0?void 0:arguments[0]],n):e[0]},n.valueNames=function(){return arguments.length?(e=arguments.length<=0?void 0:arguments[0],n):e},n.orient=function(){return arguments.length?(t=arguments.length<=0?void 0:arguments[0],n):t},n},w=e=>t=>t[e].join("|"),V={};u(V,{component:()=>T,domain:()=>L,labelFunction:()=>N,scale:()=>M,tickFormatFunction:()=>$});var _=()=>{let e=[0,0],t="percent",n=n=>{switch(t){case"domain":n[0]-=e[0],n[1]+=e[1];break;case"percent":{let t=n[1]-n[0];n[0]-=e[0]*t,n[1]+=e[1]*t;break}default:throw new Error("Unknown padUnit: "+t)}return n};return n.pad=function(){return arguments.length?(e=arguments.length<=0?void 0:arguments[0],n):e},n.padUnit=function(){return arguments.length?(t=arguments.length<=0?void 0:arguments[0],n):t},n},k=function(e){if(Array.isArray(e)){let t=Array(e.length);for(let n=0;n<e.length;n++)t[n]=e[n];return t}return Array.from(e)},S=(e,t)=>{let n=Math.ceil(Math.abs(Math.log10(t-e)))+1;return e=>Math.abs(e)>=1e7?l.GPZ(".3s")(e):Number.isInteger(e)?l.GPZ(",.0f")(e):l.GPZ(`,.${n}f`)(e)};function z(e){return e.getRootNode().host}function A(e){return e.closest("#container.chart")}var M=()=>l.m4Y(),L=()=>{let e=function(){let e=[function(e){return e}],t=null,n=[],a=_(),l=function(l){let o,s=new Array(l.length),c=!0,u=!1,h=e[Symbol.iterator]();try{for(let e;!(c=(e=h.next()).done);c=!0){let t=e.value;for(let e=0;e<l.length;e++){let n=t(l[e],e);Array.isArray(n)?s.push.apply(s,k(n)):s.push(n)}}}catch(g){u=!0,o=g}finally{try{!c&&h.return&&h.return()}finally{if(u)throw o}}let d=[r.A(s),i.A(s)];if(d[0]=null==d[0]?r.A(n):r.A([d[0]].concat(k(n))),d[1]=null==d[1]?i.A(n):i.A([d[1]].concat(k(n))),null!=t){let e=Math.max(Math.abs(d[1]-t),Math.abs(d[0]-t));d[0]=t-e,d[1]=t+e}return a(d)};return l.accessors=function(){return arguments.length?(e=arguments.length<=0?void 0:arguments[0],l):e},l.pad=function(){return arguments.length?(a.pad(arguments.length<=0?void 0:arguments[0]),l):a.pad},l.padUnit=function(){return arguments.length?(a.padUnit(arguments.length<=0?void 0:arguments[0]),l):a.padUnit},l.include=function(){return arguments.length?(n=arguments.length<=0?void 0:arguments[0],l):n},l.symmetricalAbout=function(){return arguments.length?(t=arguments.length<=0?void 0:arguments[0],l):t},l.paddingStrategy=function(){return arguments.length?(a=arguments.length<=0?void 0:arguments[0],l):a},l}().pad([0,.1]).padUnit("percent"),t=["crossValue"],n=n=>(e.accessors(t.map((e=>t=>parseFloat(t[e])))),l(y(n)));a.qz(n,e);let l=n=>{if("domain"==e.padUnit()){let a=(e=>{let n=t.map((t=>e.map((e=>e[t])).sort(((e,t)=>e-t)).filter(((e,t,n)=>0===t||e!==n[t-1])).reduce(((e,t,n,a)=>0===n||e<=t-a[n-1]?e:Math.abs(t-a[n-1])))));return Math.min(...n)})(n);return e.pad([a/2,a/2])(n)}return e(n)};return n.valueName=function(){return arguments.length?(t=[arguments.length<=0?void 0:arguments[0]],n):t[0]},n.valueNames=function(){return arguments.length?(t=arguments.length<=0?void 0:arguments[0],n):t},n},N=e=>t=>t[e][0],$=S,T=e=>{let t=null,n="horizontal",r=null,i=(e,t)=>{let a=e.getBoundingClientRect();t.each(((e,t,r)=>{let i=l.Ltv(r[t]).node().getBoundingClientRect();("vertical"==n&&a.width<i.width||"horizontal"==n&&a.height<i.height)&&(e=>{l.Ltv(e).select("text").node().style.fontSize="80%"})(r[t])}))},o=(e,t,n)=>{let a=((e,t)=>{try{return A(e.node()).querySelector(".cartesian-chart").querySelector(`.${t}-axis`)}catch{return null}})(e,t);a&&i(a,e)},s=()=>({bottom:a.l7,left:a.V4,top:a.tl,right:a.eH,decorate:o});return s.domain=function(){return arguments.length?(t=arguments.length<=0?void 0:arguments[0],s):t},s.orient=function(){return arguments.length?(n=arguments.length<=0?void 0:arguments[0],s):n},s.settingName=function(){return arguments.length?(r=arguments.length<=0?void 0:arguments[0],s):r},s},P={};u(P,{domain:()=>C,labelFunction:()=>R,scale:()=>E});var E=()=>l.w7C(),C=()=>{let e=a.M3(),t=["crossValue"],n=n=>(e.accessors(t.map((e=>t=>new Date(t[e])))),l(y(n)));a.qz(n,e,a.HN("include","paddingStrategy"));let l=n=>{let a=Math.abs((e=>{let n=t.map((t=>e.map((e=>new Date(e[t]).getTime())).sort(((e,t)=>e-t)).filter(((e,t,n)=>0===t||e!==n[t-1])).reduce(((e,t,n,a)=>0===n||Math.abs(e)<=Math.abs(t-a[n-1])?Math.abs(e):Math.abs(t-a[n-1])))));return Math.min(...n)})(n));return e.padUnit("domain").pad([a/2,a/2])(n)};return n.valueName=function(){return arguments.length?(t=[arguments.length<=0?void 0:arguments[0]],n):t[0]},n.valueNames=function(){return arguments.length?(t=arguments.length<=0?void 0:arguments[0],n):t},n},R=e=>t=>new Date(t[e][0]),O={};u(O,{component:()=>Y,domain:()=>F,labelFunction:()=>q,scale:()=>I});var H=(e,t,n)=>{let r=6,i=6,o=function(){let e={},t=t=>{for(let n of Object.keys(e))t[n](e[n]);return t};for(var n=arguments.length,a=new Array(n),l=0;l<n;l++)a[l]=arguments[l];for(let r of a)t[r]=function(){return arguments.length?(e[r]=arguments.length<=0?void 0:arguments[0],t):e[r]};return t}("tickFormat","ticks","tickArguments","tickValues","tickPadding"),s=function(){},c=null,u=(0,a.d8)("g","group"),h=(0,a.d8)("path","domain"),d=(e,t)=>g()?`translate(${t}, ${e})`:`translate(${e}, ${t})`,g=()=>"left"===e||"right"===e,p=a=>{c?a.each(((a,p,f)=>{let y=f[p],v=(0,l.Ltv)(y),x="bottom"===e||"right"===e?1:-1,b=n.range(),w=(e=>g()?e.map((e=>[e[1],e[0]])):e)([[b[0],x*r],[b[0],0],[b[1],0],[b[1],x*r]]);h(v,[a]).attr("d",(0,l.n8j)()(w)).attr("stroke","#000").attr("fill","none");let V=u(v,c),_=e=>Array.isArray(i)?i[e]:i,k=e=>{let t=0;for(let n=0;n<e;n++)t+=_(n);return t};V.attr("transform",((e,t)=>d(0,x*k(t)))).each(((e,a,r)=>{let i=(0,l.Ltv)(r[a]),c=m(n,e);o(t(c)).decorate(((e,t)=>s(e,t,a))).tickSizeInner(_(a)).tickOffset((e=>c.step(e)/2))(i),i.select("path.domain").attr("visibility","hidden")})),V.exit().attr("transform",((e,t)=>d(0,x*k(t))))})):o(t(n).decorate(s))(a)},m=(e,t)=>{function n(t){let n=t.domain;return n.reduce(((t,n)=>t+e(n)),0)/n.length}return n.ticks=()=>t,n.tickFormat=()=>e=>e.text,n.copy=()=>m(e,t),n.step=t=>t.domain.length*e.step(),(0,a.qz)(n,e,(0,a.HN)("ticks","step","copy")),n};return p.tickSize=function(){return arguments.length?(i=r=Number(arguments.length<=0?void 0:arguments[0]),p):i},p.tickSizeInner=function(){return arguments.length?(i=Array.isArray(arguments.length<=0?void 0:arguments[0])?arguments.length<=0?void 0:arguments[0]:Number(arguments.length<=0?void 0:arguments[0]),p):i},p.tickSizeOuter=function(){return arguments.length?(r=Number(arguments.length<=0?void 0:arguments[0]),p):r},p.decorate=function(){return arguments.length?(s=arguments.length<=0?void 0:arguments[0],p):s},p.groups=function(){return arguments.length?(c=arguments.length<=0?void 0:arguments[0],p):c},(0,a.qz)(p,o),p},B=e=>H("top",a.c1,e),D=e=>H("bottom",a.C1,e),W=e=>H("left",a.qU,e),j=e=>H("right",a.ly,e),I=()=>v(l.WH()).padding(.5),F=()=>{let e=["crossValue"],t="horizontal",n=t=>{let n=y(t);return a([...Array.from(new Set(n.map((t=>t[e[0]]))))])},a=e=>"vertical"==t?e.reverse():e;return n.valueName=function(){return arguments.length?(e=[arguments.length<=0?void 0:arguments[0]],n):e[0]},n.valueNames=function(){return arguments.length?(e=arguments.length<=0?void 0:arguments[0],n):e},n.orient=function(){return arguments.length?(t=arguments.length<=0?void 0:arguments[0],n):t},n},q=(e,t)=>n=>n[e].map(((e,n)=>{let a=t.crossValues[n].type;return"datetime"===a?new Date(e).toLocaleString(void 0,{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric",fractionalSecondDigits:3}):"date"===a?new Date(e).toLocaleDateString():e})).join("|"),Y=e=>{let t="horizontal",n="crossValues",r=null,i=()=>{let a=e[n].length>1,l=s(r),i=l.map(c),h=a?i.map((e=>e.size)):i[0].size,g=i.reduce(((e,t)=>e+t.size),0),p=e=>n=>{let r=e(n);return a&&r.groups(l).tickSizeInner(h).tickSizeOuter(g),"horizontal"!==t&&r.tickPadding(10),r},m=o(a);return{bottom:p(m.bottom),left:p(m.left),right:p(m.right),top:p(m.top),size:`${g+10}px`,decorate:(e,n,a)=>{let l=i[a].rotation;"horizontal"===t&&d(e,l),u(e,l)}}},o=e=>e?{bottom:D,left:W,top:B,right:j}:{bottom:a.C1,left:a.qU,top:a.c1,right:a.ly},s=e=>{let t=[];return e.forEach((e=>{(e&&e.split?e.split("|"):[e]).forEach(((n,a)=>{for(;t.length<=a;)t.push([]);let l=t[a];l.length>0&&l[l.length-1].text===n?l[l.length-1].domain.push(e):l.push({text:n,domain:[e]})}))})),t.reverse()},c=n=>{let a=e.size.width,l=Math.max(...n.map((e=>e.text?e.text.length:0)));return"horizontal"===t?n&&16*n.length>a-100?{size:5*l+10,rotation:90}:n&&n.length*(6*l+10)>a-100?{size:3*l+20,rotation:45}:{size:25,rotation:0}:{size:5*l+10,rotation:0}},u=(e,n)=>{let a=n?(e,t)=>e.x+e.width+14>t.x+t.width:(e,t)=>e.x<=t.x+t.width&&t.x<=e.x+e.width&&e.y<=t.y+t.height&&t.y<=e.y+e.height,r="horizontal"==t?h(e):null,i=[];e.each(((e,t,n)=>{let o=l.Ltv(n[t]),s=(e=>{let t=-1!==e.indexOf(",")?",":" ",n=e.substring(e.indexOf("(")+1,e.indexOf(")")).split(t).map((e=>parseInt(e)));for(;n.length<2;)n.push(0);return n})(o.attr("transform")),c=o.node().getBBox(),u={x:c.x+s[0],y:c.y+s[1],width:c.width,height:c.height},h=i.some((e=>a(e,u)))||r&&!((e,t)=>e.x>=t.x&&e.x+e.width<=t.x+t.width&&e.y>=t.y&&e.y+e.height<=t.y+t.height)(u,r);o.attr("visibility",h?"hidden":""),h||i.push(u)}))},h=e=>{let t=A(e.node());if(null===t)return;let n=t.querySelector(".cartesian-chart"),a=n.querySelector(".x-axis"),l=n.getBoundingClientRect(),r=a.getBoundingClientRect();return{x:l.left-r.left,width:l.width,y:l.top-r.top,height:l.height}},d=(e,t)=>{let n=(e=>e?e<60?`rotate(-${e} 5 5)`:`rotate(-${e} 3 7)`:"translate(0, 8)")(t),a=t?"end":"";e.each(((e,t,r)=>{l.Ltv(r[t]).select("text").attr("transform",n).style("text-anchor",a)}))};return i.orient=function(){return arguments.length?(t=arguments.length<=0?void 0:arguments[0],i):t},i.settingName=function(){return arguments.length?(n=arguments.length<=0?void 0:arguments[0],i):n},i.domain=function(){return arguments.length?(r=arguments.length<=0?void 0:arguments[0],i):r},i},U={none:f,ordinal:O,time:P,linear:V},K=e=>{let t,n=null,l="horizontal",r="crossValues",i=["crossValue"],o=null,s=null,c=["include","paddingStrategy","pad"],u={},h=a=>{let h=m(e).excludeType(n).settingName(r).settingValue(t)(),p=U[h],f=p.domain().valueNames(i);c.forEach((e=>{u[e]&&f[e]&&f[e](u[e])})),f.orient&&f.orient(l);let y=f(a);null!==o&&(y=o(y)),s&&"number"==typeof y[0]&&(s[0]=y[0]=Math.min(y[0],s[0]),s[1]=y[1]=Math.max(y[1],s[1]));let v=p.hasOwnProperty("component")?d(p,y,a):g(),x=p==V?$(y[0],y[1]):void 0;return{scale:p.scale(),domain:y,domainFunction:f,labelFunction:p.labelFunction,component:{bottom:v.bottom,left:v.left,top:v.top,right:v.right},size:v.size,decorate:v.decorate,label:e[r].map((e=>e.name)).join(", "),tickFormatFunction:x}},d=(t,n,a)=>t.component(e).orient(l).settingName(r).domain(n)(a),g=()=>({bottom:a.l7,left:a.V4,top:a.tl,right:a.eH,decorate:()=>{}});return h.memoValue=function(){return arguments.length?(s=arguments.length<=0?void 0:arguments[0],h):s},h.excludeType=function(){return arguments.length?(n=arguments.length<=0?void 0:arguments[0],h):n},h.orient=function(){return arguments.length?(l=arguments.length<=0?void 0:arguments[0],h):l},h.settingName=function(){return arguments.length?(r=arguments.length<=0?void 0:arguments[0],h):r},h.settingValue=function(){return arguments.length?(t=arguments.length<=0?void 0:arguments[0],h):t},h.valueName=function(){return arguments.length?(i=[arguments.length<=0?void 0:arguments[0]],h):i[0]},h.valueNames=function(){return arguments.length?(i=arguments.length<=0?void 0:arguments[0],h):i},h.modifyDomain=e=>e?(o=e,h):o,c.forEach((e=>{h[e]=function(){return arguments.length?(u[e]=arguments.length<=0?void 0:arguments[0],h):u[e]}})),h},X=(e,t)=>Z(e,t,((e,t)=>e.svgPlotArea(t)),!1),G=(e,t)=>Z(e,t,((e,t)=>e.canvasPlotArea(t).svgPlotArea(a.s9())),!0),Z=(e,t,n,r)=>{let i=null,o=null,s=a.jo({xScale:e.scale,yScale:t.scale,xAxis:e.component,yAxis:t.component}).xDomain(e.domain).xLabel(e.label).xAxisHeight(e.size).xDecorate(e.decorate).xTickFormat(e.tickFormatFunction).yDomain(t.domain).yLabel(t.label).yAxisWidth(t.size).yDecorate(t.decorate).yOrient("left").yTickFormat(t.tickFormatFunction);e.decorate&&s.xDecorate(e.decorate),t.decorate&&s.yDecorate(t.decorate),s.xPaddingInner&&s.xPaddingInner(1),s.xPaddingOuter&&s.xPaddingOuter(.5),s.yPaddingInner&&s.yPaddingInner(1),s.yPaddingOuter&&s.yPaddingOuter(.5),s.axisSplitter=function(){return arguments.length?(i=arguments.length<=0?void 0:arguments[0],s):i},s.altAxis=function(){return arguments.length?(o=arguments.length<=0?void 0:arguments[0],s):o},s.plotArea=function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return 0==t.length?r?this.canvasPlotArea():this.svgPlotArea():n(this,...t)};let c=s.decorate();return s.decorate(((n,u)=>{let h=n.select("d3fc-svg.plot-area"),d=h.select("svg").node();d.setAttribute("viewBox",`0 0 ${h.node().clientWidth} ${h.node().clientHeight}`),d.setAttribute("preserveAspectRatio","none");for(let e of["x-axis","y-axis"])n.select(`d3fc-svg.${e} svg`).node().setAttribute("preserveAspectRatio","none");if(c(n,u),r){let e=n.select(".svg-plot-area").node(),t=n.select(".canvas-plot-area").node();l.Ubm([e,t]).order()}if(i){if(i.haveSplit()){let c=i.altData(),h=a.d8("d3fc-svg","y2-axis").key((e=>e)),d=a.d8("g","y-series").key((e=>e));n.append("div").attr("class","y-label right-label").style("grid-column",5).style("-ms-grid-column",5).style("grid-row",3).style("-ms-grid-row",3).style("width",o.size||"1em").style("display","flex").style("align-items","center").style("justify-content","center").append("span").attr("class","y-label splitter-label").style("transform","rotate(-90deg)");let g=o.scale.domain(o.domain),p=o.component.right(g);if(p.tickFormat(o.tickFormatFunction),o.decorate&&p.decorate(o.decorate),h(n,["right"]).attr("class",(e=>`y-axis ${e}-axis`)).on("measure",(function(e,t){let{width:n,height:a}=e.detail;"left"===t&&l.Ltv(e.currentTarget).select("svg").attr("viewBox",`${-n} 0 ${n} ${a}`).attr("preserveAspectRatio","none"),g.range([a,0])})).on("draw",(function(e,t){l.Ltv(e.currentTarget).select("svg").call(p)})),r){let a=n=>{let a=s.plotArea();a.context(n.node().getContext("2d")).xScale(e.scale);let l=[t.scale,g];[u,c].forEach(((e,t)=>{a.yScale(l[t]),a(e)}))};n.select("d3fc-canvas.plot-area").on("draw",(function(e,t){a(l.Ltv(e.currentTarget).select("canvas"))}))}else{let a=function(n){let a=s.plotArea();a.xScale(e.scale);let r=[t.scale,g];d(n,[u,c]).each(((e,t,n)=>{a.yScale(r[t]),l.Ltv(n[t]).datum(e).call(a)}))};n.select("d3fc-svg.plot-area").on("draw",(function(e,t){a(l.Ltv(e.currentTarget).select("svg"))}))}}i(n)}})),s};function J(e,t,n){let a=e.select(t);return a.size()>0?a:n()}function Q(e,t,n){if(void 0===n&&(n="right"),"right"===n||"bottom"===n)return e[n]<t[n];if("left"===n||"top"===n)return e[n]>t[n];throw`Direction being checked for overflow is invalid: ${n}`}function ee(e,t,n,a){void 0===a&&(a=0);let l="x"===e?"width":"height",r=t[e],i=t[e]+t[l],o=n[e],s=n[e]+n[l];return o+a>r&&o-a<i||s+a>r&&s-a<i||o+a<r&&s-a>i}var te='<ul id="tooltip-values"></ul>\n';function ne(e,t){switch(e){case"date":case"datetime":return t instanceof Date?t:new Date(parseInt(t)).toLocaleString([],{dateStyle:"short",timeStyle:"medium"});case"integer":return parseInt(t,10);case"float":return parseFloat(t)}return t}function ae(e,t){return 0===t.crossValues.length||0===e.crossValue.length?[]:((e.crossValue.split?e.crossValue.split("|"):Array.isArray(e.crossValue)?e.crossValue:[e.crossValue])||[e.key]).map(((e,n)=>({name:t.crossValues[n].name,value:ne(t.crossValues[n].type,e)})))}function le(e,t){if(0===t.splitValues.length)return[];let n=[e.mainValue];return e.key?n=e.key.split("|"):e.mainValue?.split&&(n=e.mainValue.split("|")),t.splitValues.map(((e,t)=>({name:e.name,value:ne(e.type,n[t])})))}function re(e,t){return t.mainValues.length>1?e.mainValues?t.mainValues.map(((t,n)=>({name:t.name,value:ne(t.type,e.mainValues[n])}))):t.mainValues.map((n=>({name:n.name,value:ne(n.type,e.row[ie(e.key,n,t.realValues)])}))):[{name:t.mainValues[0].name,value:ne(t.mainValues[0].type,e.colorValue||e.mainValue-e.baseValue||e.mainValue||e.mainValues)}]}function ie(e,t,n){if(!e)return t.name;if(e.includes("|")){let a=e.split("|");return a[a.length-1]===t.name?e:`${n.includes(a[a.length-1])?a.slice(0,a.length-1).join("|"):e}|${t.name}`}return n.includes(e)?t.name:`${e}|${t.name}`}function oe(e,t,n){!function(e,t){e.select("#tooltip-values").selectAll("li").data(t).join("li").each((function(e){(0,l.Ltv)(this).text(`${e.name}: `).append("b").text(se(e.value))}))}(e,ae(t,n).concat(le(t,n)).concat(re(t,n)))}var se=e=>null==e?"-":e.toLocaleString(void 0,{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}),ce=e=>[e.name,"==",e.value],ue=(e,t,n)=>{let a=re(t,n).map((e=>e.name)),l=ae(t,n).map(ce),r=le(t,n).map(ce),i=n.filter.concat(l).concat(r);e.dispatchEvent(new CustomEvent("perspective-click",{bubbles:!0,composed:!0,detail:{column_names:a,config:{filter:i},row:t.row}}))},he=()=>{let e=!1,t=null,n=null,a=!1,r=r=>{let i=r.node();if(!i||!i.isConnected)return void de(t);let o=(0,l.Ltv)(A(i));t=function(e){return J(e,"div.tooltip",(()=>e.append("div").attr("class","tooltip").style("z-index",3).style("opacity",0).html(te)))}(o);let s=function(e,i){oe(t,i,n);let s=r.nodes(),c=s.indexOf(this);(function(e,t,n,a){let l=e.getBoundingClientRect(),r=t.getBoundingClientRect(),i=r.left+r.width/2-l.left,o=r.top-l.top+e.scrollTop;a&&(o=r.top+r.height/2-l.top+e.scrollTop),n.style("left",`${i}px`).style("top",`${o}px`).style("opacity",.9),a&&([i,o]=function(e,t){let n=e.node().getBoundingClientRect(),a=n.width/2,l=n.left-a-t.left;e.style("left",`${l}px`);let r=n.height/2,i=n.top-r-t.top;return e.style("top",`${i}px`),[l,i]}(n,l)),function(e,t,n,a,l){void 0===l&&(l=!1);let r=e.node().getBoundingClientRect();if(Q(t,r)){let a=r.right-t.right;e.style("left",n-a+"px")}if(Q(t,r,"bottom")){let n=r.bottom-t.bottom;e.style("top",a-n+"px")}if(l){if(Q(t,r,"left")){let a=r.left-t.left;e.style("left",n-a+"px")}if(Q(t,r,"top")){let n=r.top-t.top;e.style("top",a-n+"px")}}}(n,l,i,o,a)})(o.node(),s[c],t,a),(0,l.Ltv)(s[c]).style("opacity","0.7")};e?r.each((function(e){return s.call(this,void 0,e)})):(r.on("mouseover",s).on("mouseout",(function(e,n){de(t);let a=r.nodes(),i=a.indexOf(this);a&&(0,l.Ltv)(a[i]).style("opacity","1")})),(()=>{let e=null,t=t=>{let n=t.node();t.on("click",((t,a)=>ue(n,a,e)))};return t.settings=function(){return arguments.length?(e=arguments.length<=0?void 0:arguments[0],t):e},t})().settings(n)(r))};return r.alwaysShow=function(){return arguments.length?(e=arguments.length<=0?void 0:arguments[0],r):e},r.centered=function(){return arguments.length?(a=arguments.length<=0?void 0:arguments[0],r):a},r.settings=function(){return arguments.length?(n=arguments.length<=0?void 0:arguments[0],r):n},r};function de(e){e&&e.style("opacity",0)}function ge(e,t){let n=e.mainValues.length>1?a.SY(a.WZ()):a.WZ();return n=n.decorate((n=>{he().settings(e)(n),n.style("fill",(e=>t(e.key)))})),a.XM(pe(n)).crossValue((e=>e.crossValue)).mainValue((e=>e.mainValue?e.mainValue:0)).baseValue((e=>e.baseValue))}var pe=e=>{let t=t=>e(t);return a.qz(t,e),t.bandwidth=function(){return arguments.length?(e.bandwidth(Math.max(arguments.length<=0?void 0:arguments[0],1)),t):e.bandwidth()},t};function me(e){return e.split("|").slice(0,-1).join("|")}function fe(e,t){return e.data.map((e=>Object.entries(e).filter((e=>{let[n,a]=e;return n.split("|").at(-1)===t&&!!a})).map((e=>{let[t,n]=e;return n})))).flat()}function ye(e){let t=e.data&&e.data.length>0?e.data[0]:{},n=Object.keys(t).filter((e=>"__ROW_PATH__"!==e));return xe().settings(e).domain(n)()}function ve(e,t){let n=[...new Set(t)];return xe().settings(e).domain(n)()}function xe(){let e=null,t=null,n={},a=e=>we(e,n.colorStyles&&n.colorStyles.opacity),r=()=>{let r=n.colorStyles,i=t||[r.series];if(i||e.length>1){let t=e.length>1?r.scheme:i;return l.UMr(t.map(a)).domain(e)}return null};return r.domain=function(){return 0===arguments.length?e:(e=arguments.length<=0?void 0:arguments[0],r)},r.defaultColors=function(){return arguments.length?(t=arguments.length<=0?void 0:arguments[0],r):t},r.mapFunction=function(){return arguments.length?(a=arguments.length<=0?void 0:arguments[0],r):a},r.settings=function(){return arguments.length?(n=arguments.length<=0?void 0:arguments[0],r):n},r}function be(e){return Ve(1)(e)}function we(e,t){return void 0===t&&(t=.5),Ve(t)(e)}function Ve(e){return t=>{let n=l.yWT(t);return null!=n&&(n.opacity=e),n+""}}var _e={none:w,ordinal:q,time:R,linear:N},ke=e=>{let t=m(e),n="__ROW_PATH__",l=_e[t()],r=(t,a)=>l(n,e)(t);return(0,a.qz)(r,t),r.valueName=function(){return arguments.length?(n=arguments.length<=0?void 0:arguments[0],r):n},r};function Se(e,t,n){let{stack:a=!1,excludeEmpty:l=!1}=void 0===n?{}:n,r=t||e.data;return e.splitValues.length>0?function(e,t,n){let{stack:a=!1,excludeEmpty:l=!1}=n,r={};return t.forEach((e=>{let t={},n={};Object.keys(e).filter((e=>"__ROW_PATH__"!==e)).filter((t=>!l||null!=e[t]&&null!=e[t])).forEach((l=>{let r=l.split("|"),i=r[r.length-1],o=e[l]||0,s=`${i}${o>=0?"+ve":"-ve"}`,c=r.slice(0,r.length-1).join("|"),u=n[c]=n[c]||{__ROW_PATH__:e.__ROW_PATH__},h=t[s]||0;u.__KEY__=c,a?(u[i]=h+o,u[`__BASE_VALUE__${i}`]=h,t[s]=u[i]):u[i]=o,u.row=e})),Object.keys(n).forEach((e=>{(r[e]=r[e]||[]).push(n[e])}))})),Object.keys(r).map((e=>{let t=r[e];return t.key=e,t}))}(0,r,{stack:a,excludeEmpty:l}):[r]}function ze(e,t){let n={stack:!0};return Se(e,t,n).map((t=>Ae(e,t,n)))}function Ae(e,t,n){let{stack:a=!1}=n,l=function(e,t,n){let{stack:a=!1}=n,l=ke(e);return e=>{let n=t=>a&&t[`__BASE_VALUE__${e.name}`]||0,r=t.map(((t,a)=>({crossValue:l(t,a),mainValue:t[e.name]?t[e.name]:null,baseValue:n(t),key:t.__KEY__?`${t.__KEY__}|${e.name}`:e.name,row:t.row||t})));return r.key=r[0].key,r}}(e,t,{stack:a});return e.mainValues.length>1?e.mainValues.map(l):l(e.mainValues[0])}var Me=10;function Le(e,t,n){let a=l.Ltv(z(e).getContainer()).node().getBoundingClientRect(),r=e.getBoundingClientRect(),i={top:r.top+n-Me,right:r.right+t+Me,bottom:r.bottom+n+Me,left:r.left+t-Me},o={x:t,y:n};return[{edge:"right",dimension:"x"},{edge:"left",dimension:"x"},{edge:"top",dimension:"y"},{edge:"bottom",dimension:"y"}].forEach((e=>{if(Q(a,i,e.edge)){let t=i[e.edge]-a[e.edge];o[e.dimension]=o[e.dimension]-t}})),o}var Ne="resize.for-dragging";function $e(){let e=!0,t=null,n=n=>{let a=n.node(),r=a.getRootNode().host.closest("perspective-viewer");a.style.cursor="move",t.legend&&(a.style.left=t.legend.left,a.style.top=t.legend.top);let i=l.$Er().on("drag",(function(n){let r=Le(this,n.dx,n.dy);this.style.left=`${this.offsetLeft+r.x}px`,this.style.top=`${this.offsetTop+r.y}px`;let i={left:this.style.left,top:this.style.top};t.legend={...t.legend,...i},e=function(e){let t=e.getBoundingClientRect(),n=l.Ltv(A(e)).node().getBoundingClientRect(),a=5;return t.right+Me+a>=n.right&&t.top-Me-a<=n.top}(a)?function(e){return l.Ltv(window).on(Ne,null),e.style.left="auto",!0}(a):function(e,t){return!1!==t&&l.Ltv(window).on(Ne,(function(){let t=Le(e,0,0);e.style.left=`${e.offsetLeft+t.x}px`,e.style.top=`${e.offsetTop+t.y}px`})),!1}(a,e)}));i.on("end",(function(e){l.Ltv(window).on(Ne,null),r?.dispatchEvent(new Event("perspective-config-update"))})),n.call(i)};return n.settings=function(){return arguments.length?(t=arguments.length<=0?void 0:arguments[0],n):t},n}var Te="horizontal-drag-handle",Pe="vertical-drag-handle",Ee="dragHandles",Ce="resize";var Re=(e,t,n,a)=>{e.selectAll(`.${a}`).each(((e,a,r)=>{let i=r[a];l.Ltv(i).attr(n,i.getBoundingClientRect()[n]-t)}))},Oe=e=>e.select(`#${Ee}`).size()>0,He=(e,t,n)=>e.attr(t,Number(e.attr(t))-n),Be=(e,t,n)=>e.attr(t,e.node().getBoundingClientRect()[t]-n),De=(e,t)=>{let n,r,i=e||o.Vl(),s=[],c=1,u=t.legend&&t.legend.pageIndex?t.legend.pageIndex:0,h=()=>{},d=$e().settings(t),g=e=>{s=i.scale().domain(),r=function(){let e=9,t=3,n=null,a={height:100,width:100},r={height:null,width:null},i=[],o=(e,t)=>i.filter((t=>t.event===e)).forEach((e=>e.execute(t))),s=a=>{if(Oe(a))return;let i={left:e=>o(Ce,{horizontal:A(e),vertical:!1}),top:e=>o(Ce,{horizontal:!1,vertical:L(e)}),right:e=>o(Ce,{horizontal:M(e),vertical:!1}),bottom:e=>o(Ce,{horizontal:!1,vertical:N(e)}),topleft:e=>o(Ce,{horizontal:A(e),vertical:L(e)}),topright:e=>o(Ce,{horizontal:M(e),vertical:L(e)}),bottomright:e=>o(Ce,{horizontal:M(e),vertical:N(e)}),bottomleft:e=>o(Ce,{horizontal:A(e),vertical:N(e)})},s=a.node();n.legend&&(s.style.height=n.legend.height,s.style.width=n.legend.width);let h=s.getBoundingClientRect(),d=a.append("svg").attr("id",Ee).attr("width",h.width).attr("height",h.height),g=d.append("g"),p=e=>"left"===e||"right"===e,m={left:0,top:e,right:h.width-e,bottom:e},f={left:e,top:0,right:e,bottom:h.height-e},[y,v,x,b]=["left","top","right","bottom"].map((n=>g.append("rect").attr("id",`drag${n}`).attr("class",p(n)?Pe:Te).attr("y",f[n]).attr("x",m[n]).attr("height",p(n)?h.height-2*e:e).attr("width",p(n)?e:h.width-2*e).attr("fill",p(n)?"lightgreen":"lightblue").attr("fill-opacity",0).style("z-index",t).attr("cursor",p(n)?"ew-resize":"ns-resize").call(l.$Er().on("drag",i[n])))),w=e=>`${e[0]}${e[1]}`,V={topleft:"nwse",topright:"nesw",bottomright:"nwse",bottomleft:"nesw"},[_,k,S,z]=[["top","left"],["top","right"],["bottom","right"],["bottom","left"]].map((n=>g.append("rect").attr("id",`drag${w(n)}`).attr("class",`corner-drag-handle ${n[0]} ${n[1]}`).attr("height",e).attr("width",e).attr("fill","red").attr("fill-opacity",0).style("z-index",t).attr("cursor",`${V[w(n)]}-resize`).call(l.$Er().on("drag",i[w(n)]))));function A(e){let t=u(Le(y.node(),e.x,0).x,d,"width",((e,t)=>e-t));return s.style.left=`${s.offsetLeft+t}px`,s.style.width=s.offsetWidth-t+"px",$(),T(x,t,"width","x")}function M(e){let t=-u(Le(x.node(),e.dx,0).x,d,"width",((e,t)=>e+t));return!c(t,"x",x,e)&&(s.style.width=s.offsetWidth-t+"px",$(),T(x,t,"width","x"))}function L(e){let t=u(Le(v.node(),0,e.y).y,d,"height",((e,t)=>e-t));return s.style.top=`${s.offsetTop+t}px`,s.style.height=s.offsetHeight-t+"px",$(),T(b,t,"height","y")}function N(e){let t=-u(Le(b.node(),0,e.dy).y,d,"height",((e,t)=>e+t));return!c(t,"y",b,e)&&(s.style.height=s.offsetHeight-t+"px",$(),T(b,t,"height","y"))}function $(){let e={top:s.style.top,left:s.style.left,height:s.style.height,width:s.style.width};n.legend={...n.legend,...e}}function T(e,t,n,a){return Be(d,n,t),He(e,a,t),Re(d,t,n,"height"===n?Pe:Te),P(d),0!=t}function P(t){_.attr("y",0),k.attr("y",0).attr("x",t.attr("width")-e),S.attr("y",t.attr("height")-e).attr("x",t.attr("width")-e),z.attr("y",t.attr("height")-e).attr("x",0)}function E(e,t,n){r[e]&&r[e]<h[e]&&(s.style[e]=`${r[e]}px`,T(n,h[e]-r[e],e,t))}E("height","y",b),E("width","x",x),P(d)};function c(e,t,n,a){return l=t,r=n,e<0&&a[l]<Number(r.attr(l))||((e,t,n,a)=>e>0&&a[t]>Number(n.attr(t)))(e,t,n,a);var l,r}function u(e,t,n,l){let i=l(Number(t.attr(n)),e);return i<a[n]?l(e,a[n]-i):r[n]&&i>r[n]?l(e,r[n]-i):e}return s.on=(e,t)=>(i.push({event:e,execute:t}),s),s.zIndex=e=>(t=e,s),s.settings=function(){return arguments.length?(n=arguments.length<=0?void 0:arguments[0],s):n},s.minWidth=e=>(a.width=e,r.width&&(r.width=Math.max(a.width,r.width)),s),s.minHeight=e=>(a.height=e,r.height&&(r.height=Math.max(a.height,r.height)),s),s.handleWidth=t=>(e=t,s),s.maxWidth=e=>(r.width=e,a.width=Math.min(a.width,r.width),s),s.maxHeight=e=>(r.height=e,a.height=Math.min(a.height,r.height),s),s}().settings(t).maxHeight(16*s.length+20).on("resize",(()=>p(e))),r(e),d(e),p(e)},p=e=>{x(e),m(e),f(e),function(e){let t=e.select("g.legendCells"),n=e.node().getBoundingClientRect();if(!Q(n,t.node().getBoundingClientRect()))return;let a=e.select(".legend");t.selectAll(".label").text(((e,t,l)=>{let r=l[t];if(Q(n,r.getBoundingClientRect())){let t=function(e,t,n){let a=e.getBoundingClientRect(),l=t.node().createSVGPoint(),r=3;return l.x=n.right-a.left-r,l.y=0,e.getCharNumAtPosition(l)}(r,a,n);return`${e.substring(0,t-3)}...`}return e}))}(e)},m=e=>{let t=w(e);t.style("display",c<=1?"none":"block"),t.select("#page-text").text(`${u+1}/${c}`),t.select("#up-arrow").attr("class",0===u?"disabled":"").on("click",(()=>{u>0&&(y(u-1),p(e))})),t.select("#down-arrow").attr("class",u>=c-1?"disabled":"").on("click",(()=>{u<c-1&&(y(u+1),p(e))}))},f=e=>{c>1&&i.cellFilter(v()),e.select("g.legendCells").remove();let t=V(e);t.call(i);let n=e.select("g.legendCells").node().getBBox();t.attr("height",n.height+20),h(e)},y=e=>{u=e,t.legend={...t.legend,pageIndex:u}},v=()=>(e,t)=>t>=n*u&&t<n*u+n,x=e=>{let t=e.node().getBoundingClientRect(),a=Math.floor(t.height/16)-1;n=a<s.length?a-1:a,c=b(a),u=Math.min(u,c-1)},b=e=>Math.ceil(s.length/e),w=e=>J(e,".legend-controls",(()=>e.append("g").attr("class","legend-controls").html('<span id="up-arrow">&#9650;</span>\n<span id="page-text"></span>\n<span id="down-arrow">&#9660;</span>\n'))),V=e=>J(e,".legend",(()=>e.append("svg").attr("class","legend")));return g.decorate=function(){return arguments.length?(h=arguments.length<=0?void 0:arguments[0],g):h},(0,a.qz)(g,i),g},We=e=>De(o.Vl().shape("circle").shapeRadius(6),e),je=e=>De(o.Iv().shapePadding(1).labelOffset(3),e),Ie=()=>Ye(We),Fe=()=>Ye(je,qe);function qe(e){if(!e)return null;let t=e.domain(),n=e.range().map((e=>l.HRO().type(e)()));return l.UMr().domain(t).range(n)}function Ye(e,t){void 0===t&&(t=void 0);let n={},a=null,l=null,r=t=>{if(a&&a.range().length>1){let r=e(n);r.scale(a).orient("vertical").on("cellclick",(function(e){let t=this.__data__;n.hideKeys=n.hideKeys||[],n.hideKeys.includes(t)?n.hideKeys=n.hideKeys.filter((e=>e!==t)):n.hideKeys.push(t),z(this)._draw()})),r.labels((e=>{let t=String(e.domain[e.i]).split("|");return n.mainValues.length<=1&&t.length>1?t.slice(0,t.length-1).join("|"):e.domain[e.i]}));let i=J(t,"div.legend-container",(()=>t.append("div")));r.decorate((e=>{let t=e=>n.hideKeys&&n.hideKeys.includes(e),a=e.select("g.legendCells").attr("transform","translate(20,20)").selectAll("g.cell");a.classed("hidden",t),a.append("title").html((e=>e)),l&&a.select("circle, path").style("fill",(e=>t(e)?null:l(e))).style("stroke",(e=>t(e)?null:be(l(e))))})),i.attr("class","legend-container").attr("borderbox-on-hover",!0).style("z-index","2").call(r)}};return r.settings=function(){return 0===arguments.length?n:(n=arguments.length<=0?void 0:arguments[0],r)},r.scale=function(){return arguments.length?(a=t?t(arguments.length<=0?void 0:arguments[0]):arguments.length<=0?void 0:arguments[0],r):a},r.color=function(){return arguments.length?(l=arguments.length<=0?void 0:arguments[0],r):l},r}function Ue(e,t){void 0===t&&(t=void 0);let n=t||e.data;return(e.hideKeys?.length??0)>0?n.map((t=>{let n={...t};return e.hideKeys.forEach((e=>{delete n[e]})),n})):n}function Ke(e){let t=e.data,n=e.hideKeys?.length??0,a=e.splitValues.length;return n>0?0===a?t.filter((t=>Object.values(t).reduce(((t,n)=>t&&!e.hideKeys.includes(n)),!0))):t.map((t=>{let n=Object.entries(t).filter((t=>{let[n,a]=t;return!e.hideKeys.includes(me(n))}));return Object.fromEntries(n)})):t}function Xe(e,t){return 0===e?t?t.textStyles.color:"#666":t?t.colorStyles.grid.gridLineColor:"#bbb"}var Ge=(e,t)=>e.style("display","none"),Ze=(e,t)=>{let n="both",l=!1,r=null,i=null,o=null,s=a.VX(),c=a._8(),u=(e=>(t,n)=>t.style("stroke-width",(e=>"1.0")).style("stroke",(t=>Xe(t,e))))(t),h=Ge,d=function(){l&&(s=a.Zm().context(o),c=a.YW(),u=(e=>(t,n)=>{t.strokeStyle=Xe(n,e),t.lineWidth=1})(t),h=(e=>(t,n)=>{t.lineWidth=1,t.strokeStyle=Xe(n,e)})(t));let d=s.xScale(r).yScale(i),g="vertical"===n?h:u,p="horizontal"===n?h:u,m=c.xDecorate(g).yDecorate(p);return d.series([m,e])(...arguments)};return d.orient=function(){return arguments.length?(n=arguments.length<=0?void 0:arguments[0],d):n},d.canvas=function(){return arguments.length?(l=arguments.length<=0?void 0:arguments[0],d):l},d.xScale=function(){return arguments.length?(r=arguments.length<=0?void 0:arguments[0],d):r},d.yScale=function(){return arguments.length?(i=arguments.length<=0?void 0:arguments[0],d):i},d.context=function(){return arguments.length?(o=arguments.length<=0?void 0:arguments[0],d):o},d},Je=()=>{let e=_(),t=t=>{let n=e.pad(),a=e.padUnit(),l=1;switch(a){case"domain":break;case"percent":l=t[1]-t[0];break;default:throw new Error("Unknown padUnit: "+a)}let r=t[0]-n[0]*l,i=t[1]+n[1]*l;return t[0]=t[0]>=0&&r<0?0:r,t[1]=t[1]<=0&&i>0?0:i,t};return t.pad=function(){return e.pad()},t.padUnit=function(){return e.padUnit()},a.qz(t,e),t},Qe=()=>{let e=null,t=null,n=null,a=null,r=null,i=null,o=!1,s=!1,c=()=>{};function u(c){let u=`d3fc-${s?"canvas":"svg"}.plot-area`;if(n||r){let g=a&&a.domain()[0]instanceof Date,p=l.s_O().on("zoom",(o=>{let{transform:s}=o;t.zoom={k:s.k,x:s.x,y:s.y},h(s),c.call(e);let m=1===s.k&&0===s.x&&0===s.y,f=d(c).style("display",m?"none":"");f.select("#zoom-reset").on("click",(()=>c.select(u).call(p.transform,l.GSI)));let y=f.select("#one-year").style("display",g?"":"none"),v=f.select("#six-months").style("display",g?"":"none"),x=f.select("#one-month").style("display",g?"":"none");if(g){let e=e=>()=>{let t=new Date(n.domain()[0]),o=new Date(t);e(t,o);let s=a.range(),h=(s[1]-s[0])/(a(o)-a(t)),d=-a(t)*h,g=0;if(r){let e=r.domain().reduce(((e,t)=>e+t))/2;g=-i(e)*h+r(e)}c.select(u).call(p.transform,l.GSI.translate(d,g).scale(h))};y.on("click",e(((e,t)=>t.setYear(e.getFullYear()+1)))),v.on("click",e(((e,t)=>t.setMonth(e.getMonth()+6)))),x.on("click",e(((e,t)=>t.setMonth(e.getMonth()+1))))}})),m=e.decorate();e.decorate(((e,n)=>{if(m(e,n),!o){o=!0;let n=e.select(u),r=s?window.devicePixelRatio:1;n.on("measure.zoom-range",(e=>{if(a&&a.range([0,e.detail.width/r]),i&&i.range([0,e.detail.height/r]),t.zoom){let e=l.GSI.translate(t.zoom.x,t.zoom.y).scale(t.zoom.k);n.call(p.transform,e)}})).call(p)}}))}c.call(e)}u.chart=function(){return arguments.length?(e=arguments.length<=0?void 0:arguments[0],u):e},u.settings=function(){return arguments.length?(t=arguments.length<=0?void 0:arguments[0],u):t},u.xScale=function(){return arguments.length?(n=g(arguments.length<=0?void 0:arguments[0]),a=n?n.copy():null,u):n},u.yScale=function(){if(!arguments.length)return r;if(r=g(arguments.length<=0?void 0:arguments[0]),i=r?r.copy():null,i){let e=i.domain();i.domain([e[1],e[0]])}return u},u.canvas=function(){return arguments.length?(s=arguments.length<=0?void 0:arguments[0],u):s},u.onChange=function(){return arguments.length?(c=arguments.length<=0?void 0:arguments[0],u):c};let h=e=>{let t={...e};if(n&&(n.domain(e.rescaleX(a).domain()),t.xDomain=n.domain()),r){let n=e.rescaleY(i).domain();r.domain([n[1],n[0]]),t.yDomain=r.domain()}c(t)},d=e=>J(e,".zoom-controls",(()=>e.append("div").attr("class","zoom-controls").style("display","none").html('<button id="zoom-reset">Reset zoom</button>\n<button id="one-year">1 Year</button>\n<button id="six-months">6 Months</button>\n<button id="one-month">1 Month</button>\n'))),g=e=>e&&e.nice?e:null;return u};function et(e,t){let n=ze(t,Ue(t)),l=ye(t),r=Ie().settings(t).scale(l),i=ge(t,l).orient("horizontal"),o=a.VX().mapping(((e,t)=>e[t])).series(n.map((()=>i))),s=K(t).settingName("mainValues").valueName("mainValue").memoValue(t.axisMemo[0]).excludeType(d).include([0]).paddingStrategy(Je())(n),c=K(t).excludeType(p).settingName("crossValues").valueName("crossValue").orient("vertical")(n),u=X(s,c).plotArea(Ze(o,t).orient("horizontal"));u.yPaddingInner&&(u.yPaddingInner(.5),u.yPaddingOuter(.25),i.align("left")),u.xNice&&u.xNice();let h=Qe().chart(u).settings(t).yScale(c.scale);e.datum(n).call(h),e.call(r)}et.plugin={name:"X Bar",category:"X Chart",max_cells:1e3,max_columns:50,render_warning:!0,initial:{names:["X Axis"]}};var tt=et,nt=e=>2===e.length&&!isNaN(e[0])&&!isNaN(e[1])&&e[0]!==e[1],at=e=>(0-e[0])/(e[1]-e[0]),lt=(e,t)=>t*e[1]/(t-1),rt=function(e,t,n){void 0===n&&(n=it);let l,r,i,o=e.splitMainValues||[],s=e=>{let t=e.split("|");return o.includes(t[t.length-1])},c=e.mainValues.some((e=>s(e.name)));r=c?n(t,(e=>!s(e))):t,i=c?n(t,s):null;let u=t=>{if(1===e.mainValues.length)return;let n=e.mainValues.map(((e,t)=>({index:t,name:e.name}))),r=n.filter((e=>!s(e.name))),i=n.filter((e=>s(e.name))),o=()=>(e=>{let t,n=[],l=!1,r=r=>{r.text("");let o=a.d8("span","splitter-label").key((e=>e)),s=!l&&1===n.length,c=t&&0===e.splitValues.length;o(r,n).classed("disabled",s).text((e=>e.name)).style("color",(e=>c?be(t(e.name)):void 0)).on("click",((t,n)=>{s||(e.splitMainValues=l?e.splitMainValues.filter((e=>e!=n.name)):[n.name].concat(e.splitMainValues||[]),t.target.getRootNode().host.closest("perspective-viewer")?.dispatchEvent(new Event("perspective-config-update")),i(r))}))},i=e=>{let t=z(e.node());t._container.innerHTML="",t._draw()};return r.labels=function(){return arguments.length?(n=arguments.length<=0?void 0:arguments[0],r):n},r.alt=function(){return arguments.length?(l=arguments.length<=0?void 0:arguments[0],r):l},r.color=function(){return arguments.length?(t=arguments.length<=0?void 0:arguments[0],r):t},r})(e).color(l);t.select(".y-label.left-label").call(o().labels(r)),t.select(".y-label.right-label").call(o().labels(i).alt(!0))};return u.color=function(){return arguments.length?(l=arguments.length<=0?void 0:arguments[0],u):l},u.haveSplit=()=>c,u.data=function(){return arguments.length?(r=arguments.length<=0?void 0:arguments[0],u):r},u.altData=function(){return arguments.length?(i=arguments.length<=0?void 0:arguments[0],u):i},u},it=(e,t)=>e.map((e=>e.filter((e=>t(e.key))))),ot=(e,t)=>e.map((e=>t(e.key)?e:e.map((e=>Object.assign({},e,{mainValue:null}))))),st=(e,t)=>e.map((e=>ot(e,t)));function ct(e,t){let n=ze(t,Ue(t)),l=ye(t),r=Ie().settings(t).scale(l),i=ge(t,l).orient("vertical"),o=a.VX().mapping(((e,t)=>e[t])).series(n.map((()=>i))),s=K(t).excludeType(p).settingName("crossValues").valueName("crossValue")(n),c=K(t).settingName("mainValues").valueName("mainValue").memoValue(t.axisMemo[1]).excludeType(d).orient("vertical").include([0]).paddingStrategy(Je()),u=t.mainValues.length>1?st:ot,h=rt(t,n,u).color(l),g=c(h.data()),m=h.haveSplit()?o:Ze(o,t).orient("vertical"),f=X(s,g).axisSplitter(h).plotArea(m);f.xPaddingInner&&(f.xPaddingInner(.5),f.xPaddingOuter(.25),i.align("left")),f.yNice&&f.yNice();let y=Qe().chart(f).settings(t).xScale(s.scale);if(h.haveSplit()){let e=c(h.altData());((e,t)=>{if(!nt(e)||!nt(t))return;let n=at(e),a=at(t);n>a?t[0]=lt(t,n):e[0]=lt(e,a)})(g.domain,e.domain),f.yDomain(g.domain).altAxis(e)}e.datum(h.data()).call(y),e.call(r)}ct.plugin={name:"Y Bar",category:"Y Chart",max_cells:1e3,max_columns:50,render_warning:!0,initial:{names:["Y Axis"]}};var ut=ct;function ht(e,t){let n=a.S4(),l=e.data.length*(e.data?.length>0?Object.keys(e.data[0]).length-(e.crossValues?.length>0?1:0):0),r=Math.max(1,Math.min(3,Math.floor(e.size.width/l/2)));return n=n.decorate((e=>{e.style("stroke",(e=>be(t(e[0]&&e[0].key)))).style("stroke-width",r)})),n.crossValue((e=>e.crossValue)).mainValue((e=>e.mainValue))}var dt=function(e){let t=[];for(let n of e)for(let e=0;e<n.length;e++)null!==n[e].mainValue&&(t[e]=t[e]||[],t[e].push(n[e]));return t},gt=function(e,t,n){void 0===n&&(n=Math.min);let a=e=>e.reduce(((e,t)=>{let a=l(t);return!a||e&&n(e.value,a.value)!==a.value?e:a}),null),l=e=>{if(Array.isArray(e))return a(e);let n=t(e);return null!==n?{item:e,value:n}:null},r=a(e);return r?r.item:null},pt=()=>{let e=he().alwaysShow(!0),t=null,n=null,l=null,r=null,i=!1,o=null,s="crossValue",c="mainValue",u=null,h=1,d=l=>{let r=`d3fc-${i?"canvas":"svg"}.plot-area`;if(t||n){let t=null,i=a.Wn().on("point",(e=>{let a=e.length?p(e[0]):null;t=a?[a.data]:[];let r=a?a.scale:n;g(l,t,r)}));l.select(r).on("measure.nearbyTip",(()=>g(l,[]))).on("click",(()=>{t.length&&ue(l.node(),t[0],e.settings())})).call(i)}},g=function(a,i,o){void 0===o&&(o=n);let u=a.select("d3fc-svg.plot-area svg").selectAll("circle.nearbyTip").data(i);u.exit().remove(),u.enter().append("circle").attr("class","nearbyTip").merge(u).attr("r",(e=>r?h*Math.sqrt(r(e.size)):10)).attr("transform",(e=>`translate(${t(e[s])},${o(e[c])})`)).style("stroke","none").style("fill",(e=>l&&e.key&&we(l(e.key)))),e(u)},p=e=>{let a=n=>a=>void 0===a[c]||null===a[c]||void 0===a[s]||null===a[s]?null:Math.sqrt(Math.pow(t(a[s])-e.x,2)+Math.pow(n(a[c])-e.y,2)),l=a(n),r=gt(o,l,Math.min);if(u){let e=a(u.yScale),t=gt(u.data,e,Math.min);return l(r)<=e(t)?{data:r,scale:n}:{data:t,scale:u.yScale}}return{data:r,scale:n}};return d.scaleFactor=function(){return arguments.length?(h=arguments.length<=0?void 0:arguments[0],d):h},d.xScale=function(){return arguments.length?(t=arguments.length<=0?void 0:arguments[0],d):t},d.yScale=function(){return arguments.length?(n=arguments.length<=0?void 0:arguments[0],d):n},d.color=function(){return arguments.length?(l=arguments.length<=0?void 0:arguments[0],d):l},d.size=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.length?(r=t[0]?t[0].copy().range([40,4e3]):null,d):r},d.canvas=function(){return arguments.length?(i=arguments.length<=0?void 0:arguments[0],d):i},d.data=function(){return arguments.length?(o=arguments.length<=0?void 0:arguments[0],d):o},d.xValueName=function(){return arguments.length?(s=arguments.length<=0?void 0:arguments[0],d):s},d.yValueName=function(){return arguments.length?(c=arguments.length<=0?void 0:arguments[0],d):c},d.altDataWithScale=function(){return arguments.length?(u=arguments.length<=0?void 0:arguments[0],d):u},d.settings=function(){return arguments.length?(e.settings(arguments.length<=0?void 0:arguments[0]),d):e.settings()},a.qz(d,e),d};function mt(e,t){let n=function(e,t){let n=ke(e);return t.map(((e,t)=>Object.keys(e).filter((e=>"__ROW_PATH__"!==e)).map((a=>({key:a,crossValue:n(e,t),mainValue:e[a],row:e})))))}(t,Ue(t)),l=ye(t),r=Ie().settings(t).scale(l),i=a.b7().series(ht(t,l)).orient("horizontal"),o=Je().pad([.1,.1]).padUnit("percent"),s=rt(t,dt(n)).color(l),c=K(t).excludeType(p).settingName("crossValues").valueName("crossValue")(n),u=K(t).settingName("mainValues").valueName("mainValue").memoValue(s.haveSplit()?null:t.axisMemo[0]).orient("vertical").paddingStrategy(o),h=u(s.data()),d=s.haveSplit()?i:Ze(i,t).orient("vertical"),g=X(c,h).axisSplitter(s).plotArea(d);g.yNice&&g.yNice();let m=Qe().chart(g).settings(t).xScale(c.scale),f=pt().settings(t).xScale(c.scale).yScale(h.scale).color(l).data(n);if(s.haveSplit()){let e=u(s.altData());g.altAxis(e),f.data(s.data()).altDataWithScale({yScale:e.scale,data:s.altData()})}let y=s.data();e.datum(y).call(m),e.call(f),e.call(r)}mt.plugin={name:"Y Line",category:"Y Chart",max_cells:4e3,max_columns:50,render_warning:!0,initial:{names:["Y Axis"]}};var ft=mt,yt=Math.sqrt(3),vt={draw:function(e,t){let n=Math.sqrt(t/(3*yt));e.moveTo(0,2*n),e.lineTo(-yt*n,-n),e.lineTo(yt*n,-n),e.closePath()}},xt=[l.hKN,l.BVl,l.jaT,l.yDW,l.N8r,l.ZKi,l.IJl],bt={circle:l.hKN,square:l.yDW,cross:l.BVl,diamond:l.jaT,star:l.N8r,triangle:l.ZKi,wye:l.IJl,nabla:vt};function wt(e){return e.length>1?l.UMr().domain(e).range(xt):null}function Vt(e,t){let n=dt(function(e,t){let n=e.mainValues.length;return t.map((e=>{let t=Object.keys(e).filter((e=>"__ROW_PATH__"!==e)),a=new Array(t.length/n);for(let l=0;l<t.length/n;l++)a[l]={key:me(t[l*n]),crossValue:e[t[l*n]],mainValue:e[t[l*n+1]],row:e};return a}))}(t,Ke(t))),l=function(e){let t=e.data[0]??{},n=Object.keys(t).filter((e=>"__ROW_PATH__"!==e)).map((e=>me(e))),a=[...new Set(n)];return xe().settings(e).domain(a)()}(t),r=function(e){let t=e.data&&e.data.length>0?e.data[0]:{},n=[];return Object.keys(t).forEach((e=>{if("__ROW_PATH__"!==e){let t=me(e);n.includes(t)||n.push(t)}})),wt(n)}(t),i=null;l.domain().length>=2&&(i=Ye(We,qe).settings(t).scale(r).color(l));let o=a.b7().series(ht(t,l)).orient("horizontal"),s=Je().pad([.1,.1]).padUnit("percent"),c=K(t).settingName("mainValues").settingValue(t.mainValues[0].name).valueName("crossValue").memoValue(t.axisMemo[0]).paddingStrategy(s),u=K(t).settingName("mainValues").settingValue(t.mainValues[1].name).valueName("mainValue").memoValue(t.axisMemo[1]).orient("vertical").paddingStrategy(s)(n),h=c(n),d=Ze(o,t).orient("vertical"),g=X(h,u).xLabel(t.mainValues[0].name).yLabel(t.mainValues[1].name).plotArea(d);g.xNice&&g.xNice(),g.yNice&&g.yNice();let p=Qe().chart(g).settings(t).xScale(h.scale).yScale(u.scale),m=pt().settings(t).xScale(h.scale).yScale(u.scale).color(l).data(n);e.datum(n).call(p),e.call(m),i&&e.call(i)}Vt.plugin={name:"X/Y Line",category:"X/Y Chart",max_cells:5e4,max_columns:50,render_warning:!0,initial:{type:"number",count:2,names:["X Axis","Y Axis","Tooltip"]},selectMode:"toggle"};var _t=Vt;function kt(e,t){let n=function(e,t){let n=ke(e);return t.map(((e,t)=>{let a={};return Object.keys(e).filter((e=>"__ROW_PATH__"!==e)).map((l=>{let r=l.split("|"),i=r[r.length-1],o=a[i]||0,s=o+e[l];return a[i]=s,{key:l,crossValue:n(e,t),mainValue:s,baseValue:o,row:e}}))}))}(t,Ue(t)),l=ye(t),r=Ie().settings(t).scale(l),i=a.b7().series(function(e,t){let n=a.b();return n=n.decorate((e=>{e.style("fill",(e=>t(e[0].key))).style("opacity",.5)})),n.crossValue((e=>e.crossValue)).mainValue((e=>e.mainValue)).baseValue((e=>e.baseValue))}(0,l).orient("vertical")),o=a.b7().series(ht(t,l)).orient("vertical"),s=a.VX().series([i,o]),c=K(t).excludeType(p).settingName("crossValues").valueName("crossValue")(n),u=K(t).settingName("mainValues").valueName("mainValue").memoValue(t.axisMemo[1]).excludeType(d).orient("vertical").include([0]).paddingStrategy(Je()),h=rt(t,n).color(l),g=u(h.data()),m=h.haveSplit()?s:Ze(s,t).orient("vertical"),f=X(c,g).axisSplitter(h).plotArea(m);f.yNice&&f.yNice();let y=Qe().chart(f).settings(t).xScale(c.scale),v=pt().settings(t).xScale(c.scale).yScale(g.scale).color(l).data(n);if(h.haveSplit()){let e=u(h.altData());f.altAxis(e),v.data(h.data()).altDataWithScale({yScale:e.scale,data:h.altData()})}e.datum(h.data()).call(y),e.call(v),e.call(r)}kt.plugin={name:"Y Area",category:"Y Chart",max_cells:4e3,max_columns:50,render_warning:!0,initial:{names:["Y Axis"]}};var St=kt;function zt(e,t){let n=function(e,t){let n={stack:!1},a=Se(e,t,n).map((t=>Ae(e,t,n)));return e.mainValues.length>1?a.reduce(((e,t)=>e.concat(t))):a}(t,Ue(t)),l=function(e){let t=e.data&&e.data.length>0?e.data[0]:{};return wt(Object.keys(t).filter((e=>"__ROW_PATH__"!==e)))}(t),r=ye(t),i=Fe().settings(t).scale(l).color(r),o=a.VX().mapping(((e,t)=>e[t])).series(n.map((e=>function(e,t,n,l){let r=a.s9().size(100),i=e.colorStyles&&e.colorStyles.opacity;return l&&r.type(l(t)),r.decorate((e=>{e.style("stroke",(e=>be(n(e.colorValue||t)))).style("fill",(e=>we(n(e.colorValue||t),i)))})),r.crossValue((e=>e.crossValue)).mainValue((e=>e.mainValue))}(t,e.key,r,l)))),s=Je().pad([.05,.05]).padUnit("percent"),c=K(t).excludeType(p).settingName("crossValues").valueName("crossValue")(n),u=K(t).settingName("mainValues").valueName("mainValue").memoValue(t.axisMemo[1]).orient("vertical").paddingStrategy(s),h=rt(t,n).color(r),d=u(h.data()),g=h.haveSplit()?o:Ze(o,t).orient("vertical"),m=X(c,d).axisSplitter(h).plotArea(g);m.yNice&&m.yNice();let f=Qe().chart(m).settings(t).xScale(c.scale),y=pt().settings(t).xScale(c.scale).yScale(d.scale).color(r).data(n);if(h.haveSplit()){let e=u(h.altData());m.altAxis(e),y.data(h.data()).altDataWithScale({yScale:e.scale,data:h.altData()})}e.datum(h.data()).call(f),e.call(y),i&&e.call(i)}zt.plugin={name:"Y Scatter",category:"Y Chart",max_cells:4e3,max_columns:50,render_warning:!0,initial:{names:["Y Axis"]}};var At=zt;function Mt(e,t){return Se(e,t,{excludeEmpty:!0}).map((t=>function(e,t){let n=ke(e),a=t.map(((a,l)=>({crossValue:n(a,l),mainValues:e.mainValues.map((e=>a[e.name])),x:a[e.mainValues[0].name],y:a[e.mainValues[1].name],colorValue:e.realValues[2]?a[e.realValues[2]]:void 0,size:e.realValues[3]?a[e.realValues[3]]:void 0,key:t.key,row:a})));return a.key=t.key,a}(e,t)))}function Lt(e,t,n,a){void 0===a&&(a=null);let r=Nt(t,n,a),i=e.colorStyles.gradient.full;if(r[0]>=0)i=e.colorStyles.gradient.positive;else if(r[1]<=0)i=e.colorStyles.gradient.negative;else{let e=Math.max(-r[0],r[1]);r=[-e,e]}let o=$t(i);return l.exT(o).domain(r)}var Nt=(e,t,n)=>n||L().valueName(t).pad([0,0])(e),$t=e=>{let t=e.slice(1).map(((t,n)=>l.GWP(e[n][1],t[1])));return n=>{let a=e.findIndex(((t,a)=>a<e.length-1&&n<=e[a+1][0]&&n>t[0]));if(-1===a)return n<=e[0][0]?e[0][1]:e[e.length-1][1];let l=t[a],[r]=e[a],[i]=e[a+1];return l((n-r)/(i-r))}};function Tt(){let e=null;function t(t){let n=J(t,"div.legend-container",(()=>t.append("div").attr("class","legend-container legend-color").style("z-index","2"))),{width:r,height:i}=n.node().getBoundingClientRect(),o=l.WH().domain([0,1]).range([0,r]),s=e.copy().nice().domain(),c=a.cZ().pad([.1,.1]).padUnit("percent")(s),[u,h]=c,d=l.y17(u,h,(h-u)/i),g=l.m4Y().domain(c).range([i,0]),p=a.XM(a.WZ()).xScale(o).yScale(g).crossValue(0).baseValue(((e,t)=>d[Math.max(0,t-1)])).mainValue((e=>e)).decorate((t=>{t.selectAll("path").style("fill",(t=>e(t)))})),m=s[0]<0&&s[1]>0?0:Math.round((s[1]+s[0])/2),f=[...s,m],y=S(u,h),v=a.eH(g).tickValues(f).tickSizeOuter(0).tickFormat((e=>y(e))),x=J(n,"svg",(()=>n.append("svg"))).style("width",r).style("height",i),b=J(x,"g",(()=>x.append("g"))).datum(d).call(p),w=Math.abs(b.node().getBBox().x);J(x,"#legend-axis",(()=>x.append("g").attr("id","legend-axis"))).attr("transform",`translate(${w})`).datum(d).call(v).select(".domain").attr("visibility","hidden")}return t.scale=function(){return arguments.length?(e=arguments.length<=0?void 0:arguments[0],t):e},t}function Pt(){let e="element-prefix-unset",t=null,n=null,a=null,l=null,r=null,i=!0,o=null,s=s=>{let c=J(s,"div.outer-container",(()=>s.append("div").attr("class","outer-container").style("width",`calc(100% - ${o??0})`).style("height",`calc(100% - ${o??0})`).style("padding-left",o??0))),u=J(c,"div.inner-container",(()=>c.append("div").attr("class","inner-container"))),h=c.node().getBoundingClientRect(),d=h.height,g=h.width-0,p=s.datum(),m=Math.max(1,Math.min(p.length,Math.floor(g/300))),f=Math.ceil(p.length/m);r={width:g/Math.max(m,1),height:Math.min(d,Math.max(d/f,g/Math.max(m,1)))},d/f>.75*r.height&&(r.height=d/f),p.length>1?(u.style("grid-template-columns",`repeat(${m}, ${100/m}%)`),u.style("grid-template-rows",`repeat(${f}, ${r.height}px)`)):(u.style("grid-template-columns","repeat(1, 100%)"),u.style("grid-template-rows","repeat(1, 100%)")),a=u.selectAll(`div.${e}-container`).data(p,(e=>e.split)),a.exit().remove(),n=a.enter().append("div").attr("class",`${e}-container`),l=n.append("div").attr("class","title-container").style("text-align","center").attr("display","inline-block").append("text").attr("class","title").style("text-align","left"),t=i?n.append("svg").append("g").attr("class",e):n.append("div").attr("class",e)};return s.padding=function(){return arguments.length?(o=arguments.length<=0?void 0:arguments[0],s):o},s.svg=function(){return arguments.length?(i=arguments.length<=0?void 0:arguments[0],s):i},s.elementsPrefix=function(){return arguments.length?(e=arguments.length<=0?void 0:arguments[0],s):e},s.chartContainer=()=>t,s.chartEnter=()=>n,s.chartDiv=()=>a,s.chartTitle=()=>l,s.containerSize=()=>r,s}function Et(){let e=null,t=null,n=null,r=null,i=i=>{let o=!!e.realValues[2],s=e.realValues[4],c=e.realValues[3]?function(e,t,n,a){return l.m4Y().domain(Nt(t,n,a))}(0,t,"size").range([10,1e4]):null,u=e.realValues[5],h=function(e,t){let[n,a]=e,[l,r]=t,i=(r-a)/(l-n),o=r-i*l;return function(e){let t=e.node(),n=Math.min(t.clientWidth,t.clientHeight);return Math.min(r,Math.max(a,i*n+o))}}([600,.1],[1600,1])(i),d=a.Zm().mapping(((e,t)=>e[t])).series(t.map((()=>function(e,t,n,l,r,i,o){void 0===o&&(o=1);let s=(0,a.UK)().crossValue((e=>e.x)).mainValue((e=>e.y));return i&&s.type((e=>i(e.row[t]))),n&&s.size((e=>Math.round(o*n(e.size)))),s.decorate(((t,a)=>{let i=l(a.colorValue),s=e.colorStyles?.opacity;if(r){let{type:l}=e.mainValues.find((e=>e.name===r)),i=ne(l,a.row[r]);if(null!==i){t.fillStyle=e.textStyles.color,t.font=e.textStyles.font;let l=0;n&&(l=1*Math.sqrt(o*n(a.size)/Math.PI));let r=l+8;t.fillText(i,r,4)}}t.strokeStyle=be(i),t.fillStyle=we(i,s)})),s}(e,s,c,n,u,r,h)))),g=()=>K(e).settingName("mainValues").paddingStrategy(Je()).pad([.1,.1]),p=g().settingValue(e.mainValues[0].name).memoValue(e.axisMemo[0]).valueName("x")(t),m=g().orient("vertical").settingValue(e.mainValues[1].name).memoValue(e.axisMemo[1]).valueName("y")(t),[f,y]=0===e.splitValues.length?[e.mainValues[0].name,e.mainValues[1].name]:["",""],v=G(p,m).xLabel(f).yLabel(y).plotArea(Ze(d,e).canvas(!0));v.xNice&&v.xNice(),v.yNice&&v.yNice();let x=Qe().chart(v).settings(e).xScale(p.scale).yScale(m.scale).canvas(!0),b=pt().scaleFactor(h).settings(e).canvas(!0).xScale(p.scale).xValueName("x").yValueName("y").yScale(m.scale).color(!o&&n).size(c).data(t);i.datum(t).call(x),i.call(b)};return i.settings=function(){return arguments.length?(e=arguments.length<=0?void 0:arguments[0],i):e},i.data=function(){return arguments.length?(t=arguments.length<=0?void 0:arguments[0],i):t},i.color=function(){return arguments.length?(n=arguments.length<=0?void 0:arguments[0],i):n},i.symbols=function(){return arguments.length?(r=arguments.length<=0?void 0:arguments[0],i):r},i}function Ct(e,t){let n=t.realValues[2],a=!!n,r="string"===t.mainValues.find((e=>e.name===n))?.type,i=null,o=null,s=t.realValues[4],c=function(e,t){return wt([...new Set(fe(e,t))])}(t,s),u=function(e,t){if(!t)return;let n=e.realValues[4],a=e.mainValues.find((e=>e.name===n))?.type,r=t.domain(),i=t.range(),o=i.length;for(let[l,c]of r.entries())i[l]=i[l%o];let s=e.columns_config?.[n]?.symbols??{};return Object.entries(s).forEach((e=>{let[t,n]=e,o=bt[n]??l.hKN,s=r.findIndex((e=>{switch(a){case"date":case"datetime":return new Date(e).valueOf()===new Date(t).valueOf();default:return String(e)===String(t)}}));i[s]=o})),t.range(i),t}(t,c),h=Mt(t,Ke(t));if(a&&r?s?(i=t.splitValues.length>0?ve(t,h):ve(t,h[0]),o=Fe().settings(t).scale(u)):(i=function(e,t){let n=fe(e,t),a=[...new Set(n)].sort();return xe().settings(e).domain(a)()}(t,n),o=Ie().settings(t).scale(i)):a?(i=Lt(t,h,"colorValue"),o=Tt().scale(i)):(i=xe().settings(t).domain([""])(),o=Fe().settings(t).scale(u)),0!==t.splitValues.length){let n=Pt().svg(!1).elementsPrefix("xy-scatter");n=n.padding("2.5em"),e.append("div").attr("class","multi-xlabel").append("p").text(t.mainValues[0].name),e.append("div").attr("class","multi-ylabel").append("p").text(t.mainValues[1].name).style("transform","rotate(-90deg)").style("text-wrap","nowrap"),(e=e.datum(h)).call(n);n.chartContainer();let a=n.chartEnter(),r=n.chartDiv(),o=n.chartTitle(),s=n.containerSize();o.each(((e,t,n)=>l.Ltv(n[t]).text(e.key))),a.merge(r).attr("transform",`translate(${s.width/2}, ${s.height/2})`).each((function(e){let n=l.Ltv(this);Et().settings(t).data([e]).color(i).symbols(u)(n)}))}else Et().settings(t).data(h).color(i).symbols(u)(e);o&&e.call(o)}Ct.plugin={name:"X/Y Scatter",category:"X/Y Chart",max_cells:5e4,max_columns:50,render_warning:!0,initial:{type:"number",count:2,names:["X Axis","Y Axis","Color","Size","Symbol","Label","Tooltip"]},selectMode:"toggle"},Ct.can_render_column_styles=(e,t)=>"string"===e&&"Symbol"===t,Ct.column_style_controls=(e,t)=>"string"===e&&"Symbol"===t?{symbols:{keys:"row",values:Object.keys(bt)}}:null;var Rt=Ct;function Ot(e,t){let n=function(e,t){let n=ke(e),a=m(e).excludeType(p).settingName("splitValues")(),l=[];return t.forEach(((e,t)=>{let r=n(e,t);Object.keys(e).filter((e=>"__ROW_PATH__"!==e)).forEach((t=>{let n=function(e){let t=e.split("|");return t.pop(),t.join("|")}(t);l.push({crossValue:r,mainValue:a===g?new Date(n):n,colorValue:e[t],row:e})}))})),l}(t,Ue(t)),l=Lt(t,n,"colorValue"),r=function(e,t){let n=a.sH();return n.decorate(((e,n)=>{e.fillStyle=t(n.colorValue)})),a.XM(n).xValue((e=>e.crossValue)).yValue((e=>e.mainValue)).colorValue((e=>e.colorValue)).colorInterpolate(t.interpolator()).widthFraction(1)}(0,l),i=Tt().scale(l),o=K(t).excludeType(p).settingName("crossValues").valueName("crossValue")(n),s=K(t).excludeType(p).settingName("splitValues").valueName("mainValue").modifyDomain((e=>isNaN(e[0])?e:e.reverse())).orient("vertical")(n),c=G(o,s).plotArea(Ze(r,t).canvas(!0));c.xPaddingInner&&(c.xPaddingInner(0),c.xPaddingOuter(0),r.xAlign("right")),c.yPaddingInner&&(c.yPaddingInner(0),c.yPaddingOuter(0),r.yAlign("top"));let u=Qe().chart(c).settings(t).xScale(o.scale).yScale(s.scale).canvas(!0),h=pt().settings(t).canvas(!0).xScale(o.scale).yScale(s.scale).color(l).data(n);e.datum(n).call(u),e.call(i),e.call(h)}Ot.plugin={name:"Heatmap",category:"Hierarchial Chart",max_cells:5e4,max_columns:500,render_warning:!0,initial:{names:["Color"]}};var Ht=Ot;function Bt(e,t){return Se(e,t,{excludeEmpty:!0}).map((t=>function(e,t){let n=ke(e),a=n=>t[n<t.length-1?n+1:n][e.realValues[0]],l=t.map(((l,r)=>{let i=e.realValues[0]?l[e.realValues[0]]:void 0,o=e.realValues[1]?l[e.realValues[1]]:a(r);return{crossValue:n(l,r),mainValues:e.mainValues.map((e=>l[e.name])),openValue:i,closeValue:o,highValue:e.realValues[2]?l[e.realValues[2]]:Math.max(i,o),lowValue:e.realValues[3]?l[e.realValues[3]]:Math.min(i,o),key:t.key,row:l}}));return l.key=t.key,l}(e,t)))}var Dt=function(e){return function(t,n){let l=Bt(n,Ke(n)),r=a.tG().value((e=>e.openValue)),i=l.map((e=>{let t=r(e);return e.map(((e,n)=>Object.assign({bollinger:t[n]},e)))})),o=l.map((e=>e.key)).concat(n.hideKeys?n.hideKeys:[]).sort(),s=xe().domain(o).settings(n).mapFunction(Ve(1))(),c=Ie().settings(n).scale(o.length>1?s:null),u=function(e,t,n){let l=n.domain(),r=xe().domain(l).settings(e).defaultColors([e.colorStyles["series-2"]]).mapFunction(Ve(.5))(),i=xe().settings(e).domain(l)(),o=t().crossValue((e=>e.crossValue)).openValue((e=>e.openValue)).highValue((e=>e.highValue)).lowValue((e=>e.lowValue)).closeValue((e=>e.closeValue)).decorate(((e,t)=>{let a=(e=>e.closeValue>=e.openValue)(t)?n(t.key):r(t.key);e.fillStyle=a,e.strokeStyle=a})),s=a.aV().mainValue((e=>e.bollinger.average)).crossValue((e=>e.crossValue)).decorate(((e,t)=>{e.strokeStyle=i(t[0].key)})),c=a.J2().mainValue((e=>e.bollinger.upper)).baseValue((e=>e.bollinger.lower)).crossValue((e=>e.crossValue)).decorate(((e,t)=>{e.fillStyle=Ve(.25)(i(t[0].key))}));return a.Zm().series([c,o,s])}(n,e,s),h=a.Zm().mapping(((e,t)=>e[t])).series(i.map((()=>u))),d=Je().pad([.1,.1]).padUnit("percent"),g=K(n).settingName("crossValues").valueName("crossValue")(i),p=K(n).settingName("mainValues").valueNames(["lowValue","highValue"]).memoValue(n.axisMemo[1]).orient("vertical").paddingStrategy(d)(i),m=G(g,p).plotArea(Ze(h,n).orient("vertical").canvas(!0));m.yNice&&m.yNice();let f=Qe().chart(m).settings(n).xScale(g.scale).onChange((e=>{let t=i.map((t=>t.filter((t=>t.crossValue>=e.xDomain[0]&&t.crossValue<=e.xDomain[1]))));m.yDomain(p.domainFunction(t))})).canvas(!0),y=pt().settings(n).xScale(g.scale).yScale(p.scale).yValueName("closeValue").color(s).data(i).canvas(!0);t.datum(i).call(f),t.call(y),t.call(c)}},Wt=Dt(a.ij);Wt.plugin={name:"OHLC",category:"Y Chart",max_cells:3500,max_columns:50,render_warning:!0,initial:{type:"number",count:1,names:["Open","Close","High","Low","Tooltip"]},selectMode:"toggle"};var jt=Wt,It=Dt(a.Xy);It.plugin={name:"Candlestick",category:"Y Chart",max_cells:4e3,max_columns:50,render_warning:!0,initial:{type:"number",count:1,names:["Open","Close","High","Low","Tooltip"]},selectMode:"toggle"};var Ft=It;function qt(e,t){if(e.realValues.length>1&&null!==e.realValues[1]){let n=e.realValues[1];if("string"===e.mainValues.find((e=>e.name===n))?.type){return ve(e,t.map((e=>e.data)).filter((e=>e.height>0)).map((e=>Yt(e))).reduce(((e,t)=>e.concat(t))))}return Lt(e,null,null,(e=>{let t=e=>(t,n)=>void 0===t?n:void 0===n?t:e(t,n);return e.reduce(((e,n)=>[t(Math.min)(e[0],n[0]),t(Math.max)(e[1],n[1])]),[void 0,void 0])})(t.map((e=>e.extents))))}}function Yt(e,t){return void 0===t&&(t=[]),e.children&&e.children.length>0?e.children.forEach((e=>t.concat(Yt(e,t)))):e.data.color&&t.push(e.data.color),t}function Ut(e){let t={},n=e.realValues.map((t=>null===t?null:e.mainValues.find((e=>e.name===t))));return e.data.forEach(((a,l)=>{let r=Array.isArray(a.__ROW_PATH__)?a.__ROW_PATH__:[];(function(e){let t=[];return Object.keys(e).forEach((e=>{if("__ROW_PATH__"!==e){let n=e.split("|").slice(0,-1).join("|");t.includes(n)||t.push(n)}})),t})(a).forEach((i=>{let o;t[i]||(t[i]=[]),o=t[i],r.forEach(((t,s)=>{let c=o.find((e=>e.name===t));if(c||(c={name:t,children:[]},o.push(c)),e.realValues.length>1&&null!==e.realValues[1]){let t=s===r.length-1,n=Kt(t?a:e.agg_paths[l][s+1]||a,e.mainValues[1],i);void 0!==n&&(c.color=n)}if(e.realValues.length>2&&null!==e.realValues[2]){c.tooltip=[];for(let t=2;t<e.realValues.length;++t)c.tooltip.push(Kt(a,n[t],i))}if(s===r.length-1)if(c.name=r.slice(-1)[0],0===e.crossValues.length)c.size=Kt(a,e.mainValues[0],"");else if(r.length===e.crossValues.length){let t=Kt(a,e.mainValues[0],i);c.size=t>0?t:0}o=c.children}))}))})),Object.entries(t).map((t=>{let n={name:"root",children:t[1]},a=l.Sk5(n).sum((e=>e.size)),r=l.jBG().size([2*Math.PI,a.height+1])(a);return r.each((n=>{n.current=n,n.mainValues=1===e.realValues.length||null===e.realValues[1]&&null===e.realValues[2]?n.value:[n.value,n.data.color].concat(n.data.tooltip||[]).filter((e=>void 0!==e)),n.crossValue=n.ancestors().slice(0,-1).reverse().map((e=>e.data.name)),n.key=t[0],n.label=ne(e.crossValues[n.depth-1<0?0:n.depth-1]?.type||e.mainValues[0].type,n.data.name)})),{split:t[0],data:r,extents:Xt(e,t)}}))}var Kt=(e,t,n)=>n.length?e[`${n}|${t.name}`]:e[t.name];function Xt(e,t){let[n,a]=t;if(e.realValues.length>1&&null!==e.realValues[1]){return[Math.min(...e.data.map((t=>Kt(t,e.mainValues[1],n)))),Math.max(...a.map((e=>e.color)))]}}var Gt=e=>(0,l.JLW)().startAngle((e=>e.x0)).endAngle((e=>e.x1)).padAngle((e=>Math.min((e.x1-e.x0)/2,.005))).padRadius(e).innerRadius((t=>Math.max(1,(t.y0-1)*e))).outerRadius((t=>Math.max((t.y0-1)*e,(t.y1-1)*e-1))),Zt=e=>e.y0>=1&&e.x1>e.x0,Jt=e=>e.y1<=3&&e.y0>=1&&(e.y1-e.y0)*(e.x1-e.x0)>.06;function Qt(e,t){let n=(e.x0+e.x1)/2*180/Math.PI;return`rotate(${n-90}) translate(${(e.y0-1+(e.y1-1))/2*t},0) rotate(${n<180?0:180})`}function en(e,t){let n=this.getBBox().width;if(n>t){let a=e.label,r=(0,l.Ltv)(this);for(;n>t;)a=a.substring(0,a.length-1),r.text((()=>a)),n=this.getBBox().width;r.text((()=>`${a.substring(0,a.length-3).replace(/\s+$/,"")}...`))}}var tn=(e,t,n,a,r,i,o,s,c)=>(u,h)=>{c.sunburstLevel[s]=u.data.name,u.parent?(n.datum(u.parent),n.style("cursor","pointer"),a.html(`&#8682; ${u.label}`)):(n.datum(e),n.style("cursor","default"),a.html("")),e.each((e=>e.target={x0:2*Math.max(0,Math.min(1,(e.x0-u.x0)/(u.x1-u.x0)))*Math.PI,x1:2*Math.max(0,Math.min(1,(e.x1-u.x0)/(u.x1-u.x0)))*Math.PI,y0:Math.max(0,e.y0-u.depth),y1:Math.max(0,e.y1-u.depth)}));let d=t.transition().duration(h?0:750);r.transition(d).tween("data",(e=>{let t=(0,l.GWP)(e.current,e.target);return n=>e.current=t(n)})).filter((function(e){return+this.getAttribute("fill-opacity")||Zt(e.target)})).attr("fill-opacity",(e=>Zt(e.target)?1:0)).attr("user-select",(e=>Zt(e.target)?"initial":"none")).style("pointer-events",(e=>Zt(e.target)?"initial":"none")).attrTween("d",(e=>()=>Gt(o)(e.current))),i.filter((function(e){return+this.getAttribute("fill-opacity")||Jt(e.target)})).transition(d).attr("fill-opacity",(e=>+Jt(e.target))).attrTween("transform",(e=>()=>Qt(e.current,o)))};function nn(){let e=null,t=null,n=null,a=null,l=null,r=r=>{let i=r.selectAll("g.segment").data(n.descendants().slice(1)),o=i.enter().append("g").attr("class","segment");o.append("path"),o.append("text").attr("class","segment").attr("dy","0.35em");let s=o.merge(i),c=s.select("path").attr("fill-opacity",(e=>Zt(e.current)?1:0)).attr("user-select",(e=>Zt(e.current)?"initial":"none")).style("pointer-events",(e=>Zt(e.current)?"initial":"none")).attr("d",(e=>Gt(l)(e.current)));a&&c.style("fill",(e=>a(e.data.color)));let u=s.select("text").attr("fill-opacity",(e=>+Jt(e.current))).attr("transform",(e=>Qt(e.current,l))).text((e=>e.label)).each((function(e){en.call(this,e,l)})),h=r.select("text.parent"),d=r.select("circle").attr("r",l).datum(n),g=tn(n,r,d,h,c,u,l,t,e);if(e.sunburstLevel){let a=n.descendants().find((n=>n.data.name===e.sunburstLevel[t]));a&&g(a,!0)}else e.sunburstLevel={};d.on("click",(e=>g(e,!1))),c.filter((e=>e.children)).style("cursor","pointer").on("click",(e=>g(e,!1)))};return r.settings=function(){return arguments.length?(e=arguments.length<=0?void 0:arguments[0],r):e},r.split=function(){return arguments.length?(t=arguments.length<=0?void 0:arguments[0],r):t},r.data=function(){return arguments.length?(n=arguments.length<=0?void 0:arguments[0],r):n},r.color=function(){return arguments.length?(a=arguments.length<=0?void 0:arguments[0],r):a},r.radius=function(){return arguments.length?(l=arguments.length<=0?void 0:arguments[0],r):l},r}function an(e,t){let n=Ut(t),a=qt(t,n),r=Pt().elementsPrefix("sunburst");if(e.datum(n).call(r),a){let n=t.realValues[1];if("string"===t.mainValues.find((e=>e.name===n))?.type){let n=Ie().settings(t).scale(a);e.call(n)}else{let t=Tt().scale(a);e.call(t)}}let i=r.chartContainer(),o=r.chartEnter(),s=r.chartDiv(),c=r.chartTitle(),u=r.containerSize();c.each(((e,t,n)=>l.Ltv(n[t]).text(e.split))),i.append("circle").attr("fill","none").style("pointer-events","all"),i.append("text").attr("class","parent"),o.merge(s).select("svg").select("g.sunburst").attr("transform",`translate(${u.width/2}, ${u.height/2})`).each((function(e){let{split:n,data:r}=e,i=l.Ltv(this),o=this.parentNode,{width:s,height:c}=o.getBoundingClientRect(),u=(Math.min(s,c)-24)/Math.max(2,2*t.crossValues.length);nn().settings(t).split(n).data(r).color(a).radius(u)(i),he().settings(t)(i.selectAll("g.segment"))}))}an.plugin={name:"Sunburst",category:"Hierarchial Chart",max_cells:7500,max_columns:50,render_warning:!0,initial:{type:"number",count:1,names:["Size","Color","Tooltip"]}};var ln=an;function rn(e,t){if(e.realValues.length<1||null===e.realValues[1]||void 0===e.realValues[1])return;let n=e.realValues[1],a=t.filter((e=>e.height>0)).map((e=>on(e))).reduce(((e,t)=>e.concat(t)));if("string"===e.mainValues.find((e=>e.name===n))?.type)return ve(e,a);return Lt(e,null,null,[Math.min(...a),Math.max(...a)])}function on(e,t){return void 0===t&&(t=[]),e.children&&e.children.length>0?e.children.forEach((e=>t.concat(on(e,t)))):e.data.color&&t.push(e.data.color),t}var sn=e=>!(!e.target||!e.target.textAttributes),cn=(e,t,n)=>{e.selectAll("text").each((function(e,a){let l=vn(e,t,n);this.style=l}));let a=dn(e);pn(a),un(a)},un=e=>{let t=e=>e.getBoundingClientRect(),n=[];e.selectAll("text").filter(((e,t,n)=>(0,l.Ltv)(n[t]).attr("style")===xn.high)).each(((e,t,a)=>n.push(a[t]))),e.selectAll("text").filter(((e,t,n)=>(0,l.Ltv)(n[t]).attr("style")===xn.low)).each(((e,a,r)=>{let i=r[a];n.filter((e=>ee("x",t(e),t(i))&&ee("y",t(e),t(i),-2))).forEach((()=>(0,l.Ltv)(i).attr("dy",Number((0,l.Ltv)(i).attr("dy"))+14)))}))},hn={top:1,mid:.7,lower:0},dn=e=>e.filter(((e,t,n)=>(0,l.Ltv)(n[t]).selectAll("text").attr("style")!==xn.zero)),gn=e=>e.selectAll("text").each(((e,t,n)=>fn(n[t]))),pn=e=>e.selectAll("text").each(((e,t,n)=>mn(n[t]))),mn=e=>{let t=(0,l.Ltv)(e),n=e.getBoundingClientRect();t.attr("dx",0-n.width/2).attr("dy",0+n.height/4)},fn=e=>{let t=e.parentNode.childNodes[0],n=e.getBBox(),a=t.getBBox();yn(e,a,n)||(0,l.Ltv)(e).attr("style",(0,l.Ltv)(e).attr("style"))},yn=(e,t,n)=>{let a=Math.min(t.height/n.height,t.width/n.width);if(a<1){let t=parseInt((0,l.Ltv)(e).style("font-size")),n=Math.floor(t*a);return t>7&&n>7?((0,l.Ltv)(e).style("font-size",`${n}px`),mn(e)):((0,l.Ltv)(e).style("font-size",null),(0,l.Ltv)(e).style("opacity","0")),!0}return!1},vn=(e,t,n)=>{if(!n.filter((e=>""!==e)).every((t=>e.crossValue.includes(t))))return xn.zero;switch(e.depth){case t+1:return xn.high;case t+2:return xn.low;default:return xn.zero}},xn={high:"font-size:14px;z-index:5;pointer-events: none;",low:"font-size:8px;opacity:0.7;z-index:4;",zero:"font-size:0px;opacity:0;z-index:4;"},bn=(e,t)=>{let n=l.hkb().size([e,t]).paddingInner((e=>1+2*(e.height-1)));return n.tile(l.GaH),n};function wn(e,t,n,a,r,i){(function(e,t,n,a,l){let r={x:e.x0,y:e.y0,width:e.x1-e.x0,height:e.y1-e.y0},i={width:l.x1-l.x0,height:l.y1-l.y0},o={width:i.width/r.width,height:i.height/r.height};n.each((e=>{let n=(e.x0-r.x)*o.width,l=(e.y0-r.y)*o.height,i=Pn(e)*o.width,s=En(e)*o.height,c=((e,t)=>t.every((t=>e.crossValue.includes(t))))(e,t)&&e.data.name!==t[a-1];e.mapLevel[a]={x0:n,x1:i+n,y0:l,y1:s+l,visible:c,opacity:c?1:0}})),e.mapLevel[a].levelRoot=!0})(e,t,n,a,r),e.mapLevel[a].levelRoot=!0,function(e,t,n,a){let r=bn(t,n)((0,l.Sk5)(e.data).sum((e=>e.size))).descendants(),i=e.descendants();r.forEach(((e,t)=>{i[t].mapLevel[a].x0=r[t].x0,i[t].mapLevel[a].x1=r[t].x1,i[t].mapLevel[a].y0=r[t].y0,i[t].mapLevel[a].y1=r[t].y1}))}(e,i.node().getBoundingClientRect().width,i.node().getBoundingClientRect().height,a),_n(n,a)}var Vn=(e,t)=>{e.each(((e,n,a)=>{let r=(0,l.Ltv)(a[n]).selectAll("text");e.mapLevel[t].textAttributes={dx:r.attr("dx"),dy:r.attr("dy"),class:r.attr("class"),"font-size":r.style("font-size")}}))};function _n(e,t){e.selectAll("text").each(((e,n,a)=>{let r=(0,l.Ltv)(a[n]),i=(0,l.Ltv)(a[n]).datum(),o=r.attr("class");i.mapLevel[t].textLockedAt={opacity:hn[o]}}))}function kn(e,t,n,a,l,r,i,o,s,c){if(!e.children)return;l.treemapLevel<e.depth?l.treemapRoute.push(e.crossValue):l.treemapRoute.pop(),l.treemapLevel=e.depth;let u=e.crossValue;(!e.mapLevel[l.treemapLevel]||!e.mapLevel[l.treemapLevel].levelRoot)&&wn(e,u,n,l.treemapLevel,o,r),Sn(e,t,n,a,l,r,i,o,l.treemapLevel,u,s,c)}function Sn(e,t,n,a,r,i,o,s,c,u,h,d,g,p){void 0===g&&(g=500),void 0===p&&(p=!0);let m=e.parent,f=o.transition("main transition").duration(g).ease(l.TD8);n.each((e=>e.target=e.mapLevel[c])),sn(e)||Mn(n,h),n.transition(f).tween("data",(e=>{let t=l.GWP(e.current,e.target);return n=>e.current=t(n)})).styleTween("opacity",(e=>()=>e.current.opacity)).attrTween("pointer-events",(e=>()=>e.target.visible?"all":"none")),t.transition(f).filter((e=>e.target.visible)).styleTween("x",(e=>()=>`${e.current.x0}px`)).styleTween("y",(e=>()=>`${e.current.y0}px`)).styleTween("width",(e=>()=>e.current.x1-e.current.x0+"px")).styleTween("height",(e=>()=>e.current.y1-e.current.y0+"px")),a.transition(f).filter((e=>e.target.visible)).attrTween("x",(e=>()=>e.current.x0+Pn(e.current)/2)).attrTween("y",(e=>()=>e.current.y0+En(e.current)/2)).end().catch((()=>Ln(n))).then((()=>{sn(e)||(un(y),gn(y),async function(e,t,n){void 0===n&&(n=400);let a=t.transition("text fade transition").duration(n).ease(l.TD8);await e.transition(a).filter((e=>e.target.visible)).tween("data",((e,t,n)=>{let a=n[t],r=l.GWP(zn(e),An(a));return t=>e.current.opacity=r(t)})).styleTween("opacity",(e=>()=>e.current.opacity)).end().catch((e=>console.error("Exception in text fade transition",e))).then((()=>e.each(((e,t,n)=>(e=>(0,l.Ltv)(e).style("opacity",null))(n[t])))))}(a,o,g),p&&Vn(n,c),Ln(n,h))})).catch((e=>{console.error("Exception completing promises after main transition",e),Ln(n,h)})),sn(e)?(e=>{e.each(((e,t,n)=>{(0,l.Ltv)(n[t]).selectAll("text").attr("dx",e.target.textAttributes.dx).attr("dy",e.target.textAttributes.dy).attr("style",e.target.textAttributes.style)}))})(n):(a.each(((e,t,n)=>(e=>(0,l.Ltv)(e).style("opacity",hn[(0,l.Ltv)(e).attr("class")]))(n[t]))),cn(n,c,u));let y=dn(n);m?h.hide(!1).text(e.label).onClick((()=>{kn(m,t,n,a,r,i,o,s,h,d);let e=i.node().getRootNode().host.parentElement;ue(e,m,d)}))():h.hide(!0)()}var zn=e=>e.target.textLockedAt.opacity,An=e=>hn[l.Ltv(e).attr("class")],Mn=(e,t)=>{t.deactivate(!0),e.each(((e,t,n)=>{l.Ltv(n[t]).selectAll("rect").style("pointer-events","none")}))},Ln=function(e,t){void 0===t&&(t=void 0),t&&t.deactivate(!1),e.each(((e,t,n)=>{l.Ltv(n[t]).selectAll("rect").style("pointer-events",null)}))};var Nn="leafnode",$n="branchnode",Tn="rootnode",Pn=e=>e.x1-e.x0,En=e=>e.y1-e.y0,Cn=(e,t)=>0===t.depth?Tn:((e,t)=>t.depth===e)(e,t)?Nn:$n;function Rn(){let e=null,t=null,n=null,a=null,l=null,r=null,i=i=>{r=function(e){let t=null,n=null,a=!0,l=!1,r=J(e,".parent-controls",(()=>e.append("div").attr("class","parent-controls").style("display",a?"none":"").html('<button id="goto-parent">Goto parent</button>\n'))),i=()=>{r.style("display",a?"none":"").select("#goto-parent").style("pointer-events",l?"none":null).html(`\u21ea ${n}`).on("click",(()=>t()))};return i.deactivate=function(){if(!arguments.length)return l;l=arguments.length<=0?void 0:arguments[0];let e=r.select("#goto-parent");return l?e.style("pointer-events","none"):e.style("pointer-events",null),i},i.hide=function(){return arguments.length?(a=arguments.length<=0?void 0:arguments[0],i):a},i.text=function(){return arguments.length?(n=arguments.length<=0?void 0:arguments[0],i):n},i.onClick=function(){return arguments.length?(t=arguments.length<=0?void 0:arguments[0],i):t},i}(l),r();let o=n.height;e.treemapLevel||(e.treemapLevel=0),e.treemapRoute||(e.treemapRoute=[]),bn(l.node().getBoundingClientRect().width,l.node().getBoundingClientRect().height)(n);let s=i.selectAll("g").data(n.descendants()),c=s.enter().append("g");c.append("rect"),c.append("text");let u=c.merge(s).sort(((e,t)=>t.depth-e.depth)),h=u.select("rect").attr("class",(e=>`treerect ${Cn(o,e)}`)).style("x",(e=>`${e.x0}px`)).style("y",(e=>`${e.y0}px`)).style("width",(e=>`${Pn(e)}px`)).style("height",(e=>`${En(e)}px`));h.style("fill",(e=>Cn(o,e)===Nn?e.data.color?a(e.data.color):t.colorStyles.series:"transparent"));let d=u.filter((e=>0!==e.value)).select("text").attr("x",(e=>e.x0+Pn(e)/2)).attr("y",(e=>e.y0+En(e)/2)).text((e=>e.label)),g=h.filter((e=>0===e.crossValue.length)).datum();(function(e,t){e.each((e=>{e.mapLevel=[],e.mapLevel[0]={x0:e.x0,x1:Pn(e)+e.x0,y0:e.y0,y1:En(e)+e.y0,visible:!0,opacity:1}})),t.mapLevel[0].levelRoot=!0,_n(e,0)})(u,g),cn(u,0,[]),gn(dn(u)),Vn(u,0),0===e.treemapRoute.length&&e.treemapRoute.push(g.crossValue),h.filter((e=>e.children)).on("click",((n,a)=>kn(a,h,u,d,e,l,i,g,r,t))),function(e,t,n,a,l,r,i,o,s){if(a.treemapLevel>0){let c=i.crossValue;Sn(i,e,t,n,a,l,r,i,0,c,o,s,1,!1),a.treemapRoute.slice(1,a.treemapRoute.length).forEach((c=>{let u=t.filter((e=>e.crossValue===c)).datum(),h=u.crossValue;wn(u,h,t,u.depth,i,l),Sn(u,e,t,n,a,l,r,i,u.depth,h,o,s,1,!1)}))}}(h,u,d,e,l,i,g,r,t)};return i.settings=function(){return arguments.length?(e=arguments.length<=0?void 0:arguments[0],t=arguments.length<=1?void 0:arguments[1],i):e},i.data=function(){return arguments.length?(n=arguments.length<=0?void 0:arguments[0],i):n},i.color=function(){return arguments.length?(a=arguments.length<=0?void 0:arguments[0],i):a},i.container=function(){return arguments.length?(l=arguments.length<=0?void 0:arguments[0],i):l},i}function On(e,t){t.treemaps||(t.treemaps={});let n=Ut(t),a=rn(t,n.map((e=>e.data)));a&&this._container.classList.add("has-legend");let r=Pt().elementsPrefix("treemap");if(e.datum(n).call(r),a){let n=t.realValues[1];if("string"===t.mainValues.find((e=>e.name===n))?.type){let n=Ie().settings(t).scale(a);e.call(n)}else{let t=Tt().scale(a);e.call(t)}}let i=r.chartEnter(),o=r.chartDiv();r.chartTitle().each(((e,t,n)=>l.Ltv(n[t]).text(e.split))),i.merge(o).select("svg").select("g.treemap").each((function(e){let{split:n,data:r}=e,i=l.Ltv(this);t.treemaps[n]||(t.treemaps[n]={}),Rn().settings(t.treemaps[n],t).data(r).container(l.Ltv(l.Ltv(this.parentNode).node().parentNode)).color(a)(i),he().settings(t).centered(!0)(i.selectAll("g"))}))}On.plugin={type:"Treemap",name:"Treemap",category:"Hierarchial Chart",max_cells:3e3,max_columns:50,render_warning:!0,initial:{type:"number",count:1,names:["Size","Color","Tooltip"]}};var Hn=[tt,ut,ft,_t,St,At,Rt,jt,Ft,On,ln,Ht],Bn=(e,t)=>{if(!t.colorStyles){let n={scheme:[],gradient:{},interpolator:{},grid:{}},a=jn(e);n.series=a("--d3fc-local-series");for(let e=1;;e++){let t=`series-${e}`,l=a(`--d3fc-local-${t}`);if(!l)break;n[t]=l,n.scheme.push(l)}n.opacity=Dn(n.series),n.grid.gridLineColor=a`--d3fc-gridline--color`,["full","positive","negative"].forEach((e=>{let t=a(`--d3fc-local-${e}--gradient`);n.gradient[e]=In(t,n.opacity)})),t.colorStyles=n}if(!t.textStyles){let n=window.getComputedStyle(e),a=n.getPropertyValue("color"),l=`12px ${n.getPropertyValue("font-family")}`;t.textStyles={color:a,font:l}}},Dn=e=>l.yWT(e).opacity,Wn=(e,t)=>{let n=l.yWT(`#${e}`);return n.opacity=t,n+""},jn=e=>{let t=getComputedStyle(e);return e=>t?.getPropertyValue(e)},In=(e,t)=>{let n=s.q(e)[0].colorStops;return n.map(((e,a)=>[e.length?e.length.value/100:a/(n.length-1),Wn(e.value,t)])).sort(((e,t)=>e[0]-t[0]))},Fn={initial:{type:"number",count:1,names:[]},selectMode:"select"},qn=`:host .chart{--d3fc-local-full--gradient:var(--d3fc-full--gradient,linear-gradient(#4d342f 0%,#e4521b 22.5%,#feeb65 42.5%,#f0f0f0 50%,#dcedc8 57.5%,#42b3d5 67.5%,#1a237e 100%));--d3fc-local-positive--gradient:var(--d3fc-positive--gradient,linear-gradient(#dcedc8 0%,#42b3d5 35%,#1a237e 100%));--d3fc-local-negative--gradient:var(--d3fc-negative--gradient,linear-gradient(#feeb65 100%,#e4521b 70%,#4d342f 0%));--d3fc-local-series:var(--d3fc-series,rgba(31,119,180,0.5));--d3fc-local-series-1:var(--d3fc-series-1,#0366d6);--d3fc-local-series-2:var(--d3fc-series-2,#ff7f0e);--d3fc-local-series-3:var(--d3fc-series-3,#2ca02c);--d3fc-local-series-4:var(--d3fc-series-4,#d62728);--d3fc-local-series-5:var(--d3fc-series-5,#9467bd);--d3fc-local-series-6:var(--d3fc-series-6,#8c564b);--d3fc-local-series-7:var(--d3fc-series-7,#e377c2);--d3fc-local-series-8:var(--d3fc-series-8,#7f7f7f);--d3fc-local-series-9:var(--d3fc-series-9,#bcbd22);--d3fc-local-series-10:var(--d3fc-series-10,#17becf);}:host .chart .series{fill:var(--d3fc-local-series);}:host .chart .series-1{fill:var(--d3fc-local-series-1);}:host .chart .series-2{fill:var(--d3fc-local-series-2);}:host .chart .series-3{fill:var(--d3fc-local-series-3);}:host .chart .series-4{fill:var(--d3fc-local-series-4);}:host .chart .series-5{fill:var(--d3fc-local-series-5);}:host .chart .series-6{fill:var(--d3fc-local-series-6);}:host .chart .series-7{fill:var(--d3fc-local-series-7);}:host .chart .series-8{fill:var(--d3fc-local-series-8);}:host .chart .series-9{fill:var(--d3fc-local-series-9);}:host .chart .series-10{fill:var(--d3fc-local-series-10);}:host{user-select:none;}:host .chart{position:absolute;box-sizing:border-box;left:0;top:0;width:100%;height:100%;padding:12px;overflow:hidden;}:host .chart.heatmap d3fc-group.cartesian-chart,:host .chart.treemap d3fc-group.cartesian-chart{grid-template-columns:minmax(0em,max-content)auto 1fr auto minmax(0em,max-content);grid-template-rows:minmax(0em,max-content)auto 1fr auto minmax(0em,max-content);}:host .chart .chart-label{display:none;}:host .chart.heatmap{padding-right:120px;}:host .chart.xyscatter{padding:0;font-size:14px;}:host .chart.xyscatter d3fc-group:first-child{padding:16px;padding-top:0px;width:calc(100% - 32px);height:calc(100% - 16px);}:host .chart.xyscatter .multi-xlabel{position:absolute;bottom:0;height:2.5em;width:100%;display:flex;justify-content:center;align-items:center;background:var(--d3fc-legend--background);}:host .chart.xyscatter .multi-ylabel{position:absolute;top:0;width:2.5em;height:100%;display:flex;justify-content:center;align-items:center;background:var(--d3fc-legend--background);}:host .chart.xyscatter .outer-container{height:100%;}:host .chart.xyscatter .inner-container{display:inline-grid;overflow-y:auto;width:calc(100% - 16px);height:100%;padding:0;margin:0;}:host .chart.xyscatter .inner-container div{overflow:hidden;}:host .chart.xyscatter .inner-container text.segment,:host .chart.xyscatter .inner-container text.parent{text-anchor:middle;user-select:none;pointer-events:none;fill:var(--d3fc-treedata--labels,rgb(51,51,51));}:host .chart.xyscatter .inner-container div.xy-scatter-container{margin:5px 0;}:host .chart.sunburst{padding:0;font-size:14px;}:host .chart.sunburst .outer-container{height:100%;}:host .chart.sunburst .inner-container{width:100%;height:100%;display:inline-grid;padding:0;margin:0;overflow-x:hidden;overflow-y:auto;}:host .chart.sunburst .inner-container div{overflow:hidden;}:host .chart.sunburst .inner-container .sunburst-container:not(:only-child) svg{transform:translate(0,-27px);}:host .chart.sunburst .inner-container svg{width:100%;height:100%;}:host .chart.sunburst .inner-container path{fill:var(--d3fc-series,rgba(31,119,180,0.5));}:host .chart.sunburst .inner-container text.segment,:host .chart.sunburst .inner-container text.parent{text-anchor:middle;user-select:none;pointer-events:none;fill:var(--d3fc-treedata--labels,rgb(51,51,51));}:host .chart.sunburst .inner-container div.title-container{margin-top:5px;}:host .chart.has-legend{padding-right:120px;}:host .chart.treemap .treemap-container{position:relative;}:host .chart.treemap .treemap-container:not(:only-child){width:calc(100% - 12px);height:calc(100% - 12px);}:host .chart.treemap .outer-container{height:100%;}:host .chart.treemap .inner-container{width:100%;height:100%;display:inline-grid;padding:0;margin:0;overflow-x:hidden;overflow-y:auto;}:host .chart.treemap .inner-container div{overflow:hidden;}:host .chart.treemap .inner-container svg{width:100%;height:100%;}:host .chart.treemap .inner-container .treerect{stroke:var(--d3fc-treedata-axis--lines,var(--d3fc-axis--lines,white));fill:var(--d3fc-series,rgba(31,119,180,0.5));}:host .chart.treemap .inner-container .treerect:hover{cursor:pointer;stroke:var(--d3fc-treedata--hover-highlight,black);stroke-opacity:1;}:host .chart.treemap .inner-container .rootnode{opacity:0;pointer-events:none;z-index:0;}:host .chart.treemap .inner-container .branchnode{opacity:0;}:host .chart.treemap .inner-container .branchnode:hover{fill-opacity:0.1;opacity:1;fill:var(--d3fc-treedata--hover-highlight,black);}:host .chart.treemap .inner-container .leafnode{fill-opacity:0.8;}:host .chart.treemap .inner-container .leafnode:hover{fill-opacity:0.5;}:host .chart.treemap .inner-container #hidden{opacity:0;pointer-events:none;z-index:0;}:host .chart.treemap .inner-container .top{font-size:14px;z-index:5;pointer-events:none;}:host .chart.treemap .inner-container .mid{font-size:8px;opacity:0.7;z-index:4;}:host .chart.treemap .inner-container .lower{font-size:0px;opacity:0;z-index:4;}:host .chart.treemap .inner-container text{fill:var(--d3fc-treedata--labels,rgb(51,51,51));}:host .chart.treemap .inner-container text.title{dominant-baseline:hanging;}:host .chart.treemap .inner-container .parent-controls{position:absolute;top:12px;right:auto;left:30px;width:auto;z-index:4;transition:box-shadow 1s;}:host .chart.treemap .inner-container .parent-controls:hover{box-shadow:2px 2px 6px#000;transition:box-shadow 0.2s;}:host .chart .x-label{height:1.2em!important;line-height:1em!important;}:host .chart .x-label,:host .chart .y-label{color:var(--d3fc-label--color,inherit);font-size:14px;}:host .chart d3fc-canvas.plot-area{display:none;}:host .chart.xyscatter d3fc-canvas.plot-area,:host .chart.xyline d3fc-canvas.plot-area,:host .chart.ohlc d3fc-canvas.plot-area,:host .chart.candlestick d3fc-canvas.plot-area,:host .chart.heatmap d3fc-canvas.plot-area{display:block;}:host .chart .y-axis text,:host .chart .x-axis text{fill:var(--d3fc-axis-ticks--color,rgb(80,80,80));font-size:11px;}:host .chart .y-axis path,:host .chart .x-axis path{stroke:var(--d3fc-axis--lines,rgb(180,210,225));}:host .chart .splitter-label{display:inline-block;margin:0 10px;cursor:pointer;}:host .chart .splitter-label::after{margin-left:5px;color:var(--d3fc-axis--lines,rgb(180,210,225));}:host .chart .splitter-label:hover::after{color:var(--d3fc-axis-ticks--color,rgb(80,80,80));}:host .chart .splitter-label.disabled::after{color:rgba(80,80,80,0.3);}:host .chart .splitter-label.disabled{cursor:default;}:host .chart .y-label.left-label .splitter-label::after{background-repeat:no-repeat;background-color:var(--icon--color);content:"";display:inline-block;-webkit-mask-size:cover;mask-size:cover;width:16px;height:12px;-webkit-mask-image:var(--sort-desc-icon--mask-image);mask-image:var(--sort-desc-icon--mask-image);}:host .chart .y-label.right-label .splitter-label::after{background-repeat:no-repeat;background-color:var(--icon--color);content:"";display:inline-block;-webkit-mask-size:cover;mask-size:cover;width:16px;height:12px;-webkit-mask-image:var(--sort-asc-icon--mask-image);mask-image:var(--sort-asc-icon--mask-image);}:host .chart.ybar .y-axis path,:host .chart.yline .y-axis path,:host .chart.xyline .y-axis path,:host .chart.xyline .x-axis path,:host .chart.yarea .y-axis path,:host .chart.yscatter .y-axis path,:host .chart.xyscatter .y-axis path,:host .chart.xyscatter .x-axis path,:host .chart.xbar .x-axis path{visibility:hidden;}:host .chart .y-label{white-space:nowrap;}:host .chart .nearbyTip{fill:var(--d3fc-series,rgba(31,119,180,0.5));}:host #dragHandles{position:absolute;top:0px;right:0px;left:auto;pointer-events:none;}:host #dragHandles rect{pointer-events:all;}:host .label rect{fill:none;}:host .legend-container{position:absolute;top:12px;right:12px;left:auto;width:150px;height:280px;}:host .legend-container.legend-color{width:90px;height:150px;}:host .legend-container[borderbox-on-hover="true"]{transition:box-shadow 1s;}:host .legend-container[borderbox-on-hover="true"]:hover{background-color:var(--d3fc-legend--background,#ffffff);transition:box-shadow 0.2s,background-color 0.2s;}:host .legend-container .legend{font-size:8pt;width:100%;}:host .legend-container .legend .cell{cursor:pointer;}:host .legend-container .legend .cell path{fill:var(--d3fc-series,rgba(31,119,180,0.5));stroke:var(--d3fc-series,rgb(31,119,180));}:host .legend-container .legend .cell.hidden path{fill:rgba(204,204,204,0.5);stroke:rgb(204,204,204);}:host .legend-container .legend .cell.hidden circle{fill:rgb(204,204,204)!important;}:host .legend-container text{fill:var(--d3fc-legend--text,rgb(51,51,51));}:host .legend-container .label:hover{fill:rgb(34,160,206);}:host .legend-container #legend-axis path{stroke:var(--d3fc-legend--text,rgb(51,51,51));}:host .legend-container .legend-controls{margin-left:12px;}:host .legend-container .legend-controls #up-arrow,:host .legend-container .legend-controls #down-arrow{cursor:pointer;color:rgb(31,119,180);}:host .legend-container .legend-controls #up-arrow.disabled,:host .legend-container .legend-controls #down-arrow.disabled{cursor:default;color:rgb(51,51,51);}:host .heatmap .legend-container.legend-color{height:200px;}:host .treemap .legend-container.legend-color{height:200px;}:host .treemap .legend-container:not(.legend-color){width:100px;}:host .zoom-controls{position:absolute;top:10px;left:0;width:100%;text-align:center;}:host .zoom-controls button{-webkit-appearance:none;background:var(--plugin--background,rgb(247,247,247));border:1px solid var(--inactive--color,rgb(204,204,204));color:var(--d3fc-label--color,inherit);font-size:12px;padding:8px;opacity:0.5;cursor:pointer;}:host .zoom-controls button:hover{opacity:1;}:host .parent-controls{position:absolute;top:30px;right:145px;width:100%;text-align:right;}:host .parent-controls button{-webkit-appearance:none;background:rgb(247,247,247);border:1px solid rgb(204,204,204);padding:10px;opacity:0.5;cursor:pointer;}:host .parent-controls button:hover{background:rgb(230,230,230);}:host div.tooltip{position:absolute;text-align:left;font-size:12px;font-weight:300;white-space:nowrap;padding:0.5em;background:var(--d3fc-tooltip--background,#ffffff);color:var(--d3fc-tooltip--color,black);border:1px solid var(--d3fc-tooltip--border-color,#777777);box-shadow:var(--d3fc-tooltip--box-shadow,none);pointer-events:none;}:host div.tooltip ul{margin:0;padding:0;list-style-type:none;}${function(){let e=document.querySelector("head").querySelectorAll("style"),t=[];return e.forEach((e=>{-1!==e.innerText.indexOf("d3fc-")&&t.push(e.innerText)})),t.join("")}()}`,Yn=["crossValues","mainValues","realValues","splitValues","filter","data","size","colorStyles","textStyles","agg_paths","treemaps","axisMemo","columns_config"];Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector),function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];let a=new Set(t.length>0?t:Hn.map((e=>e.plugin.name)));Hn.forEach((e=>{if(a.has(e.plugin.name)){let t=e.plugin.name.toLowerCase().replace(/[ \t\r\n\/]*/g,""),n=`perspective-viewer-d3fc-${t}`;customElements.define(n,class extends HTMLElement{_chart;_settings;render_warning;_initialized;_container;_staged_view;config;constructor(){super(),this._chart=null,this._settings=null,this.render_warning=!0}connectedCallback(){this._initialized||(this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML=`<style>${qn}</style>`,this.shadowRoot.innerHTML+='<div id="container" class="chart"></div>',this._container=this.shadowRoot.querySelector(".chart"),this._initialized=!0)}get name(){return e.plugin.name}get category(){return e.plugin.category}get select_mode(){return e.plugin.selectMode||"select"}get min_config_columns(){return e.plugin.initial?.count||Fn.initial.count}get config_column_names(){return e.plugin.initial?.names||Fn.initial.names}get max_cells(){return e.plugin.max_cells||4e3}set max_cells(t){e.plugin.max_cells=t}get max_columns(){return e.plugin.max_columns||50}set max_columns(t){e.plugin.max_columns=t}can_render_column_styles(t,n){return e.can_render_column_styles?.call(this,t,n)}column_style_controls(t,n){return e.column_style_controls?.call(this,t,n)}async render(){var e=document.createElement("canvas"),t=this.shadowRoot.querySelector("#container");e.width=t.offsetWidth,e.height=t.offsetHeight;let n=e.getContext("2d");n.fillStyle=window.getComputedStyle(this).getPropertyValue("--plugin--background")||"white",n.fillRect(0,0,e.width,e.height);let a=window.getComputedStyle(this).getPropertyValue("color"),l=Array.from(this.shadowRoot.querySelectorAll("svg:not(#dragHandles)"));for(let s of l.reverse()){var r=document.createElement("img");let e=0;r.width=s.parentElement?s.parentElement.offsetWidth:e,r.height=s.parentElement?s.parentElement.offsetHeight:e;let t=s.cloneNode(!0);t.hasAttribute("viewBox")||t.setAttribute("viewBox",`0 0 ${r.width} ${r.height}`),t.setAttribute("xmlns","http://www.w3.org/2000/svg");for(let n of t.querySelectorAll("text"))n.setAttribute("fill",a);var i=(new XMLSerializer).serializeToString(t);i=i.replace(/[^\x00-\x7F]/g,"");let l=new Promise(((e,t)=>{r.onload=e,r.onerror=t}));try{r.src=`data:image/svg+xml;base64,${btoa(i)}`,await l}catch{let e=new Promise(((e,t)=>{r.onload=e,r.onerror=t}));r.src=`data:image/svg+xml;utf8,${i}`,await e}n.drawImage(r,s.parentNode.offsetLeft,s.parentNode.offsetTop,r.width,r.height)}let o=Array.from(this.shadowRoot.querySelectorAll("canvas"));for(let s of o.reverse())n.drawImage(s,s.parentNode.offsetLeft,s.parentNode.offsetTop,s.width/window.devicePixelRatio,s.height/window.devicePixelRatio);return await new Promise((t=>e.toBlob((e=>t(e)))),"image/png")}async draw(e,t,n){null!==this.offsetParent?(this._staged_view=void 0,this._settings&&(this._settings.axisMemo=[[1/0,-1/0],[1/0,-1/0]]),await this.update(e,t,n,!0)):this._staged_view=[e,t,n]}async update(t,n,a,l){if(void 0===l&&(l=!1),null===this.offsetParent)return;let r,i,o=this.parentElement,s="Sunburst"!==e.plugin.name;r=n&&a?t.to_columns_string({end_row:a,end_col:n,leaves_only:s}):n?t.to_columns_string({end_col:n,leaves_only:s}):a?t.to_columns_string({end_row:a,leaves_only:s}):t.to_columns_string({leaves_only:s}),i=await Promise.all([o.save(),o.getTable().then((e=>e.schema())),t.expression_schema(!1),t.schema(!1),r,t.get_config()]);let[c,u,h,d,g,p]=i,m=JSON.parse(g),f=Object.keys(m),y={row(e){let t={};for(let n of f)t[n]=m[n][e];return t}};this.config=c;let v=this.config.columns,x=function(e){let t=u[e];return t||(t=h[e]),t},{columns:b,group_by:w,split_by:V,filter:_}=p,k=m[Object.keys(m)[0]]||[],S=w.length>0?k.reduce(((e,t,n)=>{let a=y.row(n);if(a.__ROW_PATH__&&a.__ROW_PATH__.length==w.length)e.agg_paths.push(e.aggs.slice()),e.rows.push(a);else{let t=a.__ROW_PATH__.filter((e=>void 0!==e)).length;e.aggs[t]=a,e.aggs=e.aggs.slice(0,t+1)}return e}),{rows:[],aggs:[],agg_paths:[]}):{rows:k.map(((e,t)=>y.row(t)))},z=S.rows.map(((e,t)=>w.length?e:{...e,__ROW_PATH__:[t]})),A={realValues:v,crossValues:w.map((e=>({name:e,type:x(e)}))),mainValues:b.map((e=>({name:e,type:d[e]}))),splitValues:V.map((e=>({name:e,type:x(e)}))),filter:_,data:z,agg_paths:S.agg_paths,...this.config.plugin_config};this._chart=e;let M={set:(e,t,n)=>(Yn.includes(t)||this._container&&this._container.dispatchEvent(new Event("perspective-plugin-update",{bubbles:!0,composed:!0})),e[t]=n,!0)};this._settings=new Proxy({axisMemo:[[1/0,-1/0],[1/0,-1/0]],...this._settings,...A},M),this._settings.splitMainValues&&this._settings.splitMainValues.length>=b.length&&(this._settings.splitMainValues=[]),Bn(this._container,this._settings),l&&(this._container.innerHTML=""),this._draw(),await new Promise((e=>requestAnimationFrame(e)))}async clear(){this._container&&(this._container.innerHTML="")}_draw(){if(null!==this.offsetParent){let e=l.Ltv(this._container),n=`chart ${t}`;this._settings.size=this._container.getBoundingClientRect(),this._settings.data.length>0?this._chart(e.attr("class",n),this._settings):e.attr("class",`${n} disabled`)}}async resize(e){if(null!==this.offsetParent)if(void 0!==this._settings?.data)this._draw();else{let[e,t,n]=this._staged_view;this._staged_view=void 0,this.draw(e,t,n)}}async restyle(e,t,n){let a=this._settings;a&&(delete a.colorStyles,delete a.textStyles,this.isConnected&&(Bn(this._container,this._settings),this.resize(e)))}async delete(){this._container.innerHTML=""}getContainer(){return this._container}save(){let e={...this._settings};return Yn.forEach((t=>{delete e[t]})),e}restore(e,t){let n={};for(let a of Yn)void 0!==this._settings?.[a]&&(n[a]=this._settings?.[a]);this._settings={...n,...e,columns_config:t}}}),customElements.whenDefined("perspective-viewer").then((()=>async function(e){await customElements.get("perspective-viewer").registerPlugin(e)}(n)))}}))}()}}]);