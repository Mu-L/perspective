(self.webpackChunk_finos_perspective_docs=self.webpackChunk_finos_perspective_docs||[]).push([[640],{8640:(e,t,r)=>{r.r(t);r(1201);var o=r(2775),l=Object.defineProperty,a=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)},s=(e,t,r)=>(a(e,t,"read from private field"),r?r.call(e):t.get(e)),i='regular-table{padding:0;margin:12px 0 0 12px;font-family:inherit;--rt-hover--border-color:var(--inactive--color,#c5c9d080);}regular-table div[tabindex]{outline:none;}regular-table>div{position:absolute;top:0;left:0;right:0;bottom:0;overflow:hidden;}regular-table th{text-align:center;}regular-table thead tr:not(.rt-autosize) th{overflow:hidden;max-width:0px;}regular-table thead tr:last-child .rt-float,regular-table tbody .rt-float{text-align:right;}regular-table thead .rt-integer,regular-table tbody .rt-integer{text-align:right;}regular-table tbody th{text-align:left;}regular-table span.rt-tree-container{display:flex;align-items:center;height:100%;}regular-table thead .rt-string,regular-table tbody .rt-string,regular-table thead .rt-date,regular-table tbody .rt-date,regular-table thead .rt-datetime,regular-table tbody .rt-datetime{text-align:left;}regular-table thead tr:last-child th{border-bottom:1px solid#8b868045;}regular-table tbody tr:first-child td,regular-table tbody tr:first-child th{border-top:1px solid transparent!important;}regular-table th{position:relative;}regular-table tr th span.rt-tree-group{margin-left:5px;margin-right:15px;border-left:1px solid#eee;height:100%;}regular-table td,regular-table th{white-space:nowrap;font-size:12px;padding-right:5px;padding-left:5px;padding-top:0px;padding-bottom:0px;height:19px;}regular-table table *{box-sizing:border-box;}regular-table table{position:absolute;color:#666;outline:none;}regular-table span.rt-row-header-icon{color:#aaa;padding-right:4px;font-family:var(--button--font-family);}regular-table span.rt-column-header-icon{font-size:10px;padding-left:3px;display:inline-block;width:10px;font-family:var(--button--font-family);}regular-table span.rt-row-header-icon:hover{color:#1a7da1;text-shadow:0px 0px 3px#1a7da1;}regular-table .rt-selected td{background-color:#eee;}regular-table .rt-cell-clip{overflow:hidden;text-overflow:ellipsis;}regular-table td span.rt-group-name,regular-table th span.rt-group-name{margin-right:-5px;padding-right:5px;padding-left:8px;flex:1;height:100%;}regular-table th span.rt-group-name{text-align:left;}regular-table td th span.rt-group-leaf,regular-table th span.rt-group-leaf{margin-left:16px;height:100%;}regular-table .rt-column-resize{height:100%;width:10px;position:absolute;top:0;right:0;cursor:col-resize;}regular-table a{color:var(--rt-pos-cell--color);}regular-table a:visited{color:var(--active--color);}.psp-header-border:not(.psp-is-top):not(.psp-header-leaf){box-shadow:1px 0px var(--inactive--border-color,#8b868045);}.psp-header-group{box-shadow:0px 10px 0 -9px var(--inactive--border-color,#8b868045);}.psp-is-top{box-shadow:5px 4px 0px -4px var(--inactive--border-color,#8b868045);}.psp-is-top.psp-header-group:not(.psp-header-group-corner){box-shadow:5px 4px 0px -4px var(--inactive--border-color,#8b868045),0px 10px 0 -9px var(--inactive--border-color,#8b868045);}.psp-header-border.psp-header-group:not(.psp-is-top):not(.psp-header-group-corner){box-shadow:1px 0px var(--inactive--border-color,#8b868045),0px 10px 0 -9px var(--inactive--border-color,#8b868045);}perspective-viewer[settings] tr.rt-autosize .psp-header-leaf.psp-header-border:not(.psp-menu-enabled){box-shadow:1px 0px var(--inactive--border-color,#8b868045);}:host-context(perspective-viewer[settings]) tr.rt-autosize .psp-header-leaf.psp-header-border:not(.psp-menu-enabled){box-shadow:1px 0px var(--inactive--border-color,#8b868045);}.psp-header-leaf.psp-header-border{box-shadow:5px -4px 0px -4px var(--inactive--border-color,#8b868045);}tr:only-child th{box-shadow:none!important;}regular-table tbody tr:hover th.psp-tree-leaf:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover th.psp-tree-label:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover td:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover:after{border-color:var(--rt-hover--border-color,#c5c9d080)!important;background-color:transparent;box-shadow:0px 1px 0px var(--rt-hover--border-color,#c5c9d080);}regular-table tbody tr:hover th.psp-tree-leaf.psp-menu-open:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover th.psp-tree-label.psp-menu-open:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover td.psp-menu-open:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr.psp-menu-open:hover:after{box-shadow:inset -2px 0px 0px var(--icon--color),inset 2px 0px 0px var(--icon--color),0px 1px 0px var(--rt-hover--border-color,#c5c9d080);}regular-table tbody tr:last-child:hover td.psp-menu-open:not(.psp-row-selected):not(.psp-row-subselected){box-shadow:inset -2px 0px 0px var(--icon--color),inset 2px 0px 0px var(--icon--color),inset 0px -2px 0px var(--icon--color),0px 1px 0px var(--rt-hover--border-color,#c5c9d080);}regular-table tbody tr:hover+tr th.psp-tree-leaf:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover+tr th.psp-tree-label:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover+tr td:not(.psp-row-selected):not(.psp-row-subselected){border-top-color:transparent;}regular-table tbody tr th:first-child:not(:empty),regular-table tbody tr th:first-child:empty+th:not(:empty),regular-table tbody tr th:first-child:empty~th:empty+th:not(:empty),regular-table tbody tr td:first-child{border-left-width:1px;border-left-color:transparent;}regular-table tbody tr th:last-child,regular-table tbody tr td:last-child{border-right-width:0px;border-right-color:transparent;}regular-table tbody tr:hover{color:inherit;}regular-table tbody tr:hover th:first-child:not(:empty),regular-table tbody tr:hover th:first-child:empty+th:not(:empty),regular-table tbody tr:hover th:first-child:empty~th:empty+th:not(:empty),regular-table tbody tr:hover td:first-child{border-left-color:var(--rt-hover--border-color,#c5c9d080)!important;}regular-table tbody tr:hover th:last-child,regular-table tbody tr:hover td:last-child{border-right-color:var(--rt-hover--border-color,#c5c9d080)!important;}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody td,perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table thead th:not(.rt-group-corner),:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody td,:host(:not(.sub-cell-scroll-disabled)) regular-table table thead th:not(.rt-group-corner){transform:translate(var(--regular-table--transform-x,0px));}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody,:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody{transform:translate(0,var(--regular-table--transform-y,0px));}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody tr:first-child td,perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody tr:first-child th,:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody tr:first-child td,:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody tr:first-child th{clip-path:polygon(0 var(--regular-table--clip-y,0),0 200%,200% 200%,200% var(--regular-table--clip-y,0));}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody tr td:first-of-type,:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody tr td:first-of-type{clip-path:polygon(var(--regular-table--clip-x,0)0,var(--regular-table--clip-x,0)200%,200% 200%,200% 0);}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody tr:first-child td:first-of-type,:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody tr:first-child td:first-of-type{clip-path:polygon(var(--regular-table--clip-x,0)var(--regular-table--clip-y,0),var(--regular-table--clip-x,0)200%,200% 200%,200% var(--regular-table--clip-y,0));}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table thead tr:last-child:after,:host(:not(.sub-cell-scroll-disabled)) regular-table table thead tr:last-child:after{transform:translate(var(--regular-table--transform-x,0px));}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody tr:not(:first-child):after,:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody tr:not(:first-child):after{transform:translate(var(--regular-table--transform-x,0px));}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody tr:hover:first-child:after,:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody tr:hover:first-child:after{clip-path:polygon(0 var(--regular-table--clip-y,0),0 200%,200% 200%,200% var(--regular-table--clip-y,0));}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table thead tr th.rt-group-corner+th:not(.rt-group-corner),:host(:not(.sub-cell-scroll-disabled)) regular-table table thead tr th.rt-group-corner+th:not(.rt-group-corner){clip-path:polygon(var(--regular-table--clip-x,0)0,var(--regular-table--clip-x,0)200%,200% 200%,200% 0);}regular-table{outline:none;}regular-table::-webkit-scrollbar,regular-table::-webkit-scrollbar-corner{background-color:transparent;height:12px;width:12px;}regular-table::-webkit-scrollbar-thumb{background-clip:content-box;background:var(--icon--color);border:5.5px solid var(--plugin--background);max-height:50%;max-width:50%;min-width:10%;min-height:10%;}perspective-viewer:not([settings]) regular-table table tr.rt-autosize+tr th{height:0px;}perspective-viewer:not([settings]) regular-table table tr.rt-autosize+tr th span{display:none;}:host-context(perspective-viewer:not([settings])) regular-table table tr.rt-autosize+tr th{height:0px;}:host-context(perspective-viewer:not([settings])) regular-table table tr.rt-autosize+tr th span{display:none;}perspective-viewer[settings] .psp-menu-enabled{padding:0 6px;font-size:8px;border-radius:3px 3px 0 0;}perspective-viewer[settings] .psp-menu-enabled:hover,perspective-viewer[settings] tr:not(.rt-autosize) th.psp-menu-open{color:var(--plugin--background);background-color:var(--icon--color);border-bottom-color:var(--icon--color);cursor:pointer;}perspective-viewer[settings] tr:not(.rt-autosize) th.psp-menu-open:before{background-repeat:no-repeat;background-color:var(--icon--color);content:"";display:inline-block;-webkit-mask-size:cover;mask-size:cover;height:8px;width:10px;-webkit-mask-image:var(--column-settings-icon--mask-image);mask-image:var(--column-settings-icon--mask-image);margin-right:4px;background-color:var(--plugin--background);}perspective-viewer[settings] td.psp-menu-open{box-shadow:inset -2px 0px 0px var(--icon--color),inset 2px 0px 0px var(--icon--color);}perspective-viewer[settings] tr:first-child td.psp-menu-open{border-top-color:var(--icon--color)!important;}perspective-viewer[settings] tr:last-child td.psp-menu-open{box-shadow:inset -2px 0px 0px var(--icon--color),inset 2px 0px 0px var(--icon--color),inset 0px -2px 0px var(--icon--color);}:host-context(perspective-viewer[settings]) .psp-menu-enabled{padding:0 6px;font-size:8px;border-radius:3px 3px 0 0;}:host-context(perspective-viewer[settings]) .psp-menu-enabled:hover,:host-context(perspective-viewer[settings]) tr:not(.rt-autosize) th.psp-menu-open{color:var(--plugin--background);background-color:var(--icon--color);border-bottom-color:var(--icon--color);cursor:pointer;}:host-context(perspective-viewer[settings]) tr:not(.rt-autosize) th.psp-menu-open:before{background-repeat:no-repeat;background-color:var(--icon--color);content:"";display:inline-block;-webkit-mask-size:cover;mask-size:cover;height:8px;width:10px;-webkit-mask-image:var(--column-settings-icon--mask-image);mask-image:var(--column-settings-icon--mask-image);margin-right:4px;background-color:var(--plugin--background);}:host-context(perspective-viewer[settings]) td.psp-menu-open{box-shadow:inset -2px 0px 0px var(--icon--color),inset 2px 0px 0px var(--icon--color);}:host-context(perspective-viewer[settings]) tr:first-child td.psp-menu-open{border-top-color:var(--icon--color)!important;}:host-context(perspective-viewer[settings]) tr:last-child td.psp-menu-open{box-shadow:inset -2px 0px 0px var(--icon--color),inset 2px 0px 0px var(--icon--color),inset 0px -2px 0px var(--icon--color);}perspective-viewer regular-table table thead tr:last-child th{border-bottom-width:1px;border-bottom-color:var(--inactive--border-color,#8b868045);}:host-context(perspective-viewer) regular-table table thead tr:last-child th{border-bottom-width:1px;border-bottom-color:var(--inactive--border-color,#8b868045);}.psp-sort-enabled:hover{cursor:pointer;}.psp-row-selected,:hover .psp-row-selected,:hover th.psp-tree-leaf.psp-row-selected,:hover th.psp-tree-label.psp-row-selected{color:white!important;background-color:#ea7319!important;border-color:#ea7319!important;}.psp-row-selected.psp-tree-label:not(:hover):before{color:white;}.psp-row-subselected,:hover .psp-row-subselected,:hover th.psp-tree-leaf.psp-row-subselected,:hover th.psp-tree-label.psp-row-subselected{background:rgba(234,115,25,0.2)!important;}.psp-error{color:red;}td:focus{outline:#666;outline-style:dotted;outline-width:1px;}perspective-viewer.dragging regular-table{pointer-events:none;}:host-context(perspective-viewer.dragging) regular-table{pointer-events:none;}.psp-header-border:last-child{border-right-width:0px;}.psp-header-sort-desc:after{background-repeat:no-repeat;background-color:var(--icon--color);content:"";display:inline-block;-webkit-mask-size:cover;mask-size:cover;width:14px;height:12px;-webkit-mask-image:var(--sort-desc-icon--mask-image);mask-image:var(--sort-desc-icon--mask-image);}.psp-header-sort-asc:after{background-repeat:no-repeat;background-color:var(--icon--color);content:"";display:inline-block;-webkit-mask-size:cover;mask-size:cover;width:14px;height:12px;-webkit-mask-image:var(--sort-asc-icon--mask-image);mask-image:var(--sort-asc-icon--mask-image);}.psp-header-sort-col-desc:after{background-repeat:no-repeat;background-color:var(--icon--color);content:"";display:inline-block;-webkit-mask-size:cover;mask-size:cover;width:14px;height:12px;-webkit-mask-image:var(--sort-col-desc-icon--mask-image);mask-image:var(--sort-col-desc-icon--mask-image);}.psp-header-sort-col-asc:after{background-repeat:no-repeat;background-color:var(--icon--color);content:"";display:inline-block;-webkit-mask-size:cover;mask-size:cover;width:14px;height:12px;-webkit-mask-image:var(--sort-col-asc-icon--mask-image);mask-image:var(--sort-col-asc-icon--mask-image);}tbody th:last-of-type{border-right:1px solid var(--inactive--border-color,#8b868045);overflow:hidden;text-overflow:ellipsis;}tbody th:empty{background-image:linear-gradient(to right,transparent 9px,var(--inactive--border-color,#eee)10px,transparent 11px);background-repeat:no-repeat;min-width:20px;max-width:20px;pointer-events:none;}.psp-tree-label{max-width:0px;min-width:0px;}.psp-tree-label:before{color:var(--icon--color);font-family:var(--button--font-family,inherit);padding-right:11px;}.psp-tree-label-expand:before{content:var(--tree-label-expand--content,"+");}.psp-tree-label-collapse:before{content:var(--tree-label-collapse--content,"-");}.psp-tree-label-expand,.psp-tree-label-collapse{cursor:pointer;}.psp-tree-label:hover:before{color:var(--active--color);text-shadow:0px 0px 5px var(--active--color);}.psp-tree-leaf{padding-left:24px;}.psp-align-right{text-align:right;}.psp-align-left{text-align:left;}.psp-positive:not(:focus){color:var(--rt-pos-cell--color);}.psp-negative:not(:focus){color:var(--rt-neg-cell--color);}regular-table table tbody td{min-width:52px!important;}.psp-is-width-override .rt-column-resize,.rt-column-resize:hover{border:1px dashed#999;border-bottom-width:0px;border-left-width:0px;}.boolean-editable{cursor:pointer;}regular-table table{user-select:none;color:inherit;border-collapse:separate;}regular-table table th{font-weight:400;}regular-table table td,regular-table table th{border-color:var(--inactive--border-color,#8b868045);height:23px;}regular-table table .psp-header-group{text-overflow:ellipsis;}regular-table table th.psp-header-leaf{border-bottom-width:0px;}regular-table table th.psp-header-leaf span{height:23px;min-height:23px;}regular-table table td,regular-table table th.psp-tree-label,regular-table table th.psp-tree-label,regular-table table th.psp-tree-leaf,regular-table table tbody tr:first-child th{border-style:solid;border-width:0px;border-top-width:1px;}regular-table table tbody th:empty{background-position:0px -10px;}regular-table table td.psp-select-region,regular-table table th.psp-select-region{background-color:var(--icon--color)!important;color:var(--plugin--background)!important;border-color:var(--plugin--background)!important;}regular-table tbody tr:hover td.psp-select-region:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover+tr td.psp-select-region:not(.psp-row-selected):not(.psp-row-subselected){border-color:var(--plugin--background)!important;}regular-table tbody tr:hover td.psp-select-region.psp-menu-open:not(.psp-row-selected):not(.psp-row-subselected){box-shadow:inset -2px 0px 0px var(--plugin--background),inset 2px 0px 0px var(--plugin--background);}:host-context(perspective-viewer[settings]) td.psp-select-region.psp-menu-open{box-shadow:inset -2px 0px 0px var(--plugin--background),inset 2px 0px 0px var(--plugin--background);}regular-table #psp-column-edit-buttons th:not(.rt-group-corner) span:not(.rt-column-resize):before{content:var(--datagrid-column-edit-button--content,"Edit");}perspective-viewer:not([settings]) regular-table #psp-column-edit-buttons:after{content:none;}:host-context(perspective-viewer:not([settings])) regular-table #psp-column-edit-buttons:after{content:none;}regular-table table thead tr:last-child:after{width:10000px;box-sizing:border-box;display:block;height:23px;content:" ";border-bottom:1px solid var(--inactive--border-color);}regular-table table tbody tr:after{width:10000px;box-sizing:border-box;display:block;height:23px;content:" ";border-top:1px solid transparent;}regular-table table tbody tr:not(:first-child):after{border-top:1px solid var(--inactive--border-color);}regular-table table tbody tr:hover:not(:first-child):after{border-top:1px solid var(--rt-hover--border-color);}regular-table table tbody tr:hover+tr:after{border-top:1px solid var(--rt-hover--border-color);}@keyframes pulse_pos{0%{background-color:var(--pulse--background-color-start,rgba(0,128,255,0.5));}100%{background-color:var(--pulse--background-color-end,rgba(0,128,255,0));}}@keyframes pulse_pos2{0%{background-color:var(--pulse--background-color-start,rgba(0,128,255,0.5));}100%{background-color:var(--pulse--background-color-end,rgba(0,128,255,0));}}@keyframes pulse_neg{0%{background-color:var(--pulse--background-color-start,rgba(255,25,0,0.5));}100%{background-color:var(--pulse--background-color-end,rgba(255,25,0,0));}}@keyframes pulse_neg2{0%{background-color:var(--pulse--background-color-start,rgba(255,25,0,0.5));}100%{background-color:var(--pulse--background-color-end,rgba(255,25,0,0));}}',n=Symbol("Plugin Symbol");function d(e){return e.x>=0?this._column_types[e.x]:this._row_header_types[e.row_header_x-1]}function c(e,t,r){let o=Array.from(e.children[0].children[0].children),l=o.length,a=t.hasAttribute("settings");if(l<=1?o[0]?.removeAttribute("id"):o.forEach(((e,t)=>{let r=a?1:0,o=t===l-(r+1)?"psp-column-titles":t===l-r?"psp-column-edit-buttons":null;o?e.setAttribute("id",o):e.removeAttribute("id")})),t.classList.toggle("psp-menu-open",!!r),a&&l>=2){let t=Array.from(o[l-2].children),a=Array.from(o[l-1].children);if(t&&a){o.slice(0,l-2).forEach((e=>{Array.from(e.children).forEach((e=>{e.classList.toggle("psp-menu-open",!1)}))}));for(let o=0;o<t.length;o++){let l=t[o],s=a[o],i=l.textContent===r;if(l.classList.toggle("psp-menu-open",i),s.classList.toggle("psp-menu-open",i),this._config.columns.length>1)for(let t of e.querySelectorAll("td")){let o=e.getMeta(t),l=o.column_header[o.column_header.length-2]===r;t.classList.toggle("psp-menu-open",l)}}}}}function p(e,t){let r=Array.from(e.children[0].children[0].children);if(r.length>0){c.call(this,e,t,this._column_settings_selected_column);let[o]=r.splice(this._config.split_by.length,1);g.call(this,e,o,!1);let[l]=r.splice(this._config.split_by.length,1);l&&g.call(this,e,l,!0)}}function g(e,t,r){let o=e._view_cache.config.row_pivots.length-1;for(let l of t?.children){let t=e.getMeta(l),a=t.column_header?.[this._config.split_by.length],s=this._config.sort.find((e=>e[0]===a)),i=t.row_header_x===o,n=typeof t.x>"u";i=i||(t.x+1)%this._config.columns.length==0,l.classList.toggle("psp-header-border",i),l.classList.toggle("psp-header-group",!1),l.classList.toggle("psp-header-leaf",!0),l.classList.toggle("psp-is-top",!1),l.classList.toggle("psp-header-corner",n),l.classList.toggle("psp-header-sort-asc",!r&&!!s&&"asc"===s[1]),l.classList.toggle("psp-header-sort-desc",!r&&!!s&&"desc"===s[1]),l.classList.toggle("psp-header-sort-col-asc",!r&&!!s&&"col asc"===s[1]),l.classList.toggle("psp-header-sort-col-desc",!r&&!!s&&"col desc"===s[1]);let c=d.call(this,t),p="integer"===c||"float"===c,g="string"===c,h="date"===c,_="datetime"===c;l.classList.toggle("psp-align-right",p),l.classList.toggle("psp-align-left",!p),l.classList.toggle("psp-menu-enabled",(g||p||h||_)&&!n&&t.column_header_y==this._config.split_by.length+1),l.classList.toggle("psp-sort-enabled",(g||p||h||_)&&!n&&t.column_header_y===this._config.split_by.length),l.classList.toggle("psp-is-width-override",void 0!==e._column_sizes?.override[t.size_key])}}function h(e){let t=e._view_cache.config.row_pivots.length-1,r=Array.from(e.children[0].children[0].children),o=[],l=new Set,a=e.children[0];for(let s=0;s<r.length;s++){let r=a.rows[s],i=new Set;for(let a=0;a<r.cells.length;a++){let n=r.cells[a];n.style.backgroundColor="";let d=e.getMeta(n),c=d.row_header_x===t||d.x>=0;n.classList.toggle("psp-align-right",!1),n.classList.toggle("psp-align-left",!1),n.classList.toggle("psp-header-group",!0),n.classList.toggle("psp-header-leaf",!1),n.classList.toggle("psp-header-border",c),n.classList.toggle("psp-header-group-corner",typeof d.x>"u"),n.classList.toggle("psp-color-mode-bar",!1),n.classList.toggle("psp-header-sort-asc",!1),n.classList.toggle("psp-header-sort-desc",!1),n.classList.toggle("psp-header-sort-col-asc",!1),n.classList.toggle("psp-header-sort-col-desc",!1),n.classList.toggle("psp-sort-enabled",!1);let p,g,h=r.cells[a],_=a;for(;o[s]&&o[s][_];++_);for(i.add(_),p=_;p<_+h.colSpan;++p)for(g=s;g<s+h.rowSpan;++g)o[g]||(o[g]=[]),o[g][p]=!0;h.classList.toggle("psp-is-top",0===s||!l.has(p))}l=i}}function _(e,t,r,o,l){let[,,,,,a,s]=r,[,,,,,i,n]=o,d=this._ids?.[e.dy]?.join("|"),c=(l?e.column_header.slice(0,-1):e.column_header).join("|");if(this.last_reverse_columns?.has(c)&&this.last_reverse_ids?.has(d)){let r=this.last_reverse_ids?.get(d),o=this.last_reverse_columns.get(c);this._is_old_viewport?this.last_meta?.[o]?.[r]>e.user?(t.style.setProperty("--pulse--background-color-start",i),t.style.setProperty("--pulse--background-color-end",n),"pulse_neg"===t.style.animationName?t.style.animation="pulse_neg2 0.5s linear":t.style.animation="pulse_neg 0.5s linear"):this.last_meta?.[o]?.[r]<e.user?(t.style.setProperty("--pulse--background-color-start",a),t.style.setProperty("--pulse--background-color-end",s),"pulse_pos"===t.style.animationName?t.style.animation="pulse_pos2 0.5s linear":t.style.animation="pulse_pos 0.5s linear"):r!==e.dy&&(t.style.animation=""):t.style.animation=""}else t.style.animation=""}function b(e,t){return o.mix(e,`rgb(${t[0]},${t[1]},${t[2]})`,.5).hex()}function u(e,t){let[r,o,l,a]=e;function s(e,r){return 255*((1-a)*(t[e]/255)+a*(r/255))}return void 0===t&&(t=[255,255,255]),[s(0,r),s(1,o),s(2,l)]}function m(e){let[t,r,o]=e;return Math.sqrt(t*t*.299+r*r*.587+o*o*.114)>130?"#161616":"#ffffff"}function f(e){let t=o(e),r=function(e){let[t,r,o]=e.rgb(),[l,a,s]=e.set("hsl.h",(e.get("hsl.h")-15)%360).rgb(),[i,n,d]=e.set("hsl.h",(e.get("hsl.h")+15)%360).rgb();return`linear-gradient(to right top,rgb(${l},${a},${s}),rgb(${t},${r},${o}) 50%,rgb(${i},${n},${d}))`}(t),l=t.rgb();return[e,...l,r,`rgba(${l[0]},${l[1]},${l[2]},1)`,`rgba(${l[0]},${l[1]},${l[2]},0)`]}function v(e,t,r,o){let l,a,s=r.user>0,i=r.user<0;l=void 0!==e?.pos_bg_color?e.pos_bg_color:this._pos_bg_color,a=void 0!==e?.neg_bg_color?e.neg_bg_color:this._neg_bg_color;let n=s?l:i?a:["",...this._plugin_background,""];{let[s,i,d,c,p]=n;if(t.style.position="","color"===e?.number_bg_mode)t.style.animation="",t.style.backgroundColor=s;else if("gradient"===e?.number_bg_mode){let o=Math.max(0,Math.min(1,Math.abs(r.user/e.bg_gradient))),l=m(u([i,d,c,o],this._plugin_background));t.style.animation="",t.style.color=l,t.style.backgroundColor=`rgba(${i},${d},${c},${o})`}else"pulse"===e?.number_bg_mode?(_.call(this,r,t,l,a,o),t.style.backgroundColor=""):(t.style.animation="",t.style.backgroundColor="")}let[d,c,p,g,h]=(()=>void 0!==e?.pos_fg_color?s?e.pos_fg_color:i?e.neg_fg_color:["",...this._plugin_background,""]:s?this._pos_fg_color:i?this._neg_fg_color:["",...this._plugin_background,""])();if("disabled"===e?.number_fg_mode)if("color"===e?.number_bg_mode){let e=this._plugin_background,r=m(u([n[1],n[2],n[3],1],e));t.style.color=r}else"gradient"===e?.number_bg_mode||(t.style.color="");else"bar"===e?.number_fg_mode?(t.style.color="",t.style.position="relative",""!==h&&t.children.length>0&&t.children[0].nodeType===Node.ELEMENT_NODE&&(t.children[0].style.background=h)):("color"===e?.number_fg_mode||!e?.number_fg_mode)&&(t.style.color=d)}function y(e,t,r){let l=r.column_header?.[this._config.split_by.length],[a,s,i,n,d]=(()=>void 0!==e?.color?e.color:this._color)();if("foreground"===e?.string_color_mode&&null!==r.user)t.style.color=a,t.style.backgroundColor="","link"===e?.format&&(t.children[0].style.color=a);else if("background"===e?.string_color_mode&&null!==r.user){let e=m(u([s,i,n,1],this._plugin_background));t.style.color=e,t.style.backgroundColor=a}else if("series"===e?.string_color_mode&&null!==r.user){this._series_color_map.has(l)||(this._series_color_map.set(l,new Map),this._series_color_seed.set(l,0));let e=this._series_color_map.get(l);if(!e.has(r.user)){let t=this._series_color_seed.get(l);e.set(r.user,t),this._series_color_seed.set(l,t+1)}let s=e.get(r.user),[i,n,d]=o(a).hsl();i+=150*s%360;let c=o(i,n,d,"hsl"),[p,g,h]=c.rgb(),_=c.hex(),b=m(u([p,g,h,1],this._plugin_background));t.style.color=b,t.style.backgroundColor=_}else t.style.backgroundColor="",t.style.color=""}function x(e,t,r){r.column_header?.[this._config.split_by.length];let[o,l,a,s,i]=(()=>void 0!==e?.color?e.color:this._color)();if("foreground"===e?.datetime_color_mode&&null!==r.user)t.style.color=o,t.style.backgroundColor="";else if("background"===e?.datetime_color_mode&&null!==r.user){let e=m(u([l,a,s,1],this._plugin_background));t.style.color=e,t.style.backgroundColor=o}else t.style.backgroundColor="",t.style.color=""}function w(e,t,r){let[o]=!0===r.user?this._pos_fg_color:!1===r.user?this._neg_fg_color:["",0,0,0,""];t.style.backgroundColor="",t.style.color=o}function k(e,t,r){let o=null!=typeof r.value&&null!=typeof r.value&&r.value?.toString()?.trim().length>0,l=r.row_header_x>=this._config.group_by.length,a=e.getMeta({dx:0,dy:r.y-r.y0+1}),s=a&&a.row_header&&typeof a.row_header[r.row_header_x+1]<"u";t.classList.toggle("psp-tree-label",o&&!l),t.classList.toggle("psp-tree-label-expand",o&&!l&&!s),t.classList.toggle("psp-tree-label-collapse",o&&!l&&s),t.classList.toggle("psp-tree-leaf",o&&l)}function E(e){return e.x>=0?this._column_types[e.x]:this._row_header_types[e.row_header_x-1]}function L(e,t){let r=e[n]||{},o=t.hasAttribute("settings");for(let l of e.children[0].children[1].children)for(let t of l.children){let l=e.getMeta(t),a=l.column_header?.[this._config.split_by.length],s=E.call(this,l),i=r[a],n="integer"===s||"float"===s;n?v.call(this,i,t,l,o):"boolean"===s?w.call(this,i,t,l):"string"===s?y.call(this,i,t,l):"date"===s||"datetime"===s?x.call(this,i,t,l):(t.style.backgroundColor="",t.style.color=""),t.classList.toggle("psp-bool-type","boolean"===s&&null!==l.user);let d="TH"===t.tagName;d&&k.call(this,e,t,l),t.classList.toggle("psp-align-right",!d&&n),t.classList.toggle("psp-align-left",d||!n),t.classList.toggle("psp-color-mode-bar","bar"===i?.number_fg_mode&&n)}}async function S(e,t,r,o){let l=e.getMeta(o).column_header[this._config.split_by.length],a=(r.shiftKey?O:C).call(this,l);this._preserve_focus_state=!0,await t.restore({sort:a})}function O(e){let t=[],r=!1;for(let o of this._config.sort){let[l,a]=o;if(l===e){r=!0;let o=N.call(this,e,a);o&&t.push(o)}else t.push(o)}return r||t.push([e,"desc"]),t}function C(e){for(let[t,r]of this._config.sort)if(t===e){let t=N.call(this,e,r);return t?[t]:[]}return[[e,"desc"]]}function N(e,t){let r=this._config.split_by.length>0?R:T,o=t?r[t]:"desc";if(o)return[e,o]}var T={desc:"asc",asc:void 0},R={desc:"asc",asc:"col desc","col desc":"col asc","col asc":void 0};async function M(e,t){let r=e.getMeta(t.target),o=t.target.classList.contains("psp-tree-label-collapse");t.shiftKey&&o?this._view.set_depth(r.row_header.filter((e=>void 0!==e)).length-2):t.shiftKey?this._view.set_depth(r.row_header.filter((e=>void 0!==e)).length-1):o?this._view.collapse(r.y):this._view.expand(r.y),this._num_rows=await this._view.num_rows(),this._num_columns=await this._view.num_columns(),e.draw()}async function A(e,t,r){if(1!==r.which)return;let o=r.target;if("A"!==o.tagName){for(;"TD"!==o.tagName&&"TH"!==o.tagName;)if(o=o.parentElement,!e.contains(o))return;if(o.classList.contains("psp-tree-label"))return M.call(this,e,r),void r.stopImmediatePropagation();if(o.classList.contains("psp-menu-enabled")){let l=e.getMeta(o).column_header?.[this._config.split_by.length];await t.toggleColumnSettings(l),r.preventDefault(),r.stopImmediatePropagation()}else o.classList.contains("psp-sort-enabled")&&(S.call(this,e,t,r,o),r.stopImmediatePropagation())}}function D(e,t){if(1!==t.which)return;let r=t.target;for(;"TD"!==r.tagName&&"TH"!==r.tagName;)if(r=r.parentElement,!e.contains(r))return;(r.classList.contains("psp-tree-label")&&t.offsetX<26||r.classList.contains("psp-header-leaf")&&!r.classList.contains("psp-header-corner"))&&t.stopImmediatePropagation()}function z(e,t){void 0===t&&(t=!1);let r=0===this._config.group_by.length&&0===this._config.split_by.length,o=e.hasAttribute("selectable"),l=t||"EDIT"===e.children[0].dataset.editMode;return r&&!o&&l}function I(e,t,r){let o=e[n]||{},l=z.call(this,t);r.classList.toggle("edit-mode-allowed",z.call(this,t,!0));for(let a of e.querySelectorAll("td")){let t=e.getMeta(a),r=this.get_psp_type(t);if(l&&this._is_editable[t.x]){let e=t.column_header[this._config.split_by.length];"string"===r&&"link"===o[e]?.format?(a.toggleAttribute("contenteditable",!1),a.classList.toggle("boolean-editable",!1)):"boolean"===r?(a.toggleAttribute("contenteditable",!1),a.classList.toggle("boolean-editable",null!==t.user)):(l!==a.hasAttribute("contenteditable")&&a.toggleAttribute("contenteditable",l),a.classList.toggle("boolean-editable",!1))}else a.toggleAttribute("contenteditable",!1),a.classList.toggle("boolean-editable",!1)}}var U=(e,t,r)=>{let o=e.querySelectorAll("td"),l=r.get(e),a=e.getRootNode();if(l){for(let t of o){let r=e.getMeta(t);if(r.x===l.x&&r.y===l.y)return a.activeElement!==t&&t.focus({preventScroll:!0}),!0}document.activeElement!==document.body&&e.contains(a.activeElement)&&a.activeElement.blur()}};function W(e,t,r){let o=e.getMeta(r),l=t._schema[t._column_paths[o.x]];if(o){let e=r.textContent,a=t._ids[o.y-o.y0][0];if("float"===l||"integer"===l){if(e=parseFloat(e.replace(/,/g,"")),isNaN(e))return!1}else if("date"===l||"datetime"===l){if(e=Date.parse(e),isNaN(e))return!1}else"boolean"===l&&(e="true"!==e&&("false"===e||null));let s={__INDEX__:a,[t._column_paths[o.x]]:e};return t._table.update([s],{port_id:t._edit_port}),!0}}function $(e,t,r){let o=e.getMeta(r.target);if(typeof o?.x<"u"){let t=this._is_editable[o.x],l="boolean"===this.get_psp_type(o),a="-"===r.target.textContent;t&&l&&!a&&W(e,this,r.target)}}function P(){if(this.isContentEditable){let e=this.getRootNode().getSelection().getRangeAt(0),t=e.cloneRange();return t.selectNodeContents(this),t.setEnd(e.endContainer,e.endOffset),t.toString().length}return this.target.selectionStart}var F=function(e){let t;return async function(){if(t&&await t&&t)return;let r;for(var o=arguments.length,l=new Array(o),a=0;a<o;a++)l[a]=arguments[a];t=new Promise((e=>r=e)),await e.apply(this,l),t=void 0,r()}}((async function(e,t,r,o,l){let a=e.getMeta(r),s=this._column_paths.length,i=this._num_rows,n=t.get(e);if(!n)return;a.x+o<s&&0<=a.x+o&&(n.x=a.x+o),a.y+l<i&&0<=a.y+l&&(n.y=a.y+l);let d=Math.max(a.x0-10,0),c=Math.min(a.x0+10,s),p=Math.max(a.y0-5,0),g=Math.min(a.y0+10,i),h=a.x0+o,_=a.y0+l;for(;!U(e,0,t)&&h>=d&&h<c&&_>=p&&_<g;)await e.scrollToCell(h,_,s,i),t.set(e,n),h+=o,_+=l}));function j(e,t,r,o){let l=e.getRootNode().activeElement;switch(o.target.classList.remove("psp-error"),o.key){case"Enter":o.preventDefault(),function(e,t,r){return t.getMeta(r).y===e._num_rows-1}(this,e,l)?(l.blur(),r.delete(e)):o.shiftKey?F.call(this,e,r,l,0,-1):F.call(this,e,r,l,0,1);break;case"ArrowLeft":0==P.call(l)&&(o.preventDefault(),F.call(this,e,r,l,-1,0));break;case"ArrowUp":o.preventDefault(),F.call(this,e,r,l,0,-1);break;case"ArrowRight":P.call(l)==l.textContent.length&&(o.preventDefault(),F.call(this,e,r,l,1,0));break;case"ArrowDown":o.preventDefault(),F.call(this,e,r,l,0,1)}}function q(e,t){void 0===t&&(t=!1);let r=0===this._config.group_by.length&&0===this._config.split_by.length,o=e.hasAttribute("selectable"),l=t||"EDIT"===e.children[0]._edit_mode;return r&&!o&&l}function H(e,t,r,o){if("EDIT"===this._edit_mode){if(!q.call(this,t))return;j.call(this,e,t,r,o)}else console.debug(`Mode ${this._edit_mode} for "keydown" event not yet implemented`)}function G(e,t,r){if("EDIT"===this._edit_mode){if(!q.call(this,t))return;$.call(this,e,t,r)}else"READ_ONLY"===this._edit_mode||"SELECT_COLUMN"===this._edit_mode||"SELECT_ROW"===this._edit_mode||"SELECT_REGION"===this._edit_mode||console.debug(`Mode ${this._edit_mode} for "click" event not yet implemented`)}function J(e,t,r,o){if(q.call(this,t)&&r.has(e)){o.target.classList.remove("psp-error");let t=r.get(e);r.delete(e),t.content!==o.target.textContent&&(W(e,this,o.target)||(o.target.textContent=t.content,o.target.classList.add("psp-error"),o.target.focus()))}}function Y(e,t,r,o){let l=e.getMeta(o.target);if(l){let t={x:l.x,y:l.y,content:o.target.textContent};r.set(e,t)}}async function Z(e,t,r){let{_view:o,_config:l}=e,a=l.group_by,s=l.split_by,i=t>=0?t:0,n=i+1,d=await o.to_json({start_row:i,end_row:n}),c=d.map((e=>e.__ROW_PATH__))[0]||[],p=a.map(((e,t)=>{let r=c[t];return r?[e,"==",r]:void 0})).filter((e=>e)),g=a.length>0?r+1:r,h=Object.keys(d[0])[g],_={row:d[0]},b=[];if(h){let e=h.split("|");_.column_names=[e[s.length]],b=s.map(((t,r)=>{let o=e[r];return o?[t,"==",o]:void 0})).filter((e=>e)).filter((e=>{let[,,t]=e;return"__ROW_PATH__"!==t}))}let u=l.filter.concat(p).concat(b);return _.config={filter:u},_}async function K(e,t,r,o){let l=e.getMeta(o.target);if(!t.hasAttribute("selectable")||o.handled||1!==o.which||!l)return;let a=this._ids[l.y-l.y0];if(l&&l.y>=0){let s=r.get(e),i=!!s&&s.reduce(((e,t,r)=>e&&t===a[r]),!0),n=!!s&&a.length===s.length&&i,d={selected:!n},{row:c,column_names:p,config:g}=await Z(this,l.y,l.x);n?(r.delete(e),d={...d,row:c,config:{filter:structuredClone(this._config.filter)}}):(r.set(e,a),d={...d,row:c,column_names:p,config:g}),await e.draw({preserve_width:!0}),o.handled=!0,t.dispatchEvent(new CustomEvent("perspective-select",{bubbles:!0,composed:!0,detail:d}))}}function V(e,t,r){if(!t.hasAttribute("selectable"))return;let o=r.has(e),l=r.get(e);for(let a of e.querySelectorAll("td"))if(o){let t=e.getMeta(a),r=this._ids[t.y-t.y0],o=l.reduce(((e,t,o)=>e&&t===r[o]),!0);a.classList.toggle("psp-row-selected",r.length===l.length&&o),a.classList.toggle("psp-row-subselected",r.length!==l.length&&o)}else a.classList.toggle("psp-row-selected",!1),a.classList.toggle("psp-row-subselected",!1);for(let a of e.querySelectorAll("tbody th")){let t=e.getMeta(a),r=this._ids[t.y-t.y0];if(!o||r[t.row_header_x])a.classList.toggle("psp-row-selected",!1),a.classList.toggle("psp-row-subselected",!1);else{let e=l.reduce(((e,t,o)=>e&&t===r[o]),!0);a.classList.toggle("psp-row-selected",r.length===l.length&&e),a.classList.toggle("psp-row-subselected",r.length!==l.length&&e)}}}async function B(e,t,r){r.delete(e);for(let o of e.querySelectorAll("td,th"))o.classList.toggle("psp-row-selected",!1),o.classList.toggle("psp-row-subselected",!1)}var X={datetime:Intl.DateTimeFormat,date:Intl.DateTimeFormat,integer:Intl.NumberFormat,float:Intl.NumberFormat,boolean:class{format(e){return e?"true":"false"}}},Q={float:{format:{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}},datetime:{format:{dateStyle:"short",timeStyle:"medium"}},date:{format:{dateStyle:"short"}}},ee=new class{constructor(){this._formatters=new Map}create_datetime_formatter(e,t){let r={dateStyle:"short",timeStyle:"medium"};if("custom"!==t.date_format?.format){let e={...r,timeZone:t.date_format?.timeZone,dateStyle:t.date_format?.dateStyle,timeStyle:t.date_format?.timeStyle};return"disabled"===e.dateStyle?e.dateStyle=void 0:void 0===e.dateStyle&&(e.dateStyle="short"),"disabled"===e.timeStyle?e.timeStyle=void 0:void 0===e.timeStyle&&(e.timeStyle="medium"),new Intl.DateTimeFormat(navigator.languages,e)}{let e={timeZone:t.date_format?.timeZone,second:t.date_format?.second,minute:t.date_format?.minute,hour:t.date_format?.hour,day:t.date_format?.day,weekday:t.date_format?.weekday,month:t.date_format?.month,year:t.date_format?.year,hour12:t.date_format?.hour12,fractionalSecondDigits:t.date_format?.fractionalSecondDigits};return"disabled"===e.year?e.year=void 0:void 0===e.year&&(e.year="2-digit"),"disabled"===e.month?e.month=void 0:void 0===e.month&&(e.month="numeric"),"disabled"===e.day?e.day=void 0:void 0===e.day&&(e.day="numeric"),"disabled"===e.weekday&&(e.weekday=void 0),"disabled"===e.hour?e.hour=void 0:void 0===e.hour&&(e.hour="numeric"),"disabled"===e.minute?e.minute=void 0:void 0===e.minute&&(e.minute="numeric"),"disabled"===e.second?e.second=void 0:void 0===e.second&&(e.second="numeric"),void 0===e.hour12&&(e.hour12=!0),new Intl.DateTimeFormat(navigator.languages,e)}}create_date_formatter(e,t){let r={dateStyle:t.date_format?.dateStyle,timeZone:"utc"};return"disabled"===r.dateStyle?r.dateStyle=void 0:void 0===r.dateStyle&&(r.dateStyle="short"),new Intl.DateTimeFormat(navigator.languages,r)}create_number_formatter(e,t){let r=Q[e]?.format;return void 0!==t.number_format&&(r=t.number_format),new X[e](navigator.languages,r)}create_boolean_formatter(e,t){return new X[e](navigator.languages,{})}get(e,t){let r=[e,...Object.values(t.date_format??{}),...Object.values(t.number_format??{})].join("-");return this._formatters.has(r)||("date"===e?this._formatters.set(r,this.create_date_formatter(e,t)):"datetime"===e?this._formatters.set(r,this.create_datetime_formatter(e,t)):"integer"===e||"float"===e?this._formatters.set(r,this.create_number_formatter(e,t)):"boolean"===e?this._formatters.set(r,this.create_boolean_formatter(e,t)):this._formatters.set(r,!1)),this._formatters.get(r)}};function te(e,t){return ee.get(e,t)}function re(e,t,r,o){if(void 0===r&&(r={}),void 0===o&&(o=!1),null===t)return"-";let l=o&&this._table_schema[e]||this._schema[e]||"string",a=r[e]||{};if("integer"!==l&&"float"!==l||"bar"!==a?.number_fg_mode){if("link"===a?.format&&"string"===l){let e=document.createElement("a");return e.setAttribute("href",t),e.setAttribute("target","_blank"),e.textContent=t,e}if("bold"===a?.format&&"string"===l){let e=document.createElement("b");return e.textContent=t,e}if("italics"===a?.format&&"string"===l){let e=document.createElement("i");return e.textContent=t,e}{let e=ee.get(l,a);return e?e.format(t):t}}{let e=Math.max(0,Math.min(1,1*Math.abs(t/a.fg_gradient))),r=this._div_factory.get(),o=t>=0?"left":"right",l=(100*e).toFixed(2);return r.setAttribute("style",`width:calc(${l}% - 4px);position:absolute;${o}:2px;height:80%;top:10%;pointer-events:none;`),r}}function oe(e,t,r){var o=this;return void 0===e&&(e=[]),function*(){let l=r[n];for(let r of e){r=["TOTAL",...r];let e=r[r.length-1];r=r.slice(0,r.length-1).fill("");let a=re.call(o,t[r.length-1],e,l,!0);r=a instanceof HTMLElement?r.concat(a):r.concat({toString:()=>a}),r.length=t.length+1,yield r}}()}function le(e,t,r){let o=window.getComputedStyle(e).getPropertyValue(t).trim();return o.length>0?o:r}var ae=class{constructor(e){this._name=e,this._elements=[],this._index=0}clear(){this._index=0}get(){this._elements[this._index]||(this._elements[this._index]=document.createElement(this._name));let e=this._elements[this._index];return this._index+=1,e}};function se(e){return e.x>=0?this._column_types[e.x]:this._row_header_types[e.row_header_x-1]}async function ie(e,t,r,l){void 0===l&&(l={});let a=await r.get_config(),s=Array.isArray(a.expressions)?Object.fromEntries(a.expressions.map((e=>[e[0],e[1]]))):a.expressions,[i,d,c,p,g,h,_]=await Promise.all([t.schema(),t.validate_expressions(s),r.num_rows(),r.schema(),r.expression_schema(),r.column_paths(),this.parentElement.getEditPort()]),u=o(le(e,"--plugin--background","#FFFFFF")).rgb(),m=f(le(e,"--rt-pos-cell--color","#338DCD")),v=f(le(e,"--rt-neg-cell--color","#FF5942")),y=f(b(m[0],u)),x=f(b(v[0],u)),w=f(le(e,"--active--color","#ff0000")),k={...p,...g},E={...i,...d.expression_schema},L=h.filter((e=>"__ROW_PATH__"!==e&&"__ID__"!==e)),S=[],O=[];for(let o of L){let e=o.split("|")[a.split_by.length];O.push(k[e]),S.push(!!i[e])}let C=this._edit_mode||"READ_ONLY";this._edit_button.dataset.editMode=C;let N=Object.assign(l,{_edit_port:_,_view:r,_table:t,_table_schema:E,_config:a,_num_rows:c,_schema:k,_ids:[],_plugin_background:u,_color:w,_pos_fg_color:m,_neg_fg_color:v,_pos_bg_color:y,_neg_bg_color:x,_column_paths:L,_column_types:O,_is_editable:S,_edit_mode:C,_selection_state:{selected_areas:[],dirty:!1},_row_header_types:a.group_by.map((e=>E[e])),_series_color_map:new Map,_series_color_seed:new Map,get_psp_type:se});return N._div_factory=N._div_factory||new ae("div"),e.setDataListener(function(e){let t,r,o,l,a;return async function(s,i,d,c,p){let g,h={};c-i>0&&p-d>0?(this._is_old_viewport=this._last_window?.start_row===d&&this._last_window?.end_row===p&&this._last_window?.start_col===i&&this._last_window?.end_col===c,g={start_row:d,start_col:i,end_row:p,end_col:c,id:!0},h=JSON.parse(await this._view.to_columns_string(g)),this._last_window=g,this._ids=h.__ID__,this._reverse_columns=this._column_paths.slice(i,c).reduce(((e,t,r)=>(e.set(t,r),e)),new Map),this._reverse_ids=this._ids.reduce(((e,t,r)=>(e.set(t?.join("|"),r),e)),new Map)):this._div_factory.clear();let _=[],b=[],u=[],m=[],f=e.hasAttribute("settings");for(let e=i;e<Math.min(c,this._column_paths.length);++e){let t=this._column_paths[e],r=t.split("|"),o=h[t]||new Array(p-d).fill(null);_.push(o.map((e=>re.call(this,r[this._config.split_by.length],e,s[n])))),b.push(o),f&&r.push(""),u.push(r),m.push(t)}return c-i>0&&p-d>0&&(this.last_column_paths=r,this.last_meta=t,this.last_ids=o,this.last_reverse_ids=l,this.last_reverse_columns=a,r=m,t=b,o=this._ids,l=this._reverse_ids,a=this._reverse_columns),{num_rows:this._num_rows,num_columns:this._column_paths.length,row_headers:Array.from(oe.call(this,h.__ROW_PATH__,this._config.group_by,s)),column_headers:u,data:_,metadata:b,column_header_merge_depth:Math.max(0,this._config.split_by.length)}}}(this.parentElement).bind(N,e),{virtual_mode:window.getComputedStyle(e).getPropertyValue("--datagrid-virtual-mode")?.trim()||"both"}),N}async function ne(e,t,r){let o=e.getMeta(r.target);if(!o)return;let{x:l,y:a}=o,{row:s,column_names:i,config:n}=await Z(this,a,l);t.dispatchEvent(new CustomEvent("perspective-click",{bubbles:!0,composed:!0,detail:{row:s,column_names:i,config:n}}))}var de="mouse-selected-area",ce=(e,t,r)=>o=>{if("SELECT_REGION"===e.model._edit_mode||"SELECT_ROW"===e.model._edit_mode||"SELECT_COLUMN"===e.model._edit_mode){e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES={};let l=t.getMeta(o.target);if(l&&void 0!==l.x&&void 0!==l.y){e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES={x:l.x,y:l.y},e.model._selection_state.old_selected_areas=e.model._selection_state.selected_areas,e.model._selection_state.selected_areas=[];let o={x0:l.x,x1:l.x,y0:l.y,y1:l.y};return e.model._selection_state.potential_selection=o,void he(e,t,r,e.model._selection_state.selected_areas.concat([o]))}}e.model._selection_state.selected_areas=[]},pe=(e,t,r)=>o=>{if(("SELECT_REGION"===e.model._edit_mode||"SELECT_ROW"===e.model._edit_mode||"SELECT_COLUMN"===e.model._edit_mode)&&e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES&&void 0!==e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES.x){let l=t.getMeta(o.target);if(l&&void 0!==l.x&&void 0!==l.y){let o={x0:Math.min(l.x,e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES.x),x1:Math.max(l.x,e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES.x),y0:Math.min(l.y,e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES.y),y1:Math.max(l.y,e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES.y)};e.model._selection_state.potential_selection=o,he(e,t,r,e.model._selection_state.selected_areas.concat([o]))}}},ge=(e,t,r)=>o=>{if("SELECT_REGION"===e.model._edit_mode||"SELECT_ROW"===e.model._edit_mode||"SELECT_COLUMN"===e.model._edit_mode){let l=t.getMeta(o.target);if(e.model._selection_state.old_selected_areas?.length>0){let o=e.model._selection_state.old_selected_areas[0];if(o.x0===o.x1&&o.y0===o.y1&&o.x0===l.x&&o.y0===l.y)return e.model._selection_state.selected_areas=[],e.model._selection_state.old_selected_areas=[],e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES={},e.model._selection_state.potential_selection=void 0,void he(e,t,r,[])}if(e.model._selection_state.old_selected_areas=[],e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES&&void 0!==e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES.x&&void 0!==l.x&&void 0!==l.y){let o={x0:Math.min(l.x,e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES.x),x1:Math.max(l.x,e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES.x),y0:Math.min(l.y,e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES.y),y1:Math.max(l.y,e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES.y)};e.model._selection_state.selected_areas.push(o),he(e,t,r)}e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES={},e.model._selection_state.potential_selection=void 0}};var he=(e,t,r,o)=>{if("SELECT_REGION"===e.model._edit_mode||"SELECT_ROW"===e.model._edit_mode||"SELECT_COLUMN"===e.model._edit_mode){o=e.model._selection_state.selected_areas.slice(0),e.model._selection_state.potential_selection&&o.push(e.model._selection_state.potential_selection);let l=t.querySelectorAll("tbody td");if(o.length>0)(function(e,t,r){let{x0:o,x1:l,y0:a,y1:s}=r,i={},n=t.model._edit_mode;void 0!==o&&["SELECT_COLUMN","SELECT_REGION"].indexOf(n)>-1&&(i.start_col=o),void 0!==l&&["SELECT_COLUMN","SELECT_REGION"].indexOf(n)>-1&&(i.end_col=l+1),void 0!==a&&["SELECT_ROW","SELECT_REGION"].indexOf(n)>-1&&(i.start_row=a),void 0!==s&&["SELECT_ROW","SELECT_REGION"].indexOf(n)>-1&&(i.end_row=s+1),e.setSelection(i)})(e.parentElement,e,o[0]),_e(e,t,o,r);else{e.parentElement.setSelection();for(let e of l)e.classList.remove(r)}}else if(e.model._selection_state.dirty){e.model._selection_state.dirty=!1;let o=t.querySelectorAll("tbody td");for(let e of o)e.classList.remove(r)}},_e=(e,t,r,o)=>{if("SELECT_REGION"===e.model._edit_mode&&r.length>0){let l=t.querySelectorAll("tbody td");for(let a of l){let l=t.getMeta(a),s=!1;for(let{x0:t,x1:i,y0:n,y1:d}of r)void 0!==t&&void 0!==n&&void 0!==i&&void 0!==d&&t<=l.x&&l.x<=i&&n<=l.y&&l.y<=d&&(s=!0,e.model._selection_state.dirty=!0,a.classList.add(o));s||a.classList.remove(o)}}else if("SELECT_ROW"===e.model._edit_mode&&r.length>0){let l=t.querySelectorAll("tbody td");for(let a of l){let l=t.getMeta(a),s=!1;for(let{x0:t,x1:i,y0:n,y1:d}of r)void 0!==t&&void 0!==n&&void 0!==i&&void 0!==d&&n<=l.y&&l.y<=d&&(e.model._selection_state.dirty=!0,s=!0,a.classList.add(o));s||a.classList.remove(o)}}else if("SELECT_COLUMN"===e.model._edit_mode&&r.length>0){let l=t.querySelectorAll("tbody td");for(let a of l){let l=t.getMeta(a),s=!1;for(let{x0:t,x1:i,y0:n,y1:d}of r)void 0!==t&&void 0!==n&&void 0!==i&&void 0!==d&&t<=l.x&&l.x<=i&&(e.model._selection_state.dirty=!0,s=!0,a.classList.add(o));s||a.classList.remove(o)}}};async function be(e){let t=this.parentElement,r=await t.getTable(!0);if(this._initialized)await ie.call(this,this.regular_table,r,e,this.model);else{this.innerHTML="",this.shadowRoot?this.shadowRoot.appendChild(this.regular_table):this.appendChild(this.regular_table),this.model=await ie.call(this,this.regular_table,r,e),function(e,t,r){let{className:o=de,selected:l=[]}=void 0===r?{}:r;e.model._selection_state={selected_areas:l,dirty:!0},t.addEventListener("mousedown",ce(e,t,o)),t.addEventListener("mouseover",pe(e,t,o)),t.addEventListener("mouseup",ge(e,t,o)),t.addStyleListener((()=>he(e,t,o)))}(this,this.regular_table,{className:"psp-select-region"}),this.regular_table.addStyleListener(L.bind(this.model,this.regular_table,t)),this.regular_table.addStyleListener(h.bind(this.model,this.regular_table)),this.regular_table.addStyleListener(p.bind(this.model,this.regular_table,t)),this.regular_table.addEventListener("click",D.bind(this.model,this.regular_table)),this.regular_table.addEventListener("mousedown",A.bind(this.model,this.regular_table,t));let o=new WeakMap;this.regular_table.addStyleListener(V.bind(this.model,this.regular_table,t,o)),this.regular_table.addEventListener("mousedown",K.bind(this.model,this.regular_table,t,o)),this.regular_table.addEventListener("psp-deselect-all",B.bind(this.model,this.regular_table,t,o)),this.regular_table.addEventListener("click",ne.bind(this.model,this.regular_table,t));let l=new WeakMap;this.regular_table.addStyleListener(I.bind(this.model,this.regular_table,t,this)),this.regular_table.addStyleListener(U.bind(this.model,this.regular_table,t,l)),this.regular_table.addEventListener("click",G.bind(this.model,this.regular_table,t)),this.regular_table.addEventListener("focusin",Y.bind(this.model,this.regular_table,t,l)),this.regular_table.addEventListener("focusout",J.bind(this.model,this.regular_table,t,l)),this.regular_table.addEventListener("keydown",H.bind(this.model,this.regular_table,t,l)),t.addEventListener("perspective-toggle-column-settings",(e=>{if(this.isConnected){if(c.call(this.model,this.regular_table,t,e.detail.column_name),!e.detail.open)return void(this.model._column_settings_selected_column=null);this.model._column_settings_selected_column=e.detail.column_name}})),this._initialized=!0}}function ue(e,t){if(void 0===t&&(t=!1),!this._initialized)return;t&&(this._cached_column_sizes=e);let r={},{group_by:o,columns:l}=this.model._config,a=o?.length>0?o.length+1:0;for(let s of Object.keys(e))if("__ROW_PATH__"===s)r[a-1]=e[s];else{r[this.model._column_paths.indexOf(s)+a]=e[s]}this.regular_table._column_sizes.override=r}function me(){if(!this._initialized)return[];if(this._cached_column_sizes){let e=this._cached_column_sizes;return this._cached_column_sizes=void 0,e}let e=this.regular_table._column_sizes.override,{group_by:t,columns:r}=this.model._config,o=t?.length>0?t.length+1:0,l={};for(let a of Object.keys(e))if(void 0!==e[a]){let t=a-o;t>-1?l[this.model._column_paths[t]]=e[a]:-1===t&&(l.__ROW_PATH__=e[a])}return l}var fe=["READ_ONLY","EDIT","SELECT_ROW","SELECT_COLUMN","SELECT_REGION"];function ve(e){void 0===e&&(e=void 0),typeof e>"u"&&(e=fe[(fe.indexOf(this._edit_mode)+1)%fe.length]),this.parentElement?.setSelection(),this._edit_mode=e,this.model&&(this.model._edit_mode=e,this.model._selection_state={selected_areas:[],dirty:!0}),void 0!==this._edit_button&&(this._edit_button.dataset.editMode=e),this.dataset.editMode=e}function ye(e){void 0===e&&(e=void 0),typeof e>"u"&&(e=!this._is_scroll_lock),this._is_scroll_lock=e,this.classList.toggle("sub-cell-scroll-disabled",e),void 0!==this._scroll_lock&&this._scroll_lock.classList.toggle("lock-scroll",e)}function xe(e,t){e=JSON.parse(JSON.stringify(e)),t=JSON.parse(JSON.stringify(t));let r={};if(e.columns)for(let[a,s]of Object.entries(e.columns))void 0!==s.column_size_override&&(r[a]=s.column_size_override,delete s.column_size_override);let o={};if(t)for(let[a,s]of Object.entries(t))o[a]={...s,pos_fg_color:s.pos_fg_color?f(s.pos_fg_color):void 0,neg_fg_color:s.neg_fg_color?f(s.neg_fg_color):void 0,pos_bg_color:s.pos_bg_color?f(s.pos_bg_color):void 0,neg_bg_color:s.neg_bg_color?f(s.neg_bg_color):void 0,color:s.color?f(s.color):void 0};"edit_mode"in e&&(-1!==fe.indexOf(e.edit_mode)?ve.call(this,e.edit_mode):console.error("Unknown edit mode "+e.edit_mode)),"scroll_lock"in e&&ye.call(this,e.scroll_lock);let l=this.regular_table;ue.call(this,r,!0),l[n]=o}function we(){if(this.regular_table){let e={columns:{},scroll_lock:!!this._is_scroll_lock,edit_mode:this._edit_mode},t=me.call(this);for(let r of Object.keys(t||{}))e.columns[r]||(e.columns[r]={}),e.columns[r].column_size_override=t[r];return JSON.parse(JSON.stringify(e))}return{}}async function ke(e){if(this.parentElement&&await this.activate(e),!this.isConnected||null==this.offsetParent)return;let t=me.call(this),r=this.regular_table.draw({invalid_columns:!0});this.model._preserve_focus_state?this.model._preserve_focus_state=!1:(this.regular_table.scrollTop=0,this.regular_table.scrollLeft=0,this.regular_table.dispatchEvent(new CustomEvent("psp-deselect-all",{bubbles:!1})),this.regular_table._resetAutoSize()),ue.call(this,t),await r,this._toolbar.classList.toggle("aggregated",this.model._config.group_by.length>0||this.model._config.split_by.length>0)}function Ee(e,t){return"integer"===e||"float"===e?{datagrid_number_style:{fg_gradient:0,pos_fg_color:this.model._pos_fg_color[0],neg_fg_color:this.model._neg_fg_color[0],number_fg_mode:"color",bg_gradient:0,pos_bg_color:this.model._pos_bg_color[0],neg_bg_color:this.model._neg_bg_color[0],number_bg_mode:"disabled"},number_string_format:!0}:"date"===e||"datetime"===e||"string"===e?{["date"===e||"datetime"===e?"datagrid_datetime_style":"datagrid_string_style"]:{color:this.model._color[0],bg_color:this.model._color[0]}}:null}var Le,Se,Oe,Ce,Ne=class extends HTMLElement{constructor(){super(),this.regular_table=document.createElement("regular-table"),this.regular_table.part="regular-table",this._is_scroll_lock=!1,this._edit_mode="READ_ONLY";let e=Ne;"shadow"==e.renderTarget&&(s(e,Le)||(((e,t,r,o)=>{a(e,t,"write to private field"),o?o.call(e,r):t.set(e,r)})(e,Le,new CSSStyleSheet),s(e,Le).replaceSync(i)),this.attachShadow({mode:"open"}).adoptedStyleSheets.push(s(e,Le)))}connectedCallback(){this._toolbar||(this._toolbar=document.createElement("perspective-viewer-datagrid-toolbar"));let e=this.parentElement;e&&e.appendChild(this._toolbar)}disconnectedCallback(){this._toolbar.parentElement.removeChild(this._toolbar)}async activate(e){return await be.call(this,e)}get name(){return"Datagrid"}get category(){return"Basic"}get select_mode(){return"toggle"}get min_config_columns(){}get config_column_names(){return["Columns"]}get priority(){return 1}can_render_column_styles(e,t){return"boolean"!==e}column_style_controls(e,t){return Ee.call(this,e,t)}async draw(e){return await ke.call(this,e)}async update(e){this.model._num_rows=await e.num_rows(),await this.regular_table.draw()}async render(e){let t=await this.parentElement.getView(),r=await t.to_columns(e),o=await t.column_paths().then((t=>t.slice(e.start_col,e.end_col))),l=e.end_row-e.start_row,a="";for(let s=0;s<l;s++){for(let e of o){let t=r[e],o=te(this.model._schema[e],this.regular_table[n][e.split("|").at(-1)]||{});a+=o?o.format(t[s])+"\t":t[s]+"\t"}a+="\n"}return a.trim()}async resize(){!this.isConnected||null==this.offsetParent||this._initialized&&await this.regular_table.draw()}async clear(){this.regular_table._resetAutoSize(),this.regular_table.clear()}save(){return we.call(this)}restore(e,t){return xe.call(this,e,t)}async restyle(e){await this.draw(e)}delete(){this.regular_table.table_model&&this.regular_table._resetAutoSize(),this.regular_table.clear()}},Te=Ne;Le=new WeakMap,Se=Te,Oe="renderTarget",Ce=window.CSS?.supports&&window.CSS?.supports("selector(:host-context(foo))")?"shadow":"light",((e,t,r)=>{t in e?l(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r})(Se,"symbol"!=typeof Oe?Oe+"":Oe,Ce),((e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)})(Te,Le,void 0);var Re=class extends HTMLElement{connectedCallback(){if(this._initialized)return;this._initialized=!0,this.setAttribute("slot","plugin-settings"),this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML='\n            <style>\n                :host{position:relative;display:block;}:host #container{position:absolute;display:flex;flex-direction:column;justify-content:stretch;align-items:stretch;top:0;left:0;right:0;bottom:0;}:host #toolbar{display:flex;align-items:center;height:36px;}:host #toolbar .hover-target{margin:0;display:inline-flex;align-items:center;height:48px;cursor:pointer;}:host #toolbar .hover-target:hover{outline:4px solid var(--icon--color);background-color:var(--icon--color);}:host #slot-container{flex:1;position:relative;}#scroll_lock.lock-scroll:before{-webkit-mask-image:var(--toolbar-scroll-lock-active--content);}#scroll_lock:before{-webkit-mask-image:var(--toolbar-scroll-lock--content);}#select_mode:before{content:"highlight_alt";}#edit_mode:before{-webkit-mask-image:"";}#edit_mode[data-edit-mode="READ_ONLY"]:before{-webkit-mask-image:var(--toolbar-edit-mode--read-only--content);}#edit_mode[data-edit-mode="EDIT"]:before{-webkit-mask-image:var(--toolbar-edit-mode--edit--content);}:host(.aggregated) #toolbar #edit_mode[data-edit-mode="EDIT"]:before{-webkit-mask-image:var(--toolbar-edit-mode--read-only--content);}#edit_mode[data-edit-mode="SELECT_ROW"]:before{-webkit-mask-image:var(--toolbar-edit-mode--select-row--content);}#edit_mode[data-edit-mode="SELECT_COLUMN"]:before{-webkit-mask-image:var(--toolbar-edit-mode--select-column--content);}#edit_mode[data-edit-mode="SELECT_REGION"]:before{-webkit-mask-image:var(--toolbar-edit-mode--select-region--content);}#edit_mode[data-edit-mode="READ_ONLY"] span:before{content:var(--edit-mode--read-only--content,"Read Only");}#edit_mode[data-edit-mode="EDIT"] span:before{content:var(--edit-mode--edit--content,"Editable");}#edit_mode[data-edit-mode="SELECT_ROW"] span:before{content:var(--edit-mode--select-row--content,"Row Select");}#edit_mode[data-edit-mode="SELECT_COLUMN"] span:before{content:var(--edit-mode--select-column--content,"Column Select");}#edit_mode[data-edit-mode="SELECT_REGION"] span:before{content:var(--edit-mode--select-region--content,"Region Select");}#scroll_lock span:before{content:var(--scroll-lock-toggle--content,"Free Scroll");}#scroll_lock.lock-scroll span:before{content:var(--scroll-lock-alt-toggle--content,"Align Scroll");}.button:before{width:21px;height:21px;content:"";-webkit-mask-size:cover;mask-size:cover;background-color:var(--icon--color);}.button.editable:before,.button.lock-scroll:before{color:inherit;}.button{display:inline-flex;justify-content:center;align-items:center;user-select:none;padding:0 5px;border:1px solid transparent;border-radius:3px;border:1px solid transparent;box-sizing:border-box;display:inline-flex;font-size:var(--label--font-size,0.75em);height:22px;user-select:none;white-space:nowrap;width:37px;}.button>span{display:none;margin:0;padding:0;}.hover-target:hover .button{position:relative;background-color:var(--icon--color);color:var(--plugin--background);opacity:1;display:flex;align-items:center;cursor:pointer;}.hover-target:hover .button:before{background-color:var(--plugin--background);}.hover-target:hover .button>span{display:block;position:absolute;top:calc(100% + 3px);left:50%;translate:-50%;margin:0;padding:5px;height:auto;white-space:pre-wrap;line-height:1;font-size:9px;background-color:var(--icon--color);width:35px;text-align:center;border-radius:0 0 3px 3px;}\n            </style>\n            <div id="toolbar">\n                <span class="hover-target">\n                    <span id="scroll_lock" class="button">\n                        <span></span>\n                    </span>\n                </span>\n                <span class="hover-target">\n                    <span id="edit_mode" class="button" data-edit-mode="READ_ONLY">\n                        <span></span>\n                    </span>\n                </span>\n            </div>\n        ';let e=this.parentElement,t=e.querySelector("perspective-viewer-datagrid");t._scroll_lock=this.shadowRoot.querySelector("#scroll_lock"),t._scroll_lock.addEventListener("click",(()=>ye.call(t))),t._edit_button=this.shadowRoot.querySelector("#edit_mode"),t._edit_button.addEventListener("click",(()=>{ve.call(t),t.regular_table.draw(),e.dispatchEvent(new Event("perspective-config-update"))}))}};!async function(){customElements.define("perspective-viewer-datagrid-toolbar",Re),customElements.define("perspective-viewer-datagrid",Te),await customElements.whenDefined("perspective-viewer"),customElements.get("perspective-viewer").registerPlugin("perspective-viewer-datagrid")}(),function(){let e=document.createElement("style");e.textContent=i,document.head.insertBefore(e,document.head.firstChild)}()}}]);